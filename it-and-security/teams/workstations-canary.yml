agent_options:
  config:
    decorators:
      load:
        - SELECT uuid AS host_uuid FROM system_info;
        - SELECT hostname AS hostname FROM system_info;
    options:
      disable_distributed: false
      distributed_interval: 10
      distributed_plugin: tls
      distributed_tls_max_attempts: 3
      logger_tls_endpoint: /api/osquery/log
      logger_tls_period: 10
      pack_delimiter: /
  overrides:
    platforms:
      darwin:
        auto_table_construction:
          tcc_system:
            columns:
              - service
              - client
              - client_type
              - auth_value
              - auth_reason
              - policy_id
              - indirect_object_identifier
              - indirect_object_identifier_type
              - last_modified
            path: /Library/Application Support/com.apple.TCC/TCC.db
            query: select service, client, client_type, auth_value, auth_reason, policy_id, indirect_object_identifier, indirect_object_identifier_type, last_modified from access
          tcc_user:
            columns:
              - service
              - client
              - client_type
              - auth_value
              - auth_reason
              - policy_id
              - indirect_object_identifier
              - indirect_object_identifier_type
              - last_modified
            path: /Users/%/Library/Application Support/com.apple.TCC/TCC.db
            query: select service, client, client_type, auth_value, auth_reason, policy_id, indirect_object_identifier, indirect_object_identifier_type, last_modified from access
        decorators:
          load:
            - SELECT uuid AS host_uuid FROM system_info;
            - SELECT hostname AS hostname FROM system_info;
        options:
          disable_distributed: false
          distributed_interval: 10
          distributed_plugin: tls
          distributed_tls_max_attempts: 3
          logger_tls_endpoint: /api/osquery/log
          logger_tls_period: 10
          pack_delimiter: /
  update_channels:
    desktop: edge
    orbit: edge
    osqueryd: edge
controls:
  enable_disk_encryption: true
  macos_settings:
    custom_settings:
      - path: ../lib/macos/configuration-profiles/chrome-enrollment.mobileconfig
      - path: ../lib/macos/configuration-profiles/automatic-app-store-updates.mobileconfig
      - labels_include_any:
          - Conditional access test group
        path: ../lib/macos/configuration-profiles/company-portal-sso-extension.mobileconfig
      - path: ../lib/macos/configuration-profiles/date-time.mobileconfig
      - path: ../lib/macos/configuration-profiles/disable-bluetooth-file-sharing.mobileconfig
      - path: ../lib/macos/configuration-profiles/disable-content-caching.mobileconfig
      - path: ../lib/macos/configuration-profiles/disable-guest-account.mobileconfig
      - path: ../lib/macos/configuration-profiles/disable-guest-shares.mobileconfig
      - path: ../lib/macos/configuration-profiles/disable-internet-sharing.mobileconfig
      - path: ../lib/macos/configuration-profiles/disable-media-sharing.mobileconfig
      - path: ../lib/macos/configuration-profiles/disable-safari-safefiles.mobileconfig
      - path: ../lib/macos/configuration-profiles/enable-doh.mobileconfig
      - path: ../lib/macos/configuration-profiles/enable-firewall-logging.mobileconfig
      - path: ../lib/macos/configuration-profiles/enable-gatekeeper.mobileconfig
      - path: ../lib/macos/configuration-profiles/enforce-library-validation.mobileconfig
      - path: ../lib/macos/configuration-profiles/firewall.mobileconfig
      - path: ../lib/macos/configuration-profiles/full-disk-access-for-fleetd.mobileconfig
      - path: ../lib/macos/configuration-profiles/google-chrome-managed-bookmarks.mobileconfig
      - path: ../lib/macos/configuration-profiles/google-updater-background-task.mobileconfig
      - path: ../lib/macos/configuration-profiles/limit-ad-tracking.mobileconfig
      - path: ../lib/macos/configuration-profiles/misc.mobileconfig
      - path: ../lib/macos/configuration-profiles/prevent-autologon.mobileconfig
      - path: ../lib/macos/configuration-profiles/secure-terminal-keyboard.mobileconfig
      - path: ../lib/macos/configuration-profiles/ensure-show-status-bar-is-enabled.mobileconfig
      - path: ../lib/macos/declaration-profiles/Passcode settings.json
      - path: ../lib/macos/declaration-profiles/Software Update settings.json
      - labels_include_any:
          - Macs with 1Password installed
        path: ../lib/macos/configuration-profiles/1password-managed-settings.mobileconfig
      - labels_include_any:
          - Santa test devices
        path: ../lib/macos/configuration-profiles/santa-configuration.mobileconfig
      - labels_include_any:
          - Santa test devices
        path: ../lib/macos/configuration-profiles/santa-rules.mobileconfig
      - path: ../lib/macos/configuration-profiles/nudge-configuration.mobileconfig
  macos_setup:
    bootstrap_package: ""
    enable_end_user_authentication: false
    macos_setup_assistant: null
  macos_updates:
    deadline: null
    minimum_version: null
  scripts:
    - path: ../lib/macos/scripts/collect-fleetd-logs.sh
    - path: ../lib/macos/scripts/execute-disable-fleet-desktop.sh
    - path: ../lib/macos/scripts/see-automatic-enrollment-profile.sh
    - path: ../lib/macos/scripts/remove-old-nudge.sh
    - path: ../lib/macos/scripts/mdm-migration.sh
    - path: ../lib/macos/scripts/system-maintenance.sh
    - path: ../lib/macos/scripts/santa-block-script.sh
    - path: ../lib/macos/scripts/uninstall-fleetd-macos.sh
    - path: ../lib/macos/scripts/install-wine.sh
    - path: ../lib/macos/scripts/create-conditional-access-allow-file.sh
    - path: ../lib/macos/scripts/set-lock-screen-message.sh
    - path: ../lib/windows/scripts/turn-off-mdm.ps1
    - path: ../lib/windows/scripts/install-bitdefender.ps1
    - path: ../lib/windows/scripts/enable-ms-defender.ps1
    - path: ../lib/windows/scripts/create-admin-user.ps1
    - path: ../lib/windows/scripts/uninstall-fleetd-windows.ps1
    - path: ../lib/linux/scripts/uninstall-fleetd-linux.sh
    - path: ../lib/linux/scripts/install-fleet-desktop-required-extension.sh
    - path: ../lib/macos/scripts/install-santa-extension.sh
    - path: ../lib/macos/scripts/install-macos-compatibility-extension.sh
    - path: ../lib/macos/scripts/install-nudge.sh
  windows_settings:
    custom_settings:
      - path: ../lib/windows/configuration-profiles/Enable firewall.xml
      - path: ../lib/windows/configuration-profiles/Password settings.xml
      - path: ../lib/windows/configuration-profiles/Advanced PowerShell logging.xml
      - path: ../lib/windows/configuration-profiles/Disable OneDrive.xml
      - path: ../lib/windows/configuration-profiles/Disable Guest account.xml
      - path: ../lib/windows/configuration-profiles/Windows Defender compliance settings.xml
  windows_updates:
    deadline_days: 7
    grace_period_days: 2
name: "\U0001F4BB\U0001F423 Workstations (canary)"
policies:
  - path: ../lib/macos/policies/1password-emergency-kit-check.yml
  - path: ../lib/macos/policies/update-firefox.yml
  - path: ../lib/macos/policies/update-slack.yml
  - path: ../lib/macos/policies/latest-macos.yml
  - path: ../lib/macos/policies/update-1password.yml
  - path: ../lib/macos/policies/all-software-updates-installed.yml
  - path: ../lib/macos/policies/enrollment-profile-up-to-date.yml
  - path: ../lib/macos/policies/disk-encryption-check.yml
  - path: ../lib/macos/policies/1password-installed.yml
  - path: ../lib/macos/policies/install-santa-extension.yml
  - path: ../lib/macos/policies/install-macos-compatibility-extension.yml
  - path: ../lib/macos/policies/company-portal-installed.yml
  - path: ../lib/macos/policies/entra-conditional-access-check.yml
  - path: ../lib/macos/policies/install-nudge.yml
  - path: ../lib/windows/policies/antivirus-signatures-up-to-date.yml
  - path: ../lib/windows/policies/all-windows-updates-installed.yml
  - path: ../lib/windows/policies/disk-encryption-check.yml
  - path: ../lib/windows/policies/1password-installed.yml
  - path: ../lib/windows/policies/update-1password.yml
  - path: ../lib/windows/policies/windows-defender-compliance-check.yml
  - path: ../lib/linux/policies/disk-encryption-check.yml
  - path: ../lib/linux/policies/check-fleet-desktop-extension-enabled.yml
queries:
  - path: ../lib/macos/queries/detect-apple-intelligence.yml
  - path: ../lib/macos/queries/collect-santa-denied-logs.yml
software:
  app_store_apps:
    - app_store_id: "803453959"
      categories:
        - Communication
        - Productivity
      self_service: true
    - app_store_id: "409183694"
      self_service: true
  fleet_maintained_apps:
    - labels_include_any:
        - Apple Silicon macOS hosts
      self_service: true
      slug: brave-browser/darwin
    - labels_include_any:
        - Apple Silicon macOS hosts
      self_service: true
      slug: docker/darwin
    - self_service: true
      slug: microsoft-edge/darwin
    - labels_include_any:
        - Apple Silicon macOS hosts
      self_service: true
      slug: visual-studio-code/darwin
    - self_service: true
      slug: microsoft-teams/darwin
    - self_service: true
      slug: brave-browser/windows
    - self_service: true
      slug: visual-studio-code/windows
  packages:
    - categories:
        - Browsers
      path: ../lib/macos/software/mozilla-firefox.yml
      self_service: true
    - categories:
        - Browsers
      path: ../lib/macos/software/google-chrome.yml
      self_service: true
    - path: ../lib/macos/software/1password.yml
      self_service: true
    - labels_include_any:
        - Santa test devices
      path: ../lib/macos/software/santa.yml
      self_service: true
    - categories:
        - Productivity
        - Communication
      path: ../lib/macos/software/zoom.yml
      self_service: true
    - labels_include_any:
        - Keynote installed
      path: ../lib/macos/software/fleet-keynote-theme.yml
      self_service: true
    - labels_include_any:
        - Conditional access test group
      path: ../lib/macos/software/company-portal.yml
      self_service: true
    - path: ../lib/macos/software/nudge.yml
      self_service: false
    - path: ../lib/macos/software/nudge-assets.yml
      self_service: false
    - categories:
        - Communication
      labels_include_any:
        - Debian-based Linux hosts
      path: ../lib/linux/software/zoom-deb.yml
      self_service: true
    - categories:
        - Communication
      labels_include_any:
        - RPM-based Linux hosts
      path: ../lib/linux/software/zoom-rpm.yml
      self_service: true
    - categories:
        - Productivity
        - Communication
      labels_include_any:
        - Debian-based Linux hosts
      path: ../lib/linux/software/slack-deb.yml
      self_service: true
    - categories:
        - Productivity
        - Communication
      labels_include_any:
        - RPM-based Linux hosts
      path: ../lib/linux/software/slack-rpm.yml
      self_service: true
    - categories:
        - Productivity
        - Communication
      labels_include_any:
        - x86-based Windows hosts
      path: ../lib/windows/software/slack.yml
      self_service: true
    - categories:
        - Communication
      labels_include_any:
        - ARM-based Windows hosts
      path: ../lib/windows/software/zoom-arm.yml
      self_service: true
    - categories:
        - Communication
      labels_include_any:
        - x86-based Windows hosts
      path: ../lib/windows/software/zoom.yml
      self_service: true
    - categories:
        - Browsers
      labels_include_any:
        - x86-based Windows hosts
      path: ../lib/windows/software/google-chrome.yml
      self_service: true
    - categories:
        - Browsers
      labels_include_any:
        - ARM-based Windows hosts
      path: ../lib/windows/software/google-chrome-arm.yml
      self_service: true
    - path: ../lib/windows/software/1password.yml
      self_service: true
team_settings:
  features:
    enable_host_users: true
    enable_software_inventory: true
  host_expiry_settings:
    host_expiry_enabled: false
    host_expiry_window: 0
  integrations:
    conditional_access_enabled: true
    google_calendar:
      enable_calendar_events: true
      webhook_url: $DOGFOOD_CALENDAR_WEBHOOK_URL
  secrets:
    - secret: $DOGFOOD_WORKSTATIONS_CANARY_ENROLL_SECRET
  webhook_settings:
    failing_policies_webhook:
      destination_url: $DOGFOOD_FAILING_POLICIES_WEBHOOK_URL
      enable_failing_policies_webhook: true
      host_batch_size: 0
      policy_ids:
        - 14937
        - 14100
