<div id="configuration-builder" v-cloak>
  <div class="header" purpose="header-container" hide-when-scrolled data-nosnippet>
    <div purpose="header-background">
      <div purpose="configuration-builder-header">
        <div purpose="page-header" class="container-fluid d-flex justify-content-start align-items-center">
          <a purpose="header-logo" href="/">
            <img alt="Fleet logo" src="/images/logo-blue-118x41@2x.png"/>
          </a>
          <div purpose="search-bar" v-if="step === 'configuration-builder'">
            <div purpose="disabled-search" class="d-flex w-100">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text border-0 bg-transparent pl-3" >
                    <img style="height: 16px; width: 16px;" class="search" alt="search" src="/images/icon-search-16x16@2x.png">
                  </span>
                </div>
                <div class="form-control border-0 ">
                <input class="docsearch-input pr-1"
                  placeholder="Search" aria-label="Search"
                  />
                </div>
              </div>
            </div>
            <div purpose="search-results">

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div purpose="page-container" class="container-fluid px-0">
    <div purpose="platform-selector-step" v-if="step === 'platform-select'">
      <div purpose="platform-selector" class="mx-auto my-auto">
        <h2>Create a new configuration profile</h2>
        <p class="mb-0">Choose an operating system to continue.</p>
        <ajax-form :handle-submitting="handleSubmittingPlatformSelectForm" :form-errors.sync="formErrors" :form-data="platformSelectFormData" :form-rules="platformSelectFormRules" :syncing.sync="syncing" :cloud-error.sync="cloudError">
          <div purpose="platforms" id="platform" class="d-flex flex-row">
            <div purpose="platform-button" :class="[formErrors.platform ? 'is-invalid' : platformSelectFormData.platform === 'apple' ? 'selected' : '' ]"  style="margin-right: 10px;" @click="platformSelectFormData.platform = 'apple'">
              <img src="/images/os-macos-dark-24x24@2x.png" alt="macOS" class="d-inline">
              Apple
            </div>
            <div purpose="platform-button" :class="[formErrors.platform ? 'is-invalid' : platformSelectFormData.platform === 'windows' ? 'selected' : '' ]"  @click="platformSelectFormData.platform = 'windows'">
              <img src="/images/os-windows-dark-24x24@2x.png" alt="Windows" class="d-inline">
              Windows
            </div>
          </div>
          <div class="invalid-feedback" v-if="formErrors.platform">Please select an option</div>
          <ajax-button type="submit" purpose="submit-button" class="btn btn-primary" :syncing="syncing" v-if="platformSelectFormData.platform">Create</ajax-button>
        </ajax-form>
      </div>
    </div>
    <div purpose="platform-selector-step" v-if="step === 'configuration-builder'">
      <%// TODO: Change this section to be generated by a configuration file.%>
      <div purpose="category-selector" v-for="category in configurationCategories">
        <div purpose="category-options">
          <a @click="clickExpandCategory(category.name)" :class="[expandedCategory === category.name ? 'selected' : '' ]" >{{category.name}}</a>
          <div purpose="subcategories" v-if="expandedCategory === category.name">
            <a @click="clickSelectSubcategory(subcategory)" v-for="subcategory in category.subcategories">{{subcategory.name}}</a>
          </div>
        </div>
      </div>

      <div purpose="selected-subcategory-and-options">
        <div purpose="selected-subcategory" :class="[selectedSubcategory ? 'slide-in' : '' ]">
          <div v-if="selectedSubcategory">
          <div purpose="subcategory-header">
            <h2>{{selectedSubcategory.name}}</h2>
            <p>
              {{selectedSubcategory.description}} <a target="_blank" :href="selectedSubcategory.learnMoreLink" v-if="selectedSubcategory.learnMoreLink">Learn more</a>
            </p>
          </div>
          <div purpose="subcategory-options">
            <div purpose="option" v-for="option in selectedSubcategory.payloadOptions">
              <label :for="option.uniqueSlug">
                <input type="checkbox" v-model="selectedPayloadOptions[option.uniqueSlug]" :id="option.uniqueSlug" @input="clickSelectPayloadOption(option)">
                {{option.name}}
              </label>
              <img style="margin-left: 6px; height: 14px" class="d-inline" purpose="tooltip-icon" src="/images/icon-more-info-14x14@2x.png" alt="More info"  data-toggle="tooltip" tabindex="0" data-placement="top" :title="option.tooltip" v-if="option.tooltip">
            </div>
          </div>
          </div>
        </div>
        <div purpose="payload-options">
          <div purpose="options-container" :class="[payloadOptionsToDisplay.length > 0 ? 'slide-in' : '' ]">
            <div purpose="payload-category" v-for="category in _.keysIn(payloadOptionsToDisplayGroupedByCategory)">
              <div purpose="category-header">
                <h2>{{category}}</h2>
                <div purpose="download-and-remove-buttons">
                  <a @click="clickRemoveAllPayloadOptions()">Remove all</a>
                  <a purpose="download-button"><img src="/images/icon-download.png" style="height: 12px;"></a>
                </div>
              </div>

              <div purpose="payload-option" v-for="option in payloadOptionsToDisplayGroupedByCategory[category]">
                <div purpose="name-and-access-type" class="d-flex flex-row align-items-center justify-content-between w-100">
                  <p class="mb-0"><strong>{{option.name}}</strong></p>

                  <select purpose="access-type-select" class="form-control" style="width: 120px">
                    <option selected>Access type</option>
                    <option :value="accessType" v-for="accessType in option.supportedAccessTypes">{{accessType}}</option>
                  </select>
                </div>
                <div purpose="option-value">
                  <input class="form-control" :type="option.acceptedValue.type" placeholder="0" >


                </div>
                <a @click="clickRemovePayloadOption(option)">Remove</a>
              </div>
            </div>
          </div>
          <div purpose="empty-state-content" v-if="payloadOptionsToDisplay.length === 0">
            <div purpose="empty-box">
            </div>
            <p purpose="empty-state-note">
              Choose from the categories on the left to add settings.
            </p>
          </div>
        </div>

      </div>



    </div>
  </div>
</div>
<%- /* Expose server-rendered data as window.SAILS_LOCALS :: */ exposeLocalsToBrowser() %>
