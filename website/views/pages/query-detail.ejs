<div id="query-detail" v-cloak>
  <div purpose="page-container">
    <div purpose="page-content">
      <div purpose="breadcrumbs-and-search" class="d-flex flex-md-row flex-column justify-content-between align-items-md-center align-items-start">
        <div purpose="breadcrumbs" class="d-flex flex-row align-items-start">
          <div>
            <a purpose="breadcrumbs-category" class="text-nowrap" href="/queries">Queries</a>/
          </div>
          <div purpose="breadcrumbs-title">
            <span><%- query.name %></span>
          </div>
        </div>
        <div purpose="search" id="docsearch-query" class="d-flex">
          <div purpose="disabled-search" class="d-flex w-100">
            <div class="input-group">
              <div class="input-group-prepend">
                <span class="input-group-text border-0 bg-transparent pl-3" >
                  <img style="height: 16px; width: 16px;" class="search" alt="search" src="/images/icon-search-16x16@2x.png">
                </span>
              </div>
              <div class="form-control border-0 ">
              <input class="docsearch-input pr-1"
                placeholder="Search" aria-label="Search the handbook"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
      <div purpose="query-details-and-sidebar" class="d-flex flex-lg-row flex-column">
        <div purpose="query-details" class="d-flex flex-column">
          <h2 purpose="query-name"><%- query.name %></h2>
          <div purpose="query-attribution">
            <img alt="Contributor's GitHub profile picture" purpose="contributor-profile-picture" src="https://github.com/<%- query.contributors[0].handle %>.png?size=200">
            <a purpose="query-link" href="https://github.com/<%- query.contributors[0].handle %>" class="d-flex align-items-center">
            <p purpose="contributor-profile-name" class="mb-0"><%= query.contributors[0].name %></p></a>
          </div>
          <p purpose="query-description"><%- query.description %></p>
          <div purpose="query-check">
            <p>To learn more about queries, <a href="/guides/queries">check this guide</a></p>
            <div purpose="codeblock">
              <div purpose="codeblock-tabs" >
                <a purpose="codeblock-tab" :class="[ selectedTab === 'sql' ? 'selected' : '']" @click="selectedTab = 'sql'">Query</a>
                <a purpose="codeblock-tab" :class="[ selectedTab === 'ps' ? 'selected' : '']"  @click="selectedTab = 'ps'" v-if="query.powershell">PowerShell<span purpose="new-badge">NEW</span></a>
                <div purpose="copy-button-tab">
                  <div purpose="copy-button"></div>
                </div>
              </div>
              <pre v-show="selectedTab === 'sql'"><code class="hljs sql"><%= query.query %></code></pre>
              <pre v-show="selectedTab === 'ps'"><code class="hljs ps has-linebreaks"><%= query.powershell %></code></pre>
            </div>
            <div purpose="powershell-note" v-if="selectedTab === 'ps'">
              <img src="/images/icon-info-16x16@2x.png" alt="An icon indicating that this section has important information">
              <div>
                <p>PowerShell commands are currently work in progress, <a :href="'https://github.com/fleetdm/fleet/edit/main/'+queryLibraryYmlRepoPath">contributions welcome</a>.</p>
              </div>
            </div>
          </div>
        </div>
        <div purpose="sidebar-container">
          <div purpose="right-sidebar" class="d-flex flex-column">
            <div purpose="query-platform">
              <h4>Platform</h4>
              <div class="d-flex flex-row">
                <img src="/images/os-macos-dark-24x24@2x.png" alt="macOS" :class="[ selectedTab === 'ps' ? 'muted' : '']" v-if="query.platform.includes('darwin')"/>
                <img src="/images/os-windows-dark-24x24@2x.png" alt="Windows" :class="[ selectedTab === 'bash' ? 'selected' : '']" v-if="query.platform.includes('windows')"/>
                <img src="/images/os-linux-dark-24x24@2x.png" alt="Linux" :class="[ selectedTab === 'ps' ? 'muted' : '']" v-if="query.platform.includes('linux')"/>
                <img src="/images/os-chromeos-dark-24x24@2x.png" alt="ChromeOS" :class="[ selectedTab === 'ps' ? 'muted' : '']" v-if="query.platform.includes('chrome')"/>
              </div>
            </div>
            <div purpose="docs-links" class="order-3">
              <a purpose="sidebar-link" :href="'https://github.com/fleetdm/fleet/edit/main/'+queryLibraryYmlRepoPath"> <img src="/images/icon-edit-16x16@2x.png" alt="Suggest an edit">Edit</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<%- /* Expose server-rendered data as window.SAILS_LOCALS :: */ exposeLocalsToBrowser() %>
