{
  "versions": [
    {
      "version": "4.15.0",
      "queries": {
        "exists": "SELECT 1 FROM programs WHERE name = 'Airtame 4.15.0' AND publisher = 'Airtame';"
      },
      "installer_url": "https://downloads.airtame.com/app/latest/win/Airtame-4.15.0-setup.msi",
      "install_script_ref": "8959087b",
      "uninstall_script_ref": "febfc485",
      "sha256": "ae06a1b9ab3a5c706a8d701b9d49e750a3945e6028a9d49ad727d7da30570320",
      "default_categories": [
        "Productivity"
      ],
      "upgrade_code": "{E29931C0-80A4-45BE-8F54-BDC39F9D3C63}"
    }
  ],
  "refs": {
    "8959087b": "$logFile = \"${env:TEMP}/fleet-install-software.log\"\n\ntry {\n\n$installProcess = Start-Process msiexec.exe `\n  -ArgumentList \"/quiet /norestart /lv ${logFile} /i `\"${env:INSTALLER_PATH}`\"\" `\n  -PassThru -Verb RunAs -Wait\n\nGet-Content $logFile -Tail 500\n\nExit $installProcess.ExitCode\n\n} catch {\n  Write-Host \"Error: $_\"\n  Exit 1\n}\n",
    "febfc485": "# Fleet uninstalls Airtame MSI\n# Tries product code first, then falls back to upgrade code lookup\n$inst = New-Object -ComObject \"WindowsInstaller.Installer\"\n$timeoutSeconds = 300  # 5 minute timeout per product\n$upgradeCode = \"{E29931C0-80A4-45BE-8F54-BDC39F9D3C63}\"\n$productCode = \"{AA404F77-BC09-4A42-A93F-EBB102306039}\"\n\nfunction Test-ProductInstalled {\n    param([string]$ProductCode)\n    try {\n        $product = $inst.Products.Item($ProductCode)\n        return $true\n    } catch {\n        return $false\n    }\n}\n\n# Function to uninstall by product code and verify it's gone\nfunction Uninstall-ProductCode {\n    param([string]$Code)\n    \n    Write-Output \"Attempting to uninstall product code: $Code\"\n    \n    # Check if product is installed first\n    if (-not (Test-ProductInstalled -ProductCode $Code)) {\n        Write-Output \"Product code $Code is not installed\"\n        return $true\n    }\n    \n    # Uninstall using /qn (quiet, no UI) instead of /quiet\n    $process = Start-Process msiexec -ArgumentList @(\"/qn\", \"/x\", $Code, \"/norestart\") -PassThru -Wait -NoNewWindow\n    \n    # Wait for process with timeout\n    $completed = $process.WaitForExit($timeoutSeconds * 1000)\n    \n    if (-not $completed) {\n        Stop-Process -Id $process.Id -Force -ErrorAction SilentlyContinue\n        Write-Output \"Uninstall timed out for $Code\"\n        return $false\n    }\n    \n    # Check exit code\n    if ($process.ExitCode -ne 0) {\n        Write-Output \"Uninstall for $Code exited with code $($process.ExitCode)\"\n        return $false\n    }\n    \n    # Wait a moment for Windows Installer to update\n    Start-Sleep -Seconds 2\n    \n    # Verify product is actually gone\n    $stillInstalled = Test-ProductInstalled -ProductCode $Code\n    if ($stillInstalled) {\n        Write-Output \"Product $Code is still installed after uninstall attempt\"\n        return $false\n    }\n    \n    Write-Output \"Successfully uninstalled $Code\"\n    return $true\n}\n\n# First, try uninstalling by product code directly\n$uninstalled = Uninstall-ProductCode -Code $productCode\n\n# If that didn't work, try finding all products with the upgrade code\nif (-not $uninstalled) {\n    Write-Output \"Product code uninstall failed, trying upgrade code lookup...\"\n    $relatedProducts = $inst.RelatedProducts($upgradeCode)\n    \n    if ($relatedProducts.Count -eq 0) {\n        Write-Output \"No products found with upgrade code $upgradeCode\"\n        Exit 1\n    }\n    \n    foreach ($relatedProductCode in $relatedProducts) {\n        Write-Output \"Found related product: $relatedProductCode\"\n        $result = Uninstall-ProductCode -Code $relatedProductCode\n        if (-not $result) {\n            Write-Output \"Failed to uninstall $relatedProductCode\"\n            Exit 1\n        }\n    }\n}\n\n# Final verification - check if any products with this upgrade code still exist\n$remainingProducts = $inst.RelatedProducts($upgradeCode)\nif ($remainingProducts.Count -gt 0) {\n    Write-Output \"Warning: $($remainingProducts.Count) product(s) still found with upgrade code after uninstall\"\n    Exit 1\n}\n\n# Also verify the specific product code is gone\nif (Test-ProductInstalled -ProductCode $productCode) {\n    Write-Output \"Product code $productCode is still installed\"\n    Exit 1\n}\n\nWrite-Output \"Uninstall completed successfully\"\nExit 0\n"
  }
}
