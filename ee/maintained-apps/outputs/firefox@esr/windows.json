{
  "versions": [
    {
      "version": "140.7.1",
      "queries": {
        "exists": "SELECT 1 FROM programs WHERE name = 'Mozilla Firefox 140.7.1 ESR (x64 en-US)' AND publisher = 'Mozilla';"
      },
      "installer_url": "https://download-installer.cdn.mozilla.net/pub/firefox/releases/140.7.1esr/win64/en-US/Firefox%20Setup%20140.7.1esr.exe",
      "install_script_ref": "bdf44e4d",
      "uninstall_script_ref": "5dc712f7",
      "sha256": "f086d443a16053d97ae2a75f9a300afbcbe41b6dc213b99c57a76fdb5b692258",
      "default_categories": [
        "Browsers"
      ]
    }
  ],
  "refs": {
    "5dc712f7": "# Fleet extracts name from installer (EXE) and saves it to PACKAGE_ID\n# variable\n# Match Firefox ESR only (e.g. \"Mozilla Firefox 140.7.1 ESR (x64 en-US)\"), not regular Firefox\n$softwareNameLike = \"*Firefox*ESR*\"\n\n# NSIS installers require /S flag for silent uninstall\n$uninstallArgs = \"/S\"\n\n$paths = @(\n  'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall',\n  'HKLM:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall'\n)\n\n$exitCode = 0\n\ntry {\n\n[array]$uninstallKeys = Get-ChildItem `\n    -Path $paths `\n    -ErrorAction SilentlyContinue |\n        ForEach-Object { Get-ItemProperty $_.PSPath }\n\n$foundUninstaller = $false\nforeach ($key in $uninstallKeys) {\n    if ($key.DisplayName -like $softwareNameLike) {\n        $foundUninstaller = $true\n        $uninstallCommand = if ($key.QuietUninstallString) {\n            $key.QuietUninstallString\n        } else {\n            $key.UninstallString\n        }\n\n        # The uninstall command may contain command and args, like:\n        # \"C:\\Program Files\\Mozilla Firefox ESR\\uninstall\\helper.exe\" /S\n        $splitArgs = $uninstallCommand.Split('\"')\n        if ($splitArgs.Length -gt 1) {\n            if ($splitArgs.Length -eq 3) {\n                $existingArgs = $splitArgs[2].Trim()\n                if ($existingArgs -notmatch '\\b/S\\b') {\n                    $uninstallArgs = \"$existingArgs /S\".Trim()\n                } else {\n                    $uninstallArgs = $existingArgs\n                }\n            } elseif ($splitArgs.Length -gt 3) {\n                Throw `\n                    \"Uninstall command contains multiple quoted strings. \" +\n                        \"Please update the uninstall script.`n\" +\n                        \"Uninstall command: $uninstallCommand\"\n            }\n            $uninstallCommand = $splitArgs[1]\n        } else {\n            if ($uninstallCommand -notmatch '\\b/S\\b') {\n                $uninstallArgs = \"/S\"\n            } else {\n                $uninstallArgs = \"\"\n            }\n        }\n        Write-Host \"Uninstall command: $uninstallCommand\"\n        Write-Host \"Uninstall args: $uninstallArgs\"\n\n        $processOptions = @{\n            FilePath = $uninstallCommand\n            PassThru = $true\n            Wait = $true\n        }\n\n        if ($uninstallArgs -ne '') {\n            $processOptions.ArgumentList = $uninstallArgs\n        }\n\n        $process = Start-Process @processOptions\n        $exitCode = $process.ExitCode\n        Write-Host \"Uninstall exit code: $exitCode\"\n        break\n    }\n}\n\nif (-not $foundUninstaller) {\n    Write-Host \"Uninstaller for Firefox ESR not found.\"\n    $exitCode = 1\n}\n\nExit $exitCode\n\n} catch {\n    Write-Host \"Error: $_\"\n    Exit 1\n}\n",
    "bdf44e4d": "# Learn more about .exe install scripts:\n# http://fleetdm.com/learn-more-about/exe-install-scripts\n\n$exeFilePath = \"${env:INSTALLER_PATH}\"\n$timeoutSeconds = 240\n\ntry {\n\n# Silent install flags from winget manifest for Mozilla.Firefox.ESR (nullsoft installer)\n$installArgs = \"/S /PreventRebootRequired=true\"\n\n# In CI/headless environments, disable the Maintenance Service to prevent hangs.\n# On real devices, the Maintenance Service is kept enabled for seamless background updates.\nif ($env:CI -eq \"true\") {\n    $installArgs += \" /MaintenanceService=false\"\n    Write-Host \"CI environment detected, disabling MaintenanceService\"\n}\n\nWrite-Host \"Install args: $installArgs\"\n$process = Start-Process -FilePath \"$exeFilePath\" `\n  -ArgumentList $installArgs `\n  -PassThru\n\nWrite-Host \"Installer started (PID: $($process.Id)), waiting up to $timeoutSeconds seconds...\"\n\n$completed = $process.WaitForExit($timeoutSeconds * 1000)\n\nif (-not $completed) {\n    Write-Host \"Installation timed out after $timeoutSeconds seconds, killing process...\"\n    $process.Kill()\n    Exit 1\n}\n\n$exitCode = $process.ExitCode\nWrite-Host \"Install exit code: $exitCode\"\n\n# Wait briefly for any child processes to finish and release file locks\nStart-Sleep -Seconds 5\n\nExit $exitCode\n\n} catch {\n  Write-Host \"Error: $_\"\n  Exit 1\n}\n"
  }
}
