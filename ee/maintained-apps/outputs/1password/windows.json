{
  "versions": [
    {
      "version": "8.11.18",
      "queries": {
        "exists": "SELECT 1 FROM programs WHERE name = '1Password' AND publisher = 'AgileBits Inc.';"
      },
      "installer_url": "https://c.1password.com/dist/1P/win8/1PasswordSetup-8.11.18.msi",
      "install_script_ref": "8959087b",
      "uninstall_script_ref": "bb1e89f7",
      "sha256": "e68ebbfca75a999819127c28b8c231af9281f5c946fcf7abfbdcdd35b5b12c22",
      "default_categories": [
        "Productivity"
      ]
    }
  ],
  "refs": {
    "8959087b": "$logFile = \"${env:TEMP}/fleet-install-software.log\"\n\ntry {\n\n$installProcess = Start-Process msiexec.exe `\n  -ArgumentList \"/quiet /norestart /lv ${logFile} /i `\"${env:INSTALLER_PATH}`\"\" `\n  -PassThru -Verb RunAs -Wait\n\nGet-Content $logFile -Tail 500\n\nExit $installProcess.ExitCode\n\n} catch {\n  Write-Host \"Error: $_\"\n  Exit 1\n}\n",
    "bb1e89f7": "# 1Password Uninstall Script\n# This script uninstalls 1Password using the product code with improved reliability\n\n$productCode = \"{7DB53C29-932E-4F28-9AD6-85E66EDE3DB2}\"\n$timeoutSeconds = 300  # 5 minute timeout\n$logFile = \"${env:TEMP}\\fleet-1password-uninstall.log\"\n\ntry {\n    # Start transcript for logging\n    Start-Transcript -Path $logFile -Append -ErrorAction SilentlyContinue\n    \n    Write-Host \"Starting 1Password uninstall process...\"\n    Write-Host \"Product Code: $productCode\"\n    \n    # Step 1: Close any running 1Password processes\n    Write-Host \"Checking for running 1Password processes...\"\n    $processes = Get-Process -Name \"1Password*\" -ErrorAction SilentlyContinue\n    if ($processes) {\n        Write-Host \"Found $($processes.Count) running 1Password process(es), attempting to close...\"\n        foreach ($proc in $processes) {\n            try {\n                Write-Host \"Closing process: $($proc.ProcessName) (PID: $($proc.Id))\"\n                Stop-Process -Id $proc.Id -Force -ErrorAction Stop\n                Start-Sleep -Seconds 2\n            } catch {\n                Write-Host \"Warning: Could not close process $($proc.Id): $($_.Exception.Message)\"\n            }\n        }\n        # Wait a bit more to ensure processes are fully terminated\n        Start-Sleep -Seconds 3\n    } else {\n        Write-Host \"No running 1Password processes found.\"\n    }\n    \n    # Step 2: Verify the product is installed before attempting uninstall\n    Write-Host \"Verifying 1Password is installed...\"\n    $installed = Get-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*\" -ErrorAction SilentlyContinue | \n        Where-Object { $_.PSChildName -eq $productCode -or $_.UninstallString -like \"*$productCode*\" }\n    \n    if (-not $installed) {\n        Write-Host \"1Password does not appear to be installed (product code not found in registry).\"\n        Write-Host \"This may indicate it was already uninstalled or installed differently.\"\n        Exit 0\n    }\n    \n    Write-Host \"1Password installation confirmed, proceeding with uninstall...\"\n    \n    # Step 3: Execute uninstall with timeout protection\n    Write-Host \"Executing msiexec uninstall command...\"\n    $uninstallArgs = @(\"/quiet\", \"/x\", $productCode, \"/norestart\", \"/L*v\", \"${env:TEMP}\\1password-uninstall-msi.log\")\n    \n    $processStartInfo = New-Object System.Diagnostics.ProcessStartInfo\n    $processStartInfo.FileName = \"msiexec.exe\"\n    $processStartInfo.Arguments = ($uninstallArgs -join \" \")\n    $processStartInfo.UseShellExecute = $false\n    $processStartInfo.RedirectStandardOutput = $true\n    $processStartInfo.RedirectStandardError = $true\n    $processStartInfo.CreateNoWindow = $true\n    \n    $process = New-Object System.Diagnostics.Process\n    $process.StartInfo = $processStartInfo\n    \n    Write-Host \"Starting uninstall process (timeout: $timeoutSeconds seconds)...\"\n    $process.Start() | Out-Null\n    \n    # Wait for process with timeout\n    $completed = $process.WaitForExit($timeoutSeconds * 1000)\n    \n    if (-not $completed) {\n        Write-Host \"ERROR: Uninstall process exceeded timeout of $timeoutSeconds seconds. Terminating...\"\n        try {\n            Stop-Process -Id $process.Id -Force -ErrorAction Stop\n            Write-Host \"Process terminated.\"\n        } catch {\n            Write-Host \"Warning: Could not terminate process: $($_.Exception.Message)\"\n        }\n        Exit 1603  # ERROR_INSTALL_FAILURE\n    }\n    \n    $exitCode = $process.ExitCode\n    Write-Host \"Uninstall process completed with exit code: $exitCode\"\n    \n    # Read output if available\n    $stdout = $process.StandardOutput.ReadToEnd()\n    $stderr = $process.StandardError.ReadToEnd()\n    \n    if ($stdout) {\n        Write-Host \"Standard output: $stdout\"\n    }\n    if ($stderr) {\n        Write-Host \"Standard error: $stderr\"\n    }\n    \n    # Check MSI log for additional details\n    $msiLogPath = \"${env:TEMP}\\1password-uninstall-msi.log\"\n    if (Test-Path $msiLogPath) {\n        Write-Host \"MSI log file available at: $msiLogPath\"\n        # Read last 50 lines of MSI log for troubleshooting\n        $msiLogTail = Get-Content $msiLogPath -Tail 50 -ErrorAction SilentlyContinue\n        if ($msiLogTail) {\n            Write-Host \"Last 50 lines of MSI log:\"\n            Write-Host ($msiLogTail -join \"`n\")\n        }\n    }\n    \n    # Step 4: Verify uninstall completed successfully\n    if ($exitCode -eq 0) {\n        Write-Host \"Uninstall completed successfully.\"\n        \n        # Double-check by verifying product code is no longer in registry\n        Start-Sleep -Seconds 2\n        $stillInstalled = Get-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*\" -ErrorAction SilentlyContinue | \n            Where-Object { $_.PSChildName -eq $productCode -or $_.UninstallString -like \"*$productCode*\" }\n        \n        if ($stillInstalled) {\n            Write-Host \"Warning: Product code still found in registry after uninstall. Uninstall may not have completed fully.\"\n        } else {\n            Write-Host \"Verification: Product code no longer found in registry. Uninstall confirmed.\"\n        }\n    } else {\n        Write-Host \"Uninstall failed with exit code: $exitCode\"\n        Write-Host \"Common exit codes:\"\n        Write-Host \"  0 = Success\"\n        Write-Host \"  1603 = ERROR_INSTALL_FAILURE\"\n        Write-Host \"  1605 = ERROR_UNKNOWN_PRODUCT (product not found)\"\n        Write-Host \"  1619 = ERROR_INSTALL_PACKAGE_OPEN_FAILED\"\n    }\n    \n    Stop-Transcript -ErrorAction SilentlyContinue\n    Exit $exitCode\n    \n} catch {\n    Write-Host \"ERROR: Exception occurred during uninstall: $($_.Exception.Message)\"\n    Write-Host \"Stack trace: $($_.ScriptStackTrace)\"\n    Stop-Transcript -ErrorAction SilentlyContinue\n    Exit 1\n}\n\n"
  }
}
