{
  "versions": [
    {
      "version": "6.0.36",
      "queries": {
        "exists": "SELECT 1 FROM programs WHERE name = 'Microsoft .NET Runtime - 6.0.36 (x64)' AND publisher = 'Microsoft Corporation';"
      },
      "installer_url": "https://builds.dotnet.microsoft.com/dotnet/Runtime/6.0.36/dotnet-runtime-6.0.36-win-x64.exe",
      "install_script_ref": "9c51fa12",
      "uninstall_script_ref": "0d555b15",
      "sha256": "6bdad7bc4c41fe93d4ae7b0312b1d017cfe369d28e7e2e421f5b675f9feefe84",
      "default_categories": [
        "Developer tools"
      ]
    }
  ],
  "refs": {
    "0d555b15": "# Attempts to locate Microsoft .NET Runtime 6's uninstaller from registry and execute it silently\n\n$displayName = \"Microsoft .NET Runtime\"\n$publisher = \"Microsoft Corporation\"\n\n$paths = @(\n  'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall',\n  'HKLM:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall'\n)\n\n$uninstall = $null\nforeach ($p in $paths) {\n  $items = Get-ItemProperty \"$p\\*\" -ErrorAction SilentlyContinue | Where-Object {\n    $_.DisplayName -and ($_.DisplayName -like \"*$displayName*\") -and ($_.DisplayName -like \"*6.0*\") -and ($publisher -eq \"\" -or $_.Publisher -eq $publisher)\n  }\n  if ($items) { $uninstall = $items | Select-Object -First 1; break }\n}\n\nif (-not $uninstall -or -not $uninstall.UninstallString) {\n  Write-Host \"Uninstall entry not found\"\n  Exit 0\n}\n\n$uninstallString = $uninstall.UninstallString\n$exePath = \"\"\n$arguments = \"\"\n\n# Parse the uninstall string to extract executable path and existing arguments\n# Handles both quoted and unquoted paths\nif ($uninstallString -match '^\"([^\"]+)\"(.*)') {\n    $exePath = $matches[1]\n    $arguments = $matches[2].Trim()\n} elseif ($uninstallString -match '^([^\\s]+)(.*)') {\n    $exePath = $matches[1]\n    $arguments = $matches[2].Trim()\n} else {\n    Write-Host \"Error: Could not parse uninstall string: $uninstallString\"\n    Exit 1\n}\n\n# Build argument list array, preserving existing arguments and adding /silent for silent\n$argumentList = @()\nif ($arguments -ne '') {\n    # Split existing arguments and add them\n    $argumentList += $arguments -split '\\s+'\n}\n# Add /silent for silent uninstall if not already present\nif ($argumentList -notcontains \"/silent\" -and $argumentList -notcontains \"--silent\") {\n    $argumentList += \"/silent\"\n}\n\nWrite-Host \"Uninstall executable: $exePath\"\nWrite-Host \"Uninstall arguments: $($argumentList -join ' ')\"\n\ntry {\n    $processOptions = @{\n        FilePath = $exePath\n        PassThru = $true\n        Wait = $true\n    }\n\n    if ($argumentList.Count -gt 0) {\n        $processOptions.ArgumentList = $argumentList\n    }\n\n    $process = Start-Process @processOptions\n    $exitCode = $process.ExitCode\n    \n    Write-Host \"Uninstall exit code: $exitCode\"\n    Exit $exitCode\n} catch {\n    Write-Host \"Error: $_\"\n    Exit 1\n}\n\n",
    "9c51fa12": "# Learn more about .exe install scripts:\n# http://fleetdm.com/learn-more-about/exe-install-scripts\n\n$exeFilePath = \"${env:INSTALLER_PATH}\"\n\n$exitCode = 0\n\ntry {\n    Write-Host \"Starting Microsoft .NET Runtime 6 installation...\"\n    \n    # Microsoft .NET Runtime uses a burn installer (WiX bootstrapper)\n    # Per Winget manifest: Silent: /quiet, Custom: /norestart\n    $processOptions = @{\n        FilePath = $exeFilePath\n        ArgumentList = \"/quiet\", \"/norestart\"\n        PassThru = $true\n        Wait = $true\n        NoNewWindow = $true\n    }\n    \n    $process = Start-Process @processOptions\n    $exitCode = $process.ExitCode\n    \n    Write-Host \"Install exit code: $exitCode\"\n    \n    # Burn installers may return non-zero exit codes even on success\n    # Verify installation by checking registry if exit code is non-zero\n    if ($exitCode -ne 0) {\n        Write-Host \"Installer exited with non-zero code: $exitCode. Verifying installation...\"\n        Start-Sleep -Seconds 3\n        \n        $registryPaths = @(\n            \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*\",\n            \"HKLM:\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*\"\n        )\n        \n        $found = $false\n        foreach ($path in $registryPaths) {\n            $entry = Get-ItemProperty $path -ErrorAction SilentlyContinue | Where-Object {\n                $_.DisplayName -like \"*Microsoft .NET Runtime*6.0*\" -and\n                $_.Publisher -eq \"Microsoft Corporation\"\n            }\n            if ($entry) {\n                Write-Host \"Microsoft .NET Runtime 6 found in registry: $($entry.DisplayName) (Version: $($entry.DisplayVersion))\"\n                $found = $true\n                $exitCode = 0 # Override exit code to 0 for successful validation\n                break\n            }\n        }\n        \n        if (-not $found) {\n            Write-Host \"Microsoft .NET Runtime 6 not found in registry. Installation may have failed.\"\n        }\n    } else {\n        # Even if exit code is 0, give osquery a moment to detect the installation\n        Start-Sleep -Seconds 2\n    }\n\n} catch {\n    Write-Host \"Error: $_\"\n    $exitCode = 1\n}\n\nExit $exitCode\n\n"
  }
}
