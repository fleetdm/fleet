{
  "versions": [
    {
      "version": "25.01",
      "queries": {
        "exists": "SELECT 1 FROM programs WHERE name = '7-zip' AND publisher = 'Igor Pavlov';"
      },
      "installer_url": "https://7-zip.org/a/7z2501-x64.msi",
      "install_script_ref": "8959087b",
      "uninstall_script_ref": "71006c5c",
      "sha256": "e7eb0b7ed5efa4e087b7b17f191797f7af5b7f442d1290c66f3a21777005ef57",
      "default_categories": [
        "Productivity"
      ],
      "upgrade_code": "{23170F69-40C1-2702-0000-000004000000}"
    }
  ],
  "refs": {
    "71006c5c": "# Attempts to locate 7-Zip's product code and uninstall it using msiexec\n# This script is version-agnostic and will find any installed version of 7-Zip\n\n$displayNamePattern = \"7-Zip*\"\n$publisher = \"Igor Pavlov\"\n\n# First, try using \"{23170F69-40C1-2702-2501-000001000000}\" if it's available and is a valid product code (GUID)\n$productCode = $null\nif (\"{23170F69-40C1-2702-2501-000001000000}\" -and \"{23170F69-40C1-2702-2501-000001000000}\" -match '^{[A-F0-9]{8}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{12}}$') {\n  Write-Host \"Using product code from PACKAGE_ID: \"{23170F69-40C1-2702-2501-000001000000}\"\"\n  $productCode = \"{23170F69-40C1-2702-2501-000001000000}\"\n} else {\n  # Fall back to searching registry for any 7-Zip installation\n  # This matches any version like \"7-Zip 25.01 (x64)\" or \"7-Zip 24.07 (x64)\"\n  Write-Host \"Searching registry for 7-Zip installation...\"\n  \n  $paths = @(\n    'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall',\n    'HKLM:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall',\n    'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall',\n    'HKCU:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall'\n  )\n\n  foreach ($p in $paths) {\n    $items = Get-ChildItem -Path $p -ErrorAction SilentlyContinue | ForEach-Object {\n      Get-ItemProperty $_.PSPath -ErrorAction SilentlyContinue\n    } | Where-Object {\n      $_.DisplayName -and $_.DisplayName -like $displayNamePattern -and ($publisher -eq \"\" -or $_.Publisher -eq $publisher) -and $_.PSChildName -match '^{[A-F0-9]{8}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{4}-[A-F0-9]{12}}$'\n    }\n    if ($items) {\n      $productCode = ($items | Select-Object -First 1).PSChildName\n      Write-Host \"Found product code in registry: $productCode\"\n      break\n    }\n  }\n}\n\nif (-not $productCode) {\n  Write-Host \"Product code not found for 7-Zip\"\n  Exit 0  # Not found = success for Fleet\n}\n\nWrite-Host \"Found product code: $productCode\"\nWrite-Host \"Attempting to uninstall using msiexec...\"\n\n$timeoutSeconds = 300  # 5 minute timeout\n\ntry {\n  $process = Start-Process msiexec -ArgumentList @(\"/quiet\", \"/x\", $productCode, \"/norestart\") -PassThru -NoNewWindow\n  \n  # Wait for process with timeout\n  $completed = $process.WaitForExit($timeoutSeconds * 1000)\n  \n  if (-not $completed) {\n    Stop-Process -Id $process.Id -Force -ErrorAction SilentlyContinue\n    Write-Host \"Uninstall timed out after $timeoutSeconds seconds\"\n    Exit 1603  # ERROR_UNINSTALL_FAILURE\n  }\n  \n  # Check exit code and output result\n  if ($process.ExitCode -eq 0) {\n    Write-Host \"Uninstall successful\"\n    # Add a small delay to ensure filesystem is updated\n    Start-Sleep -Seconds 2\n    Exit 0\n  } else {\n    Write-Host \"Uninstall failed with exit code: $($process.ExitCode)\"\n    Exit $process.ExitCode\n  }\n} catch {\n  Write-Host \"Error running uninstaller: $_\"\n  Exit 1\n}\n",
    "8959087b": "$logFile = \"${env:TEMP}/fleet-install-software.log\"\n\ntry {\n\n$installProcess = Start-Process msiexec.exe `\n  -ArgumentList \"/quiet /norestart /lv ${logFile} /i `\"${env:INSTALLER_PATH}`\"\" `\n  -PassThru -Verb RunAs -Wait\n\nGet-Content $logFile -Tail 500\n\nExit $installProcess.ExitCode\n\n} catch {\n  Write-Host \"Error: $_\"\n  Exit 1\n}\n"
  }
}
