{
  "versions": [
    {
      "version": "25.01",
      "queries": {
        "exists": "SELECT 1 FROM programs WHERE name = '7zip' AND publisher = 'Igor Pavlov';"
      },
      "installer_url": "https://7-zip.org/a/7z2501-x64.msi",
      "install_script_ref": "8959087b",
      "uninstall_script_ref": "dc50f464",
      "sha256": "e7eb0b7ed5efa4e087b7b17f191797f7af5b7f442d1290c66f3a21777005ef57",
      "default_categories": [
        "Developer tools"
      ],
      "upgrade_code": "{23170F69-40C1-2702-0000-000004000000}"
    }
  ],
  "refs": {
    "8959087b": "$logFile = \"${env:TEMP}/fleet-install-software.log\"\n\ntry {\n\n$installProcess = Start-Process msiexec.exe `\n  -ArgumentList \"/quiet /norestart /lv ${logFile} /i `\"${env:INSTALLER_PATH}`\"\" `\n  -PassThru -Verb RunAs -Wait\n\nGet-Content $logFile -Tail 500\n\nExit $installProcess.ExitCode\n\n} catch {\n  Write-Host \"Error: $_\"\n  Exit 1\n}\n",
    "dc50f464": "# Fleet uninstalls app by finding all related product codes for the specified upgrade code\n$inst = New-Object -ComObject \"WindowsInstaller.Installer\"\n$upgradeCode = \"{23170F69-40C1-2702-0000-000004000000}\"\n$timeoutSeconds = 300  # 5 minute timeout per product\n\n# Get all product codes for this upgrade code\n$productCodes = @($inst.RelatedProducts($upgradeCode))\n\nif ($productCodes.Count -eq 0) {\n    Write-Host \"No products found for upgrade code $upgradeCode\"\n    Exit 0\n}\n\nforeach ($product_code in $productCodes) {\n    Write-Host \"Uninstalling product: $product_code\"\n    $process = Start-Process msiexec -ArgumentList @(\"/quiet\", \"/x\", $product_code, \"/norestart\") -PassThru -NoNewWindow\n    \n    # Wait for process with timeout\n    $completed = $process.WaitForExit($timeoutSeconds * 1000)\n    \n    if (-not $completed) {\n        Stop-Process -Id $process.Id -Force -ErrorAction SilentlyContinue\n        Write-Host \"Uninstall timed out for $product_code\"\n        Exit 1603  # ERROR_UNINSTALL_FAILURE\n    }\n    \n    # If the uninstall failed, bail\n    if ($process.ExitCode -ne 0) {\n        Write-Host \"Uninstall for $($product_code) exited $($process.ExitCode)\"\n        Exit $process.ExitCode\n    }\n    \n    # Wait a moment for Windows to update the registry\n    Start-Sleep -Seconds 2\n}\n\n# Wait additional time for registry to fully update\nStart-Sleep -Seconds 3\n\n# Verify uninstall by checking if any products still exist\n$remainingProducts = @($inst.RelatedProducts($upgradeCode))\nif ($remainingProducts.Count -gt 0) {\n    Write-Host \"Warning: Some products still exist after uninstall: $($remainingProducts -join ', ')\"\n    # Still exit success if we attempted uninstall - registry might be slow to update\n    Exit 0\n}\n\nWrite-Host \"Uninstall successful\"\nExit 0\n"
  }
}
