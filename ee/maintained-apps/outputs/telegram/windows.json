{
  "versions": [
    {
      "version": "6.3.1",
      "queries": {
        "exists": "SELECT 1 FROM programs WHERE name = 'Telegram Desktop' AND publisher = 'Telegram FZ-LLC';"
      },
      "installer_url": "https://td.telegram.org/tx64/tportable-x64.6.3.1.zip",
      "install_script_ref": "afca94fd",
      "uninstall_script_ref": "630a7674",
      "sha256": "057d2baf85dc04a68199f32a41bb3c1c12cc68798f3d8996eb6b6d7c6940056c",
      "default_categories": [
        "Communication"
      ]
    }
  ],
  "refs": {
    "630a7674": "# Telegram Desktop uninstall script\n# Removes the extracted Telegram Desktop files and any registry entries\n\n$displayName = \"Telegram Desktop\"\n$publisher = \"Telegram FZ-LLC\"\n\n# Determine installation directory\n$installDir = Join-Path $env:LOCALAPPDATA \"Programs\\Telegram Desktop\"\n\n# Kill any running Telegram processes before uninstalling\nStop-Process -Name \"Telegram\" -Force -ErrorAction SilentlyContinue\n\n# Wait a moment for processes to terminate\nStart-Sleep -Seconds 2\n\n# Remove installation directory\nif (Test-Path $installDir) {\n    try {\n        Remove-Item -Path $installDir -Recurse -Force -ErrorAction Stop\n        Write-Host \"Removed installation directory: $installDir\"\n    } catch {\n        Write-Host \"Warning: Could not remove installation directory: $_\"\n    }\n}\n\n# Attempt to remove registry entries if they exist\n$paths = @(\n    'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall',\n    'HKLM:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall',\n    'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall',\n    'HKCU:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall'\n)\n\n$removed = $false\nforeach ($p in $paths) {\n    try {\n        $items = Get-ItemProperty \"$p\\*\" -ErrorAction SilentlyContinue | Where-Object {\n            $_.DisplayName -and ($_.DisplayName -eq $displayName -or $_.DisplayName -like \"$displayName*\")\n        }\n        if ($items) {\n            foreach ($item in $items) {\n                $keyName = Split-Path -Leaf $item.PSPath\n                Remove-Item -Path \"$p\\$keyName\" -Force -ErrorAction SilentlyContinue\n                Write-Host \"Removed registry entry: $p\\$keyName\"\n                $removed = $true\n            }\n        }\n    } catch {\n        # Ignore registry errors\n    }\n}\n\nif (-not $removed -and -not (Test-Path $installDir)) {\n    Write-Host \"Uninstall completed (no registry entries found)\"\n}\n\nExit 0\n\n",
    "afca94fd": "# Telegram Desktop ZIP installer script\n# Telegram Desktop is distributed as a portable ZIP archive that needs to be extracted\n\n$zipFilePath = \"${env:INSTALLER_PATH}\"\n\ntry {\n    # Determine installation directory based on scope\n    # For user scope (empty), install to LocalAppData\\Programs\n    # For machine scope, install to ProgramFiles\n    $installDir = Join-Path $env:LOCALAPPDATA \"Programs\\Telegram Desktop\"\n    \n    # Create a temporary directory for extraction\n    $tempExtractDir = Join-Path $env:TEMP \"TelegramDesktopExtract\"\n    if (Test-Path $tempExtractDir) {\n        Remove-Item -Path $tempExtractDir -Recurse -Force\n    }\n    New-Item -ItemType Directory -Path $tempExtractDir -Force | Out-Null\n    \n    # Extract ZIP file to temporary directory\n    Expand-Archive -Path $zipFilePath -DestinationPath $tempExtractDir -Force\n    \n    # Find Telegram.exe in the extracted contents (could be in root or subdirectory)\n    $telegramExe = Get-ChildItem -Path $tempExtractDir -Filter \"Telegram.exe\" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1\n    \n    if (-not $telegramExe) {\n        Write-Host \"Error: Telegram.exe not found in ZIP archive\"\n        Remove-Item -Path $tempExtractDir -Recurse -Force -ErrorAction SilentlyContinue\n        Exit 1\n    }\n    \n    # Get the directory containing Telegram.exe (could be root or subdirectory)\n    $sourceDir = $telegramExe.DirectoryName\n    \n    # Create installation directory if it doesn't exist\n    if (Test-Path $installDir) {\n        Remove-Item -Path $installDir -Recurse -Force\n    }\n    New-Item -ItemType Directory -Path $installDir -Force | Out-Null\n    \n    # Copy all files from source directory to installation directory\n    Copy-Item -Path \"$sourceDir\\*\" -Destination $installDir -Recurse -Force\n    \n    # Clean up temporary extraction directory\n    Remove-Item -Path $tempExtractDir -Recurse -Force -ErrorAction SilentlyContinue\n    \n    # Verify installation succeeded\n    $installedExe = Join-Path $installDir \"Telegram.exe\"\n    if (-not (Test-Path $installedExe)) {\n        Write-Host \"Error: Telegram.exe not found after installation\"\n        Exit 1\n    }\n    \n    Write-Host \"Telegram Desktop installed successfully to: $installDir\"\n    Exit 0\n    \n} catch {\n    Write-Host \"Error: $_\"\n    Exit 1\n}\n\n"
  }
}
