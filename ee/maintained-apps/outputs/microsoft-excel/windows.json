{
  "versions": [
    {
      "version": "16.0.19426.20170",
      "queries": {
        "exists": "SELECT 1 FROM programs WHERE name = 'Microsoft Excel' AND publisher = 'Microsoft Corporation';"
      },
      "installer_url": "https://download.microsoft.com/download/6c1eeb25-cf8b-41d9-8d0d-cc1dbc032140/officedeploymenttool_19426-20170.exe",
      "install_script_ref": "18ece7ec",
      "uninstall_script_ref": "f5205026",
      "sha256": "no_check",
      "default_categories": [
        "Productivity"
      ]
    }
  ],
  "refs": {
    "18ece7ec": "# Microsoft Excel (Microsoft 365) - Install Script\n# Installs Excel via ODT, preserving any existing Office apps\n\n$ErrorActionPreference = \"Stop\"\n\n# Create working directory\n$odtPath = \"$env:TEMP\\odt_excel_$(Get-Random)\"\nNew-Item -ItemType Directory -Path $odtPath -Force | Out-Null\n\ntry {\n    # The installer downloaded by Fleet is the ODT self-extractor\n    $installerPath = $env:INSTALLER_PATH\n    \n    # Extract ODT\n    Start-Process -FilePath $installerPath -ArgumentList \"/quiet /extract:`\"$odtPath`\"\" -Wait -NoNewWindow\n    \n    # Detect existing Office installation and which apps are installed\n    $clickToRunPath = \"HKLM:\\SOFTWARE\\Microsoft\\Office\\ClickToRun\\Configuration\"\n    $existingApps = @()\n    \n    if (Test-Path $clickToRunPath) {\n        # Get the current configuration\n        $excludedApps = (Get-ItemProperty -Path $clickToRunPath -Name \"O365BusinessRetail.ExcludedApps\" -ErrorAction SilentlyContinue).\"O365BusinessRetail.ExcludedApps\"\n        \n        # All possible apps\n        $allApps = @(\"Access\", \"Excel\", \"Groove\", \"Lync\", \"OneDrive\", \"OneNote\", \"Outlook\", \"PowerPoint\", \"Publisher\", \"Teams\", \"Word\")\n        \n        if ($excludedApps) {\n            # Parse excluded apps and determine what's currently installed\n            $excludedList = $excludedApps -split \",\"\n            $existingApps = $allApps | Where-Object { $_ -notin $excludedList }\n        }\n    }\n    \n    # Build exclusion list - exclude everything EXCEPT Excel and any existing apps\n    $appsToInstall = @(\"Excel\") + $existingApps | Select-Object -Unique\n    $appsToExclude = @(\"Access\", \"Excel\", \"Groove\", \"Lync\", \"OneDrive\", \"OneNote\", \"Outlook\", \"PowerPoint\", \"Publisher\", \"Teams\", \"Word\") | Where-Object { $_ -notin $appsToInstall }\n    \n    # Build ExcludeApp XML elements\n    $excludeElements = ($appsToExclude | ForEach-Object { \"      <ExcludeApp ID=`\"$_`\" />\" }) -join \"`n\"\n    \n    # Generate configuration XML\n    $configXml = @\"\n<Configuration>\n  <Add OfficeClientEdition=\"64\" Channel=\"Current\">\n    <Product ID=\"O365BusinessRetail\">\n      <Language ID=\"MatchOS\" />\n$excludeElements\n    </Product>\n  </Add>\n  <Property Name=\"AUTOACTIVATE\" Value=\"0\" />\n  <Property Name=\"FORCEAPPSHUTDOWN\" Value=\"TRUE\" />\n  <Updates Enabled=\"TRUE\" />\n  <Display Level=\"None\" AcceptEULA=\"TRUE\" />\n  <Logging Level=\"Standard\" Path=\"$env:TEMP\" />\n</Configuration>\n\"@\n\n    # Write config file\n    $configPath = \"$odtPath\\config.xml\"\n    $configXml | Out-File -FilePath $configPath -Encoding UTF8\n    \n    # Run ODT\n    $process = Start-Process -FilePath \"$odtPath\\setup.exe\" -ArgumentList \"/configure `\"$configPath`\"\" -Wait -PassThru -NoNewWindow\n    \n    $exitCode = $process.ExitCode\n}\ncatch {\n    Write-Error $_.Exception.Message\n    $exitCode = 1\n}\nfinally {\n    # Cleanup\n    Remove-Item -Path $odtPath -Recurse -Force -ErrorAction SilentlyContinue\n}\n\nexit $exitCode\n",
    "f5205026": "# Microsoft Excel (Microsoft 365) - Uninstall Script\n# Removes Excel while preserving other Office apps\n\n$ErrorActionPreference = \"Stop\"\n\n$odtPath = \"$env:TEMP\\odt_excel_uninstall_$(Get-Random)\"\nNew-Item -ItemType Directory -Path $odtPath -Force | Out-Null\n\ntry {\n    # Download ODT (needed for reconfiguration)\n    $odtUrl = \"https://officecdn.microsoft.com/pr/wsus/setup.exe\"\n    $setupPath = \"$odtPath\\setup.exe\"\n    \n    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\n    Invoke-WebRequest -Uri $odtUrl -OutFile $setupPath -UseBasicParsing\n    \n    # Detect existing Office apps\n    $clickToRunPath = \"HKLM:\\SOFTWARE\\Microsoft\\Office\\ClickToRun\\Configuration\"\n    $existingApps = @()\n    \n    if (Test-Path $clickToRunPath) {\n        $excludedApps = (Get-ItemProperty -Path $clickToRunPath -Name \"O365BusinessRetail.ExcludedApps\" -ErrorAction SilentlyContinue).\"O365BusinessRetail.ExcludedApps\"\n        \n        $allApps = @(\"Access\", \"Excel\", \"Groove\", \"Lync\", \"OneDrive\", \"OneNote\", \"Outlook\", \"PowerPoint\", \"Publisher\", \"Teams\", \"Word\")\n        \n        if ($excludedApps) {\n            $excludedList = $excludedApps -split \",\"\n            $existingApps = $allApps | Where-Object { $_ -notin $excludedList }\n        }\n    }\n    \n    # Remove Excel from the list of installed apps\n    $appsToKeep = $existingApps | Where-Object { $_ -ne \"Excel\" }\n    \n    if ($appsToKeep.Count -eq 0) {\n        # No other Office apps installed - remove Office entirely\n        $configXml = @\"\n<Configuration>\n  <Remove All=\"TRUE\" />\n  <Property Name=\"FORCEAPPSHUTDOWN\" Value=\"TRUE\" />\n  <Display Level=\"None\" AcceptEULA=\"TRUE\" />\n</Configuration>\n\"@\n    }\n    else {\n        # Other apps exist - reconfigure to exclude Excel\n        $appsToExclude = @(\"Access\", \"Excel\", \"Groove\", \"Lync\", \"OneDrive\", \"OneNote\", \"Outlook\", \"PowerPoint\", \"Publisher\", \"Teams\", \"Word\") | Where-Object { $_ -notin $appsToKeep }\n        $excludeElements = ($appsToExclude | ForEach-Object { \"      <ExcludeApp ID=`\"$_`\" />\" }) -join \"`n\"\n        \n        $configXml = @\"\n<Configuration>\n  <Add OfficeClientEdition=\"64\" Channel=\"Current\">\n    <Product ID=\"O365BusinessRetail\">\n      <Language ID=\"MatchOS\" />\n$excludeElements\n    </Product>\n  </Add>\n  <Property Name=\"FORCEAPPSHUTDOWN\" Value=\"TRUE\" />\n  <Display Level=\"None\" AcceptEULA=\"TRUE\" />\n</Configuration>\n\"@\n    }\n    \n    # Write config\n    $configPath = \"$odtPath\\config.xml\"\n    $configXml | Out-File -FilePath $configPath -Encoding UTF8\n    \n    # Run ODT\n    $process = Start-Process -FilePath $setupPath -ArgumentList \"/configure `\"$configPath`\"\" -Wait -PassThru -NoNewWindow\n    \n    $exitCode = $process.ExitCode\n}\ncatch {\n    Write-Error $_.Exception.Message\n    $exitCode = 1\n}\nfinally {\n    Remove-Item -Path $odtPath -Recurse -Force -ErrorAction SilentlyContinue\n}\n\nexit $exitCode\n"
  }
}
