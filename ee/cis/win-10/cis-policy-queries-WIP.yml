---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Configure SMB v1 client driver' is set to 'Enabled: Disable driver (recommended)'
  platforms: win10
  platform: windows
  description: |
    This setting configures the start type for the Server Message Block version 1 (SMBv1) client driver service (MRxSmb10), which is recommended to be disabled.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Disable driver (recommended)':
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\Configure SMB v1 client driver'
    Note: This Group Policy path does not exist by default. An additional Group Policy template (SecGuide.admx/adml) is required - it is available from Microsoft at this link (https://techcommunity.microsoft.com/t5/microsoft-security-baselines/security-baseline-final-for-windows-10-v1903-and-windows-server/ba-p/701084).
  query: |
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MrxSmb10\Start' AND data = 4);
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.3.2, CIS_group_policy_template_required
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Configure SMB v1 server' is set to 'Disabled'
  platforms: win10
  platform: windows
  description: |
    This setting configures the server-side processing of the Server Message Block version 1 (SMBv1) protocol.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\Configure SMB v1 server'
    Note: This Group Policy path does not exist by default. An additional Group Policy template (SecGuide.admx/adml) is required - it is available from Microsoft at this link (https://techcommunity.microsoft.com/t5/microsoft-security-baselines/security-baseline-final-for-windows-10-v1903-and-windows-server/ba-p/701084).
  query: |
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\SMB1' AND data = 0);
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.3.3, CIS_group_policy_template_required
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Limits print driver installation to Administrators' is set to 'Enabled'
  platforms: win10
  platform: windows
  description: |
    This policy setting controls whether users that aren't Administrators can install print drivers on the system.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Enabled.
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\Limits print driver installation to Administrators'
    Note: This Group Policy path does not exist by default. An additional Group Policy template (SecGuide.admx/adml) is required - it is available from Microsoft at this link (https://techcommunity.microsoft.com/t5/microsoft-security-baselines/security-baseline-final-for-windows-10-v1903-and-windows-server/ba-p/701084).
  query: |
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Printers\\PointAndPrint\RestrictDriverInstallationToAdministrators' AND data = 1);
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.3.5, CIS_group_policy_template_required
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'NetBT NodeType configuration' is set to 'Enabled: P-node (recommended)'
  platforms: win10
  platform: windows
  description: |
    This setting determines which method NetBIOS over TCP/IP (NetBT) uses to register and resolve names. The available methods are:
    The B-node (broadcast) method only uses broadcasts.
    The P-node (point-to-point) method only uses name queries to a name server (WINS).
    The M-node (mixed) method broadcasts first, then queries a name server (WINS) if broadcast failed.
    The H-node (hybrid) method queries a name server (WINS) first, then broadcasts if the query failed.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Enabled: P-node (recommended):
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\NetBT NodeType configuration'
    Note: This change does not take effect until the computer has been restarted.
    Note: This Group Policy path does not exist by default. An additional Group Policy template (SecGuide.admx/adml) is required - it is available from Microsoft at this link (https://techcommunity.microsoft.com/t5/microsoft-security-baselines/security-baseline-final-for-windows-10-v1903-and-windows-server/ba-p/701084).
  query: |
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\NetBT\\Parameters\NodeType' AND data = 2);
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.3.6, CIS_group_policy_template_required
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'WDigest Authentication' is set to 'Disabled'
  platforms: win10
  platform: windows
  description: |
    When WDigest authentication is enabled, Lsass.exe retains a copy of the user's plaintext password in memory, where it can be at risk of theft. If this setting is not configured, WDigest authentication is disabled in Windows 8.1 and in Windows Server 2012 R2; it is enabled by default in earlier versions of Windows and Windows Server.
    For more information about local accounts and credential theft, review the "Mitigating Pass-the-Hash (PtH) Attacks and Other Credential Theft Techniques" documents.
    For more information about UseLogonCredential, see Microsoft Knowledge Base article 2871997: Microsoft Security Advisory Update to improve credentials protection and management May 13, 2014.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\MS Security Guide\WDigest Authentication (disabling may require KB2871997)'
    Note: This Group Policy path does not exist by default. An additional Group Policy template (SecGuide.admx/adml) is required - it is available from Microsoft at this link (https://techcommunity.microsoft.com/t5/microsoft-security-baselines/security-baseline-final-for-windows-10-v1903-and-windows-server/ba-p/701084).
  query: |
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\UseLogonCredential' AND data = 0);
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.3.7, CIS_group_policy_template_required
  contributors: rachelelysia
---

