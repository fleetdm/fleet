apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Allow Diagnostic Data' is set to 'Enabled: Diagnostic data off (not recommended)' or 'Enabled: Send required diagnostic data'
  platforms: win10
  platform: windows
  description: |
    This policy setting determines the amount of diagnostic and usage data reported to Microsoft:
    - A value of (0) Diagnostic data off (not recommended). Using this value, no diagnostic data is sent from the device. This value is only supported on Enterprise, Education, and Server editions. If you choose this setting, devices in your organization will still be secure.
    - A value of (1) Send required diagnostic data. This is the minimum diagnostic data necessary to keep Windows secure, up to date, and performing as expected. Using this value disables the Optional diagnostic data control in the Settings app.
    - A value of (3)Send optional diagnostic data. Additional diagnostic data is collected that helps us to detect, diagnose and fix issues, as well as make product improvements. Required diagnostic data will always be included when you choose to send optional diagnostic data. Optional diagnostic data can also include diagnostic log files and crash dumps. Use the Limit Dump Collection and the Limit Diagnostic Log Collection policies for more granular control of what optional diagnostic data is sent.
    Windows telemetry settings apply to the Windows operating system and some first party apps. This setting does not apply to third party apps running on Windows 10/11.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Enabled: 'Diagnostic data off (not recommended)' or Enabled: 'Send required diagnostic data':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Allow Telemetry'
  query: |
    TODO
    # DataCollection not updated with change
    Untested: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\AllowTelemetry' AND (data = 0 OR data = 1));
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.9.1
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Configure Authenticated Proxy usage for the Connected User Experience and Telemetry service' is set to 'Enabled: Disable Authenticated Proxy usage'
  platforms: win10
  platform: windows
  description: |
    This policy setting controls whether the Connected User Experience and Telemetry service can automatically use an authenticated proxy to send data back to Microsoft.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to 'Enabled: Disable Authenticated Proxy usage':
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Configure Authenticated Proxy usage for the Connected User Experience and Telemetry service'
  query: |
    TODO
    Untested: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\DisableEnterpriseAuthProxy' AND data = 1);
  purpose: Informational
  tags: compliance, CIS, CIS_Level2, CIS_win10_enterprise_1.12.0, CIS_bullet_18.9.17.2
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Disable OneSettings Downloads' is set to 'Enabled'
  platforms: win10
  platform: windows
  description: |
    This policy setting controls whether Windows attempts to connect with the OneSettings service to download configuration settings.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Disable OneSettings Downloads'
  query: |
    TODO
    # Disable OneSettings Downloads does not exist in group policy editor
    # Untested: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\DisableOneSettingsDownloads' AND data = 1);
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.9.17.3
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Do not show feedback notifications' is set to 'Enabled'
  platforms: win10
  platform: windows
  description: |
    This policy setting allows an organization to prevent its devices from showing feedback questions from Microsoft.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Do not show feedback notifications'
  query: |
    TODO
    # Path is not being created on change
    # Untested: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\DoNotShowFeedbackNotifications' AND data = 1);
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.9.17.4
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Enable OneSettings Auditing' is set to 'Enabled'
  platforms: win10
  platform: windows
  description: |
    This policy setting controls whether Windows records attempts to connect with the OneSettings service to the Operational EventLog.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Enable OneSettings Auditing'
  query: |
    TODO
    # Enable OneSettings Auditing does not exist in group policy editor
    # Untested: SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\DataCollection\EnableOneSettingsAuditing' AND data = 1);
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.9.17.5
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Limit Diagnostic Log Collection' is set to 'Enabled'
  platforms: win10
  platform: windows
  description: |
    This policy setting controls whether additional diagnostic logs are collected when more information is needed to troubleshoot a problem on the device.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Enabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Limit Diagnostic Log Collection'
  query: |
    TODO
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\LimitDiagnosticLogCollection' AND data = );
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.9.17.6
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Limit Dump Collection' is set to 'Enabled'
  platforms: win10
  platform: windows
  description: |
    This policy setting limits the type of dumps that can be collected when more information is needed to troubleshoot a problem.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Enabled.
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Limit Dump Collection'
  query: |
    TODO
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection\LimitDumpCollection' AND data = );
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.9.17.7
  contributors: rachelelysia
---
apiVersion: v1
kind: policy
spec:
  name: >
    CIS - Ensure 'Toggle user control over Insider builds' is set to 'Disabled'
  platforms: win10
  platform: windows
  description: |
    This policy setting determines whether users can access the Insider build controls in the Advanced Options for Windows Update. These controls are located under "Get Insider builds," and enable users to make their devices available for downloading and installing Windows preview software.
  resolution: |
    To establish the recommended configuration via GP, set the following UI path to Disabled:
    'Computer Configuration\Policies\Administrative Templates\Windows Components\Data Collection and Preview Builds\Toggle user control over Insider builds'
  query: |
    TODO
    SELECT 1 FROM registry WHERE (path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\PreviewBuilds\AllowBuildPreview' AND data = );
  purpose: Informational
  tags: compliance, CIS, CIS_Level1, CIS_win10_enterprise_1.12.0, CIS_bullet_18.9.17.8
  contributors: rachelelysia
---

