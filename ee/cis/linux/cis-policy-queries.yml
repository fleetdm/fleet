---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.1 Ensure cramfs kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure cramfs kernel module is not available (Automated)
  resolution: |
    Disable kernel module cramfs (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^cramfs '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/cramfs.conf`) with `install cramfs /bin/false` and `blacklist cramfs`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe cramfs` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='cramfs') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist cramfs%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install cramfs /bin/false%' OR line LIKE 'install cramfs /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.2 Ensure freevxfs kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure freevxfs kernel module is not available (Automated)
  resolution: |
    Disable kernel module freevxfs (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^freevxfs '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/freevxfs.conf`) with `install freevxfs /bin/false` and `blacklist freevxfs`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe freevxfs` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='freevxfs') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist freevxfs%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install freevxfs /bin/false%' OR line LIKE 'install freevxfs /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.4 Ensure hfsplus kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure hfsplus kernel module is not available (Automated)
  resolution: |
    Disable kernel module hfsplus (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^hfsplus '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/hfsplus.conf`) with `install hfsplus /bin/false` and `blacklist hfsplus`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe hfsplus` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='hfsplus') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist hfsplus%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install hfsplus /bin/false%' OR line LIKE 'install hfsplus /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.5 Ensure jffs2 kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure jffs2 kernel module is not available (Automated)
  resolution: |
    Disable kernel module jffs2 (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^jffs2 '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/jffs2.conf`) with `install jffs2 /bin/false` and `blacklist jffs2`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe jffs2` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='jffs2') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist jffs2%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install jffs2 /bin/false%' OR line LIKE 'install jffs2 /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.6 Ensure overlay kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure overlay kernel module is not available (Automated)
  resolution: |
    Disable kernel module overlay (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^overlay '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/overlay.conf`) with `install overlay /bin/false` and `blacklist overlay`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe overlay` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='overlay') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist overlay%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install overlay /bin/false%' OR line LIKE 'install overlay /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.7 Ensure squashfs kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure squashfs kernel module is not available (Automated)
  resolution: |
    Disable kernel module squashfs (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^squashfs '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/squashfs.conf`) with `install squashfs /bin/false` and `blacklist squashfs`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe squashfs` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='squashfs') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist squashfs%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install squashfs /bin/false%' OR line LIKE 'install squashfs /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.8 Ensure udf kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure udf kernel module is not available (Automated)
  resolution: |
    Disable kernel module udf (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^udf '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/udf.conf`) with `install udf /bin/false` and `blacklist udf`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe udf` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='udf') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist udf%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install udf /bin/false%' OR line LIKE 'install udf /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.9 Ensure usb -storage kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure usb -storage kernel module is not available (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.10 Ensure unused filesystems kernel modules are not available (Manual)
  platforms: linux
  platform: linux
  description: Ensure unused filesystems kernel modules are not available (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.11 Ensure firewire -core kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure firewire -core kernel module is not available (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.1.1 Ensure /tmp is tmpfs or a separate partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure /tmp is tmpfs or a separate partition (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.1.2 Ensure nodev option set on /tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /tmp partition (Automated)
  resolution: |
    Add `nodev` to the mount options for /tmp in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /tmp`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /tmp is mounted and includes `nodev` in mount options (e.g., `mount | grep ' on /tmp '` shows `nodev`).
  # - To make it FAIL:
  #   - Remount /tmp without `nodev` (edit /etc/fstab options and `sudo mount -o remount /tmp`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/tmp' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nodev'
              OR flags LIKE 'nodev,%'
              OR flags LIKE '%,nodev'
              OR flags LIKE '%,nodev,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.1.3 Ensure nosuid option set on /tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /tmp partition (Automated)
  resolution: |
    Add `nosuid` to the mount options for /tmp in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /tmp`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /tmp is mounted and includes `nosuid` in mount options (e.g., `mount | grep ' on /tmp '` shows `nosuid`).
  # - To make it FAIL:
  #   - Remount /tmp without `nosuid` (edit /etc/fstab options and `sudo mount -o remount /tmp`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/tmp' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nosuid'
              OR flags LIKE 'nosuid,%'
              OR flags LIKE '%,nosuid'
              OR flags LIKE '%,nosuid,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.1.4 Ensure noexec option set on /tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /tmp partition (Automated)
  resolution: |
    Add `noexec` to the mount options for /tmp in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /tmp`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /tmp is mounted and includes `noexec` in mount options (e.g., `mount | grep ' on /tmp '` shows `noexec`).
  # - To make it FAIL:
  #   - Remount /tmp without `noexec` (edit /etc/fstab options and `sudo mount -o remount /tmp`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/tmp' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'noexec'
              OR flags LIKE 'noexec,%'
              OR flags LIKE '%,noexec'
              OR flags LIKE '%,noexec,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.2.1 Ensure /dev/shm is tmpfs or a separate partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure /dev/shm is tmpfs or a separate partition (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.2.2 Ensure nodev option set on /dev/shm partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /dev/shm partition (Automated)
  resolution: |
    Add `nodev` to the mount options for /dev/shm in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /dev/shm`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /dev/shm is mounted and includes `nodev` in mount options (e.g., `mount | grep ' on /dev/shm '` shows `nodev`).
  # - To make it FAIL:
  #   - Remount /dev/shm without `nodev` (edit /etc/fstab options and `sudo mount -o remount /dev/shm`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/dev/shm' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nodev'
              OR flags LIKE 'nodev,%'
              OR flags LIKE '%,nodev'
              OR flags LIKE '%,nodev,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.2.3 Ensure nosuid option set on /dev/shm partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /dev/shm partition (Automated)
  resolution: |
    Add `nosuid` to the mount options for /dev/shm in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /dev/shm`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /dev/shm is mounted and includes `nosuid` in mount options (e.g., `mount | grep ' on /dev/shm '` shows `nosuid`).
  # - To make it FAIL:
  #   - Remount /dev/shm without `nosuid` (edit /etc/fstab options and `sudo mount -o remount /dev/shm`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/dev/shm' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nosuid'
              OR flags LIKE 'nosuid,%'
              OR flags LIKE '%,nosuid'
              OR flags LIKE '%,nosuid,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.2.4 Ensure noexec option set on /dev/shm partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /dev/shm partition (Automated)
  resolution: |
    Add `noexec` to the mount options for /dev/shm in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /dev/shm`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /dev/shm is mounted and includes `noexec` in mount options (e.g., `mount | grep ' on /dev/shm '` shows `noexec`).
  # - To make it FAIL:
  #   - Remount /dev/shm without `noexec` (edit /etc/fstab options and `sudo mount -o remount /dev/shm`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/dev/shm' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'noexec'
              OR flags LIKE 'noexec,%'
              OR flags LIKE '%,noexec'
              OR flags LIKE '%,noexec,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.3.1 Ensure separate partition exists for /home (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /home (Automated)
  resolution: |
    Create a dedicated partition/LV for /home (automated) and mount it via /etc/fstab (or systemd mount unit), then `mount -a`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Create a dedicated mount for /home (automated) and ensure `mount | grep ' on /home (automated) '` shows it.
  # - To make it FAIL:
  #   - Remove/comment the /home (automated) entry from /etc/fstab (or disable its systemd mount unit) so /home (automated) is not a separate mount.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM mounts WHERE path = '/home (automated)');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.3.2 Ensure nodev option set on /home partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /home partition (Automated)
  resolution: |
    Add `nodev` to the mount options for /home in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /home`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /home is mounted and includes `nodev` in mount options (e.g., `mount | grep ' on /home '` shows `nodev`).
  # - To make it FAIL:
  #   - Remount /home without `nodev` (edit /etc/fstab options and `sudo mount -o remount /home`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/home' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nodev'
              OR flags LIKE 'nodev,%'
              OR flags LIKE '%,nodev'
              OR flags LIKE '%,nodev,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.3.3 Ensure nosuid option set on /home partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /home partition (Automated)
  resolution: |
    Add `nosuid` to the mount options for /home in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /home`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /home is mounted and includes `nosuid` in mount options (e.g., `mount | grep ' on /home '` shows `nosuid`).
  # - To make it FAIL:
  #   - Remount /home without `nosuid` (edit /etc/fstab options and `sudo mount -o remount /home`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/home' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nosuid'
              OR flags LIKE 'nosuid,%'
              OR flags LIKE '%,nosuid'
              OR flags LIKE '%,nosuid,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.4.1 Ensure separate partition exists for /var (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /var (Automated)
  resolution: |
    Create a dedicated partition/LV for /var (automated) and mount it via /etc/fstab (or systemd mount unit), then `mount -a`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Create a dedicated mount for /var (automated) and ensure `mount | grep ' on /var (automated) '` shows it.
  # - To make it FAIL:
  #   - Remove/comment the /var (automated) entry from /etc/fstab (or disable its systemd mount unit) so /var (automated) is not a separate mount.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM mounts WHERE path = '/var (automated)');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.4.2 Ensure nodev option set on /var partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /var partition (Automated)
  resolution: |
    Add `nodev` to the mount options for /var in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var is mounted and includes `nodev` in mount options (e.g., `mount | grep ' on /var '` shows `nodev`).
  # - To make it FAIL:
  #   - Remount /var without `nodev` (edit /etc/fstab options and `sudo mount -o remount /var`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nodev'
              OR flags LIKE 'nodev,%'
              OR flags LIKE '%,nodev'
              OR flags LIKE '%,nodev,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.4.3 Ensure nosuid option set on /var partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /var partition (Automated)
  resolution: |
    Add `nosuid` to the mount options for /var in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var is mounted and includes `nosuid` in mount options (e.g., `mount | grep ' on /var '` shows `nosuid`).
  # - To make it FAIL:
  #   - Remount /var without `nosuid` (edit /etc/fstab options and `sudo mount -o remount /var`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nosuid'
              OR flags LIKE 'nosuid,%'
              OR flags LIKE '%,nosuid'
              OR flags LIKE '%,nosuid,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.5.1 Ensure separate partition exists for /var/tmp (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /var/tmp (Automated)
  resolution: |
    Create a dedicated partition/LV for /var/tmp (automated) and mount it via /etc/fstab (or systemd mount unit), then `mount -a`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Create a dedicated mount for /var/tmp (automated) and ensure `mount | grep ' on /var/tmp (automated) '` shows it.
  # - To make it FAIL:
  #   - Remove/comment the /var/tmp (automated) entry from /etc/fstab (or disable its systemd mount unit) so /var/tmp (automated) is not a separate mount.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM mounts WHERE path = '/var/tmp (automated)');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.5.2 Ensure nodev option set on /var/tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /var/tmp partition (Automated)
  resolution: |
    Add `nodev` to the mount options for /var/tmp in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/tmp`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/tmp is mounted and includes `nodev` in mount options (e.g., `mount | grep ' on /var/tmp '` shows `nodev`).
  # - To make it FAIL:
  #   - Remount /var/tmp without `nodev` (edit /etc/fstab options and `sudo mount -o remount /var/tmp`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/tmp' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nodev'
              OR flags LIKE 'nodev,%'
              OR flags LIKE '%,nodev'
              OR flags LIKE '%,nodev,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.5.3 Ensure nosuid option set on /var/tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /var/tmp partition (Automated)
  resolution: |
    Add `nosuid` to the mount options for /var/tmp in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/tmp`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/tmp is mounted and includes `nosuid` in mount options (e.g., `mount | grep ' on /var/tmp '` shows `nosuid`).
  # - To make it FAIL:
  #   - Remount /var/tmp without `nosuid` (edit /etc/fstab options and `sudo mount -o remount /var/tmp`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/tmp' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nosuid'
              OR flags LIKE 'nosuid,%'
              OR flags LIKE '%,nosuid'
              OR flags LIKE '%,nosuid,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.5.4 Ensure noexec option set on /var/tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /var/tmp partition (Automated)
  resolution: |
    Add `noexec` to the mount options for /var/tmp in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/tmp`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/tmp is mounted and includes `noexec` in mount options (e.g., `mount | grep ' on /var/tmp '` shows `noexec`).
  # - To make it FAIL:
  #   - Remount /var/tmp without `noexec` (edit /etc/fstab options and `sudo mount -o remount /var/tmp`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/tmp' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'noexec'
              OR flags LIKE 'noexec,%'
              OR flags LIKE '%,noexec'
              OR flags LIKE '%,noexec,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.6.1 Ensure separate partition exists for /var/log (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /var/log (Automated)
  resolution: |
    Create a dedicated partition/LV for /var/log (automated) and mount it via /etc/fstab (or systemd mount unit), then `mount -a`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Create a dedicated mount for /var/log (automated) and ensure `mount | grep ' on /var/log (automated) '` shows it.
  # - To make it FAIL:
  #   - Remove/comment the /var/log (automated) entry from /etc/fstab (or disable its systemd mount unit) so /var/log (automated) is not a separate mount.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM mounts WHERE path = '/var/log (automated)');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.6.2 Ensure nodev option set on /var/log partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /var/log partition (Automated)
  resolution: |
    Add `nodev` to the mount options for /var/log in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/log`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/log is mounted and includes `nodev` in mount options (e.g., `mount | grep ' on /var/log '` shows `nodev`).
  # - To make it FAIL:
  #   - Remount /var/log without `nodev` (edit /etc/fstab options and `sudo mount -o remount /var/log`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/log' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nodev'
              OR flags LIKE 'nodev,%'
              OR flags LIKE '%,nodev'
              OR flags LIKE '%,nodev,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.6.3 Ensure nosuid option set on /var/log partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /var/log partition (Automated)
  resolution: |
    Add `nosuid` to the mount options for /var/log in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/log`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/log is mounted and includes `nosuid` in mount options (e.g., `mount | grep ' on /var/log '` shows `nosuid`).
  # - To make it FAIL:
  #   - Remount /var/log without `nosuid` (edit /etc/fstab options and `sudo mount -o remount /var/log`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/log' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nosuid'
              OR flags LIKE 'nosuid,%'
              OR flags LIKE '%,nosuid'
              OR flags LIKE '%,nosuid,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.6.4 Ensure noexec option set on /var/log partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /var/log partition (Automated)
  resolution: |
    Add `noexec` to the mount options for /var/log in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/log`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/log is mounted and includes `noexec` in mount options (e.g., `mount | grep ' on /var/log '` shows `noexec`).
  # - To make it FAIL:
  #   - Remount /var/log without `noexec` (edit /etc/fstab options and `sudo mount -o remount /var/log`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/log' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'noexec'
              OR flags LIKE 'noexec,%'
              OR flags LIKE '%,noexec'
              OR flags LIKE '%,noexec,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.7.1 Ensure separate partition exists for /var/log/audit (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /var/log/audit (Automated)
  resolution: |
    Create a dedicated partition/LV for /var/log/audit (automated) and mount it via /etc/fstab (or systemd mount unit), then `mount -a`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Create a dedicated mount for /var/log/audit (automated) and ensure `mount | grep ' on /var/log/audit (automated) '` shows it.
  # - To make it FAIL:
  #   - Remove/comment the /var/log/audit (automated) entry from /etc/fstab (or disable its systemd mount unit) so /var/log/audit (automated) is not a separate mount.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM mounts WHERE path = '/var/log/audit (automated)');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.7.2 Ensure nodev option set on /var/log/audit partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /var/log/audit partition (Automated)
  resolution: |
    Add `nodev` to the mount options for /var/log/audit in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/log/audit`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/log/audit is mounted and includes `nodev` in mount options (e.g., `mount | grep ' on /var/log/audit '` shows `nodev`).
  # - To make it FAIL:
  #   - Remount /var/log/audit without `nodev` (edit /etc/fstab options and `sudo mount -o remount /var/log/audit`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/log/audit' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nodev'
              OR flags LIKE 'nodev,%'
              OR flags LIKE '%,nodev'
              OR flags LIKE '%,nodev,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.7.3 Ensure nosuid option set on /var/log/audit partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /var/log/audit partition (Automated)
  resolution: |
    Add `nosuid` to the mount options for /var/log/audit in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/log/audit`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/log/audit is mounted and includes `nosuid` in mount options (e.g., `mount | grep ' on /var/log/audit '` shows `nosuid`).
  # - To make it FAIL:
  #   - Remount /var/log/audit without `nosuid` (edit /etc/fstab options and `sudo mount -o remount /var/log/audit`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/log/audit' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'nosuid'
              OR flags LIKE 'nosuid,%'
              OR flags LIKE '%,nosuid'
              OR flags LIKE '%,nosuid,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.7.4 Ensure noexec option set on /var/log/audit partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /var/log/audit partition (Automated)
  resolution: |
    Add `noexec` to the mount options for /var/log/audit in /etc/fstab (or systemd mount), then remount: `sudo mount -o remount /var/log/audit`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure /var/log/audit is mounted and includes `noexec` in mount options (e.g., `mount | grep ' on /var/log/audit '` shows `noexec`).
  # - To make it FAIL:
  #   - Remount /var/log/audit without `noexec` (edit /etc/fstab options and `sudo mount -o remount /var/log/audit`) on a test host.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH m AS (SELECT flags FROM mounts WHERE path = '/var/log/audit' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM m)
      AND EXISTS (
        SELECT 1 FROM m WHERE
          flags = 'noexec'
              OR flags LIKE 'noexec,%'
              OR flags LIKE '%,noexec'
              OR flags LIKE '%,noexec,%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.2.1.1 Ensure GPG keys are configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure GPG keys are configured (Manual)
  resolution: |
    Manual: review APT repositories and keyrings; verify patching process per organizational policy.
  # Validation:
  # - Where: This requires human review of repo/key policy and patch compliance.
  # - To make it PASS:
  #   - Document your approved repositories/keys and verify the host matches them.
  #   - Verify the host is within patch policy (e.g., unattended-upgrades logs / apt history).
  # - To make it FAIL:
  #   - Add an unapproved repository/key (in a disposable VM) or stop applying updates beyond your policy window.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.2.1.2 Ensure package manager repositories are configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure package manager repositories are configured (Manual)
  resolution: |
    Manual: review APT repositories and keyrings; verify patching process per organizational policy.
  # Validation:
  # - Where: This requires human review of repo/key policy and patch compliance.
  # - To make it PASS:
  #   - Document your approved repositories/keys and verify the host matches them.
  #   - Verify the host is within patch policy (e.g., unattended-upgrades logs / apt history).
  # - To make it FAIL:
  #   - Add an unapproved repository/key (in a disposable VM) or stop applying updates beyond your policy window.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.2.2.1 Ensure updates, patches, and additional security software are installed (Manual)
  platforms: linux
  platform: linux
  description: Ensure updates, patches, and additional security software are installed (Manual)
  resolution: |
    Manual: review APT repositories and keyrings; verify patching process per organizational policy.
  # Validation:
  # - Where: This requires human review of repo/key policy and patch compliance.
  # - To make it PASS:
  #   - Document your approved repositories/keys and verify the host matches them.
  #   - Verify the host is within patch policy (e.g., unattended-upgrades logs / apt history).
  # - To make it FAIL:
  #   - Add an unapproved repository/key (in a disposable VM) or stop applying updates beyond your policy window.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.3.1.1 Ensure the apparmor packages are installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure the apparmor packages are installed (Automated)
  resolution: |
    Install AppArmor packages: `sudo apt-get install -y apparmor apparmor-utils`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Install packages `apparmor` and `apparmor-utils`.
  # - To make it FAIL:
  #   - Remove one of the packages (e.g., `sudo apt-get remove -y apparmor-utils`) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='apparmor')
      AND EXISTS (SELECT 1 FROM deb_packages WHERE name='apparmor-utils');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.3.1.2 Ensure AppArmor is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure AppArmor is enabled (Automated)
  resolution: |
    Enable AppArmor at boot and ensure it is running (e.g., `sudo systemctl enable --now apparmor`).
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Enable AppArmor and reboot if required; confirm `/sys/module/apparmor/parameters/enabled` is `Y`.
  # - To make it FAIL:
  #   - Disable AppArmor (kernel param or service) on a disposable VM so the enabled flag is not `Y`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM file WHERE path='/sys/module/apparmor/parameters/enabled')
      AND EXISTS (
        SELECT 1 FROM file_lines
        WHERE path='/sys/module/apparmor/parameters/enabled'
          AND (line='Y' OR line='y' OR line='1')
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.3.1.3 Ensure all AppArmor Profiles are not disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure all AppArmor Profiles are not disabled (Automated)
  resolution: |
    Remove disabled-profile symlinks/files under /etc/apparmor.d/disable/ and reload AppArmor.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `/etc/apparmor.d/disable/` is empty (or does not exist).
  # - To make it FAIL:
  #   - Create a dummy file or symlink under `/etc/apparmor.d/disable/` on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM file WHERE path='/etc/apparmor.d/disable' AND type='directory');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.3.1.4 Ensure all AppArmor Profiles are enforcing (Automated)
  platforms: linux
  platform: linux
  description: Ensure all AppArmor Profiles are enforcing (Automated)
  resolution: |
    Put any AppArmor profiles in complain mode into enforce mode (e.g., `sudo aa-enforce <profile>`).
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `aa-status` reports 0 profiles in complain mode.
  # - To make it FAIL:
  #   - On a test VM, set a profile to complain mode (`sudo aa-complain <profile>`) so `(complain)` appears.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM file WHERE path='/sys/kernel/security/apparmor/profiles')
      AND NOT EXISTS (
        SELECT 1 FROM file_lines
        WHERE path='/sys/kernel/security/apparmor/profiles'
          AND line LIKE '%(complain)%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.4.2 Ensure access to bootloader config is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to bootloader config is configured (Automated)
  resolution: |
    Ensure /boot/grub/grub.cfg is owned by root:root and not group/world writable (e.g., chmod 600).
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set owner root:root and permissions to 600 or 640 (or similarly restrictive).
  # - To make it FAIL:
  #   - Change permissions to be group/world writable (e.g., chmod 666) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/boot/grub/grub.cfg' AND uid = 0 AND gid = 0
        AND (mode = '0400' OR mode = '0440' OR mode = '0600' OR mode = '0640')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.1 Ensure randomize_va_space is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure randomize_va_space is configured (Automated)
  resolution: |
    Set `kernel.randomize_va_space=2` via sysctl and persist via /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `kernel.randomize_va_space` to `2` and persist it.
  # - To make it FAIL:
  #   - Set `kernel.randomize_va_space` to a different value on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='kernel.randomize_va_space' AND value='2');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.2 Ensure ptrace_scope is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ptrace_scope is configured (Automated)
  resolution: |
    Set `kernel.yama.ptrace_scope` to 1 or higher and persist via /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `kernel.yama.ptrace_scope` to `1` (or higher): `sudo sysctl -w kernel.yama.ptrace_scope=1` and persist it.
  # - To make it FAIL:
  #   - Set `kernel.yama.ptrace_scope` to 0 on a test VM so it is below 1.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='kernel.yama.ptrace_scope' AND CAST(value AS INTEGER) >= 1);
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.3 Ensure suid_dumpable is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure suid_dumpable is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.4 Ensure core file size is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure core file size is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.5 Ensure prelink is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure prelink is not installed (Automated)
  resolution: |
    Remove prelink: `sudo apt-get purge -y prelink`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `prelink` is not installed (`dpkg -l prelink` shows none).
  # - To make it FAIL:
  #   - Install prelink on a test VM (`sudo apt-get install -y prelink`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'prelink');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.6 Ensure Automatic Error Reporting is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure Automatic Error Reporting is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.1 Ensure /etc/motd is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure /etc/motd is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.2 Ensure /etc/issue is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure /etc/issue is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.3 Ensure /etc/issue.net is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure /etc/issue.net is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.4 Ensure access to /etc/motd is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/motd is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.5 Ensure access to /etc/issue is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/issue is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.6 Ensure access to /etc/issue.net is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/issue.net is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.1 Ensure GDM is removed (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM is removed (Automated)
  resolution: |
    Remove GDM if not required: `sudo apt-get purge -y gdm3`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure package gdm3 is not installed.
  # - To make it FAIL:
  #   - Install gdm3 on a test VM (`sudo apt-get install -y gdm3`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'gdm3');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.2 Ensure GDM login banner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM login banner is configured (Automated)
  resolution: |
    Configure dconf keyfile to enable banner-message and set banner-message-text; update dconf DB.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Create/update a dconf keyfile under `/etc/dconf/db/local.d/` with `banner-message-enable=true` and a non-empty `banner-message-text=`; run `sudo dconf update`.
  # - To make it FAIL:
  #   - Remove those dconf lines or set `banner-message-enable=false` in the keyfile on a test VM and run `sudo dconf update`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path LIKE '/etc/dconf/db/%'
        AND line LIKE '%banner-message-enable=true%'
    )
    AND EXISTS (
      SELECT 1 FROM file_lines
      WHERE path LIKE '/etc/dconf/db/%'
        AND line LIKE '%banner-message-text=%'
        AND line NOT LIKE '%banner-message-text=%""%'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.3 Ensure GDM disable -user-list option is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM disable -user-list option is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.4 Ensure GDM screen locks when the user is idle (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM screen locks when the user is idle (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.5 Ensure GDM screen locks cannot be overridden (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM screen locks cannot be overridden (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.6 Ensure GDM automatic mounting of removable media is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM automatic mounting of removable media is disabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.7 Ensure GDM disabling automatic mounting of removable media is not overridden
  platforms: linux
  platform: linux
  description: Ensure GDM disabling automatic mounting of removable media is not overridden
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.8 Ensure GDM autorun -never is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM autorun -never is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.9 Ensure GDM autorun -never is not overridden (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM autorun -never is not overridden (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.10 Ensure XDMCP is not enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure XDMCP is not enabled (Automated)
  resolution: |
    Ensure XDMCP is disabled in /etc/gdm3/custom.conf (do not set Enable=true).
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `/etc/gdm3/custom.conf` does not contain `Enable=true` under [xdmcp].
  # - To make it FAIL:
  #   - Add `Enable=true` (non-comment) in /etc/gdm3/custom.conf on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM file WHERE path='/etc/gdm3/custom.conf')
      AND NOT EXISTS (
        SELECT 1 FROM file_lines
        WHERE path='/etc/gdm3/custom.conf'
          AND line LIKE '%Enable=true%'
          AND line NOT LIKE '#%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.11 Ensure Xwayland is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure Xwayland is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.1 Ensure autofs services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure autofs services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: autofs.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now autofs.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('autofs.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.2 Ensure avahi daemon services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure avahi daemon services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: avahi-daemon.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now avahi-daemon.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('avahi-daemon.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.3 Ensure dhcp server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure dhcp server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: isc-dhcp-server.service, dhcpd.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now isc-dhcp-server.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('isc-dhcp-server.service','dhcpd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.4 Ensure dns server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure dns server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: bind9.service, named.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now bind9.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('bind9.service','named.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.5 Ensure dnsmasq services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure dnsmasq services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: dnsmasq.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now dnsmasq.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('dnsmasq.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.6 Ensure ftp server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure ftp server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: vsftpd.service, proftpd.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now vsftpd.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('vsftpd.service','proftpd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.7 Ensure ldap server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure ldap server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: slapd.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now slapd.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('slapd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.8 Ensure message access server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure message access server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: dovecot.service, courier-imap.service, cyrus-imapd.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now dovecot.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('dovecot.service','courier-imap.service','cyrus-imapd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.9 Ensure network file system services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure network file system services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: nfs-server.service, nfs-kernel-server.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now nfs-server.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('nfs-server.service','nfs-kernel-server.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.10 Ensure nis server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure nis server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: nis.service, ypserv.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now nis.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('nis.service','ypserv.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.11 Ensure print server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure print server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: cups.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now cups.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('cups.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.12 Ensure rpcbind services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure rpcbind services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: rpcbind.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now rpcbind.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('rpcbind.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.13 Ensure rsync services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsync services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: rsync.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now rsync.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('rsync.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.14 Ensure samba file server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure samba file server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: smbd.service, nmbd.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now smbd.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('smbd.service','nmbd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.15 Ensure snmp services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure snmp services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: snmpd.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now snmpd.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('snmpd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.16 Ensure tftp server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure tftp server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: tftpd.service, tftpd-hpa.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now tftpd.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('tftpd.service','tftpd-hpa.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.17 Ensure web proxy server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure web proxy server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: squid.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now squid.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('squid.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.18 Ensure web server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure web server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: apache2.service, nginx.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now apache2.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('apache2.service','nginx.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.19 Ensure xinetd services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure xinetd services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: xinetd.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now xinetd.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('xinetd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.20 Ensure X window server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure X window server services are not in use (Automated)
  resolution: |
    Disable or remove the service if not required.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure none of these services are active: display-manager.service, gdm.service, gdm3.service, lightdm.service (e.g., `sudo systemctl disable --now <service>`).
  # - To make it FAIL:
  #   - Start/enable one of the services on a test VM (`sudo systemctl enable --now display-manager.service`) if available.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('display-manager.service','gdm.service','gdm3.service','lightdm.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.21 Ensure mail transfer agents are configured for local -only mode (Automated)
  platforms: linux
  platform: linux
  description: Ensure mail transfer agents are configured for local -only mode (Automated)
  resolution: |
    Configure the MTA to listen only on loopback or remove/disable the MTA.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure no process is listening on TCP/25 on non-loopback addresses (check `ss -lntp | grep :25`).
  # - To make it FAIL:
  #   - Bind TCP/25 to 0.0.0.0 on a test VM (enable postfix/other MTA in internet site mode).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM listening_ports
      WHERE port=25 AND protocol=6
        AND address NOT IN ('127.0.0.1','::1')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.22 Ensure only approved services are listening on a network interface (Manual)
  platforms: linux
  platform: linux
  description: Ensure only approved services are listening on a network interface (Manual)
  resolution: |
    Manual: validate that only approved services are enabled and that the system role matches the enabled services.
  # Validation:
  # - Where: Requires organizational baseline for 'approved services'.
  # - To make it PASS:
  #   - Review `listening_ports` and enabled systemd units vs your approved baseline for this host role.
  # - To make it FAIL:
  #   - Enable a non-approved service or open a non-approved listening port on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.1 Ensure nis client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure nis client is not installed (Automated)
  resolution: |
    Remove the nis package if not required: `sudo apt-get purge -y nis`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `nis` is not installed (`dpkg -l nis` shows none).
  # - To make it FAIL:
  #   - Install `nis` on a test VM (`sudo apt-get install -y nis`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'nis');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.3 Ensure talk client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure talk client is not installed (Automated)
  resolution: |
    Remove the talk package if not required: `sudo apt-get purge -y talk`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `talk` is not installed (`dpkg -l talk` shows none).
  # - To make it FAIL:
  #   - Install `talk` on a test VM (`sudo apt-get install -y talk`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'talk');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.4 Ensure telnet client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure telnet client is not installed (Automated)
  resolution: |
    Remove the telnet package if not required: `sudo apt-get purge -y telnet`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `telnet` is not installed (`dpkg -l telnet` shows none).
  # - To make it FAIL:
  #   - Install `telnet` on a test VM (`sudo apt-get install -y telnet`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'telnet');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.5 Ensure ldap client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure ldap client is not installed (Automated)
  resolution: |
    Remove the ldap-utils package if not required: `sudo apt-get purge -y ldap-utils`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `ldap-utils` is not installed (`dpkg -l ldap-utils` shows none).
  # - To make it FAIL:
  #   - Install `ldap-utils` on a test VM (`sudo apt-get install -y ldap-utils`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'ldap-utils');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.6 Ensure ftp client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure ftp client is not installed (Automated)
  resolution: |
    Remove the ftp package if not required: `sudo apt-get purge -y ftp`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure `ftp` is not installed (`dpkg -l ftp` shows none).
  # - To make it FAIL:
  #   - Install `ftp` on a test VM (`sudo apt-get install -y ftp`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'ftp');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.1 Ensure time synchronization is in use
  platforms: linux
  platform: linux
  description: Ensure time synchronization is in use
  resolution: |
    Manual: ensure time synchronization is in use per policy.
  # Validation:
  # - Where: Requires reviewing time sync choice and policy.
  # - To make it PASS:
  #   - Confirm the host uses one time-sync mechanism and is in sync (chrony/timesyncd).
  # - To make it FAIL:
  #   - Disable time sync and skew time on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.1.1 Ensure a single time synchronization daemon is in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure a single time synchronization daemon is in use (Automated)
  resolution: |
    Ensure exactly one of systemd-timesyncd or chrony is active.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Enable exactly one: either `sudo systemctl enable --now systemd-timesyncd` OR `sudo systemctl enable --now chrony` (not both).
  # - To make it FAIL:
  #   - Enable both services at once, or disable both, on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH active AS (
      SELECT name FROM systemd_units
      WHERE name IN ('systemd-timesyncd.service','chrony.service')
        AND active_state='active'
    )
    SELECT 1 WHERE (SELECT COUNT(*) FROM active)=1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.2.1 Ensure systemd -timesyncd configured with authorized timeserver (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -timesyncd configured with authorized timeserver (Automated)
  resolution: |
    Set NTP= servers in /etc/systemd/timesyncd.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Add a non-empty `NTP=` line (e.g., `NTP=pool.ntp.org`) to /etc/systemd/timesyncd.conf (non-comment).
  # - To make it FAIL:
  #   - Remove or comment out the `NTP=` line, or leave it empty (`NTP=`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/systemd/timesyncd.conf'
        AND line LIKE 'NTP=%'
        AND line NOT LIKE '#%'
        AND line NOT LIKE 'NTP='
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.2.2 Ensure systemd -timesyncd is enabled and running (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -timesyncd is enabled and running (Automated)
  resolution: |
    Enable and start systemd-timesyncd.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Run `sudo systemctl enable --now systemd-timesyncd.service`.
  # - To make it FAIL:
  #   - Stop/disable it: `sudo systemctl disable --now systemd-timesyncd.service`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM systemd_units WHERE name = 'systemd-timesyncd.service' AND active_state = 'active');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.3.1 Ensure chrony is configured with authorized timeserver (Automated)
  platforms: linux
  platform: linux
  description: Ensure chrony is configured with authorized timeserver (Automated)
  resolution: |
    Configure chrony with server/pool lines in /etc/chrony/chrony.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Add at least one `server ...` or `pool ...` line (non-comment) to /etc/chrony/chrony.conf.
  # - To make it FAIL:
  #   - Comment out or remove all `server`/`pool` lines.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/chrony/chrony.conf'
        AND (line LIKE 'server %' OR line LIKE 'pool %')
        AND line NOT LIKE '#%'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.3.2 Ensure chrony is running as user _chrony (Automated)
  platforms: linux
  platform: linux
  description: Ensure chrony is running as user _chrony (Automated)
  resolution: |
    Ensure chronyd runs as user _chrony.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Install/enable chrony; ensure process `chronyd` is running and owned by `_chrony`.
  # - To make it FAIL:
  #   - Run chronyd as root (nonstandard) or stop chronyd on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    WITH chrony_uid AS (SELECT uid FROM users WHERE username='_chrony' LIMIT 1)
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM chrony_uid)
      AND EXISTS (SELECT 1 FROM processes WHERE name='chronyd' AND uid=(SELECT uid FROM chrony_uid));
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.3.3 Ensure chrony is enabled and running (Automated)
  platforms: linux
  platform: linux
  description: Ensure chrony is enabled and running (Automated)
  resolution: |
    Enable and start chrony.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Run `sudo systemctl enable --now chrony.service`.
  # - To make it FAIL:
  #   - Stop/disable it: `sudo systemctl disable --now chrony.service`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM systemd_units WHERE name = 'chrony.service' AND active_state = 'active');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.1 Ensure cron daemon is enabled and active (Automated)
  platforms: linux
  platform: linux
  description: Ensure cron daemon is enabled and active (Automated)
  resolution: |
    Enable and start cron.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Run `sudo systemctl enable --now cron.service`.
  # - To make it FAIL:
  #   - Stop/disable cron: `sudo systemctl disable --now cron.service`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM systemd_units WHERE name = 'cron.service' AND active_state = 'active');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.2 Ensure access to /etc/crontab is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/crontab is configured (Automated)
  resolution: |
    Ensure /etc/crontab is owned by root:root with restrictive permissions.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set owner root:root and permissions to one of ['0400', '0440', '0600', '0640'] (e.g., `sudo chown root:root /etc/crontab` and `sudo chmod 0400 /etc/crontab`).
  # - To make it FAIL:
  #   - Make it group/world writable on a test VM (e.g., `sudo chmod 777 /etc/crontab`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/crontab' AND uid = 0 AND gid = 0
        AND (mode = '0400' OR mode = '0440' OR mode = '0600' OR mode = '0640')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.3 Ensure access to /etc/cron.hourly is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.hourly is configured (Automated)
  resolution: |
    Ensure /etc/cron.hourly is owned by root:root with restrictive permissions.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set owner root:root and permissions to one of ['0700'] (e.g., `sudo chown root:root /etc/cron.hourly` and `sudo chmod 0700 /etc/cron.hourly`).
  # - To make it FAIL:
  #   - Make it group/world writable on a test VM (e.g., `sudo chmod 777 /etc/cron.hourly`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.hourly' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND (mode = '0700')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.4 Ensure access to /etc/cron.daily is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.daily is configured (Automated)
  resolution: |
    Ensure /etc/cron.daily is owned by root:root with restrictive permissions.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set owner root:root and permissions to one of ['0700'] (e.g., `sudo chown root:root /etc/cron.daily` and `sudo chmod 0700 /etc/cron.daily`).
  # - To make it FAIL:
  #   - Make it group/world writable on a test VM (e.g., `sudo chmod 777 /etc/cron.daily`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.daily' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND (mode = '0700')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.5 Ensure access to /etc/cron.weekly is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.weekly is configured (Automated)
  resolution: |
    Ensure /etc/cron.weekly is owned by root:root with restrictive permissions.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set owner root:root and permissions to one of ['0700'] (e.g., `sudo chown root:root /etc/cron.weekly` and `sudo chmod 0700 /etc/cron.weekly`).
  # - To make it FAIL:
  #   - Make it group/world writable on a test VM (e.g., `sudo chmod 777 /etc/cron.weekly`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.weekly' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND (mode = '0700')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.6 Ensure access to /etc/cron.monthly is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.monthly is configured (Automated)
  resolution: |
    Ensure /etc/cron.monthly is owned by root:root with restrictive permissions.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set owner root:root and permissions to one of ['0700'] (e.g., `sudo chown root:root /etc/cron.monthly` and `sudo chmod 0700 /etc/cron.monthly`).
  # - To make it FAIL:
  #   - Make it group/world writable on a test VM (e.g., `sudo chmod 777 /etc/cron.monthly`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.monthly' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND (mode = '0700')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.7 Ensure access to /etc/cron.yearly is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.yearly is configured (Automated)
  resolution: |
    Ensure /etc/cron.yearly is owned by root:root with restrictive permissions.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set owner root:root and permissions to one of ['0700'] (e.g., `sudo chown root:root /etc/cron.yearly` and `sudo chmod 0700 /etc/cron.yearly`).
  # - To make it FAIL:
  #   - Make it group/world writable on a test VM (e.g., `sudo chmod 777 /etc/cron.yearly`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.yearly' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND (mode = '0700')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.8 Ensure access to /etc/cron.d is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.d is configured (Automated)
  resolution: |
    Ensure /etc/cron.d is owned by root:root with restrictive permissions.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set owner root:root and permissions to one of ['0700'] (e.g., `sudo chown root:root /etc/cron.d` and `sudo chmod 0700 /etc/cron.d`).
  # - To make it FAIL:
  #   - Make it group/world writable on a test VM (e.g., `sudo chmod 777 /etc/cron.d`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.d' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND (mode = '0700')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.9 Ensure access to crontab is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to crontab is configured (Automated)
  resolution: |
    Restrict cron to authorized users via /etc/cron.allow and remove /etc/cron.deny.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Create /etc/cron.allow (root owned, restrictive perms) and ensure /etc/cron.deny does not exist.
  # - To make it FAIL:
  #   - Create /etc/cron.deny on a test VM (or remove /etc/cron.allow).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM file WHERE path='/etc/cron.allow')
      AND NOT EXISTS (SELECT 1 FROM file WHERE path='/etc/cron.deny');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.2.1 Ensure access to at is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to at is configured (Automated)
  resolution: |
    Restrict at to authorized users via /etc/at.allow and remove /etc/at.deny.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Create /etc/at.allow and ensure /etc/at.deny does not exist.
  # - To make it FAIL:
  #   - Create /etc/at.deny (or delete /etc/at.allow) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM file WHERE path='/etc/at.allow')
      AND NOT EXISTS (SELECT 1 FROM file WHERE path='/etc/at.deny');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.1.1 Ensure IPv6 status is identified (Manual)
  platforms: linux
  platform: linux
  description: Ensure IPv6 status is identified (Manual)
  resolution: |
    Manual: determine if IPv6 must be enabled/disabled for this host role and enforce policy accordingly.
  # Validation:
  # - Where: Requires an organizational decision about IPv6.
  # - To make it PASS:
  #   - If your policy is 'IPv6 disabled', verify kernel parameters/sysctl and network behavior match that.
  #   - If your policy is 'IPv6 enabled', verify IPv6 is functional and configured per policy.
  # - To make it FAIL:
  #   - Configure the system opposite to your intended policy on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.1.2 Ensure wireless interfaces are not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure wireless interfaces are not available (Automated)
  resolution: |
    Remove/disable wireless interfaces if not required (BIOS/UEFI, hardware removal, or driver blacklisting).
  # Validation:
  # - Where: Run on the physical host; VMs may not expose wireless devices.
  # - To make it PASS:
  #   - Audit a server/VM with no Wi-Fi hardware (or wireless disabled in BIOS).
  # - To make it FAIL:
  #   - Attach a USB Wi-Fi adapter on a test machine (or enable wireless hardware).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM pci_devices
      WHERE model LIKE '%Wireless%' OR model LIKE '%Wi-Fi%' OR model LIKE '%WLAN%'
    )
    AND NOT EXISTS (
      SELECT 1 FROM usb_devices
      WHERE model LIKE '%Wireless%' OR model LIKE '%Wi-Fi%' OR model LIKE '%WLAN%'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.1.3 Ensure bluetooth services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure bluetooth services are not in use (Automated)
  resolution: |
    Disable bluetooth if not required: `sudo systemctl disable --now bluetooth.service`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Disable bluetooth.service.
  # - To make it FAIL:
  #   - Enable/start bluetooth.service on a test host (if present).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('bluetooth.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.2.1 Ensure dccp kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure dccp kernel module is not available (Automated)
  resolution: |
    Disable kernel module dccp (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^dccp '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/dccp.conf`) with `install dccp /bin/false` and `blacklist dccp`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe dccp` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='dccp') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist dccp%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install dccp /bin/false%' OR line LIKE 'install dccp /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.2.2 Ensure tipc kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure tipc kernel module is not available (Automated)
  resolution: |
    Disable kernel module tipc (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^tipc '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/tipc.conf`) with `install tipc /bin/false` and `blacklist tipc`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe tipc` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='tipc') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist tipc%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install tipc /bin/false%' OR line LIKE 'install tipc /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.2.3 Ensure rds kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure rds kernel module is not available (Automated)
  resolution: |
    Disable kernel module rds (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^rds '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/rds.conf`) with `install rds /bin/false` and `blacklist rds`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe rds` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='rds') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist rds%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install rds /bin/false%' OR line LIKE 'install rds /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.2.4 Ensure sctp kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure sctp kernel module is not available (Automated)
  resolution: |
    Disable kernel module sctp (blacklist + install /bin/false) or ensure it is not present/loaded.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure the module is not loaded: `lsmod | grep -E '^sctp '` returns nothing.
  #   - If the module exists on disk, add a modprobe rule (e.g., `/etc/modprobe.d/sctp.conf`) with `install sctp /bin/false` and `blacklist sctp`.
  # - To make it FAIL:
  #   - Remove the blacklist/install lines and (on a test machine) load the module: `sudo modprobe sctp` (only if safe/available).
  #   - Or keep it loadable and present on disk without blacklist/install rules.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='sctp') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist sctp%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install sctp /bin/false%' OR line LIKE 'install sctp /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.1 Ensure net.ipv4.ip_forward is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.ip_forward is configured (Automated)
  resolution: |
    Set `net.ipv4.ip_forward=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.ip_forward` to `0`: `sudo sysctl -w net.ipv4.ip_forward=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.ip_forward` to a different value on a test VM: `sudo sysctl -w net.ipv4.ip_forward=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.ip_forward' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.2 Ensure net.ipv4.conf.all.forwarding is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.forwarding is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.all.forwarding=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.all.forwarding` to `0`: `sudo sysctl -w net.ipv4.conf.all.forwarding=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.all.forwarding` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.all.forwarding=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.forwarding' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.3 Ensure net.ipv4.conf.default.forwarding is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.forwarding is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.default.forwarding=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.default.forwarding` to `0`: `sudo sysctl -w net.ipv4.conf.default.forwarding=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.default.forwarding` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.default.forwarding=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.forwarding' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.4 Ensure net.ipv4.conf.all.send_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.send_redirects is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.all.send_redirects=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.all.send_redirects` to `0`: `sudo sysctl -w net.ipv4.conf.all.send_redirects=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.all.send_redirects` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.all.send_redirects=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.send_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.5 Ensure net.ipv4.conf.default.send_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.send_redirects is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.default.send_redirects=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.default.send_redirects` to `0`: `sudo sysctl -w net.ipv4.conf.default.send_redirects=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.default.send_redirects` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.default.send_redirects=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.send_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.6 Ensure net.ipv4.icmp_ignore_bogus_error_responses is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.icmp_ignore_bogus_error_responses is configured (Automated)
  resolution: |
    Set `net.ipv4.icmp_ignore_bogus_error_responses=1` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.icmp_ignore_bogus_error_responses` to `1`: `sudo sysctl -w net.ipv4.icmp_ignore_bogus_error_responses=1` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.icmp_ignore_bogus_error_responses` to a different value on a test VM: `sudo sysctl -w net.ipv4.icmp_ignore_bogus_error_responses=1` (or 0) so it no longer equals `1`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.icmp_ignore_bogus_error_responses' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.7 Ensure net.ipv4.icmp_echo_ignore_broadcasts is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.icmp_echo_ignore_broadcasts is configured (Automated)
  resolution: |
    Set `net.ipv4.icmp_echo_ignore_broadcasts=1` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.icmp_echo_ignore_broadcasts` to `1`: `sudo sysctl -w net.ipv4.icmp_echo_ignore_broadcasts=1` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.icmp_echo_ignore_broadcasts` to a different value on a test VM: `sudo sysctl -w net.ipv4.icmp_echo_ignore_broadcasts=1` (or 0) so it no longer equals `1`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.icmp_echo_ignore_broadcasts' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.8 Ensure net.ipv4.conf.all.accept_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.accept_redirects is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.all.accept_redirects=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.all.accept_redirects` to `0`: `sudo sysctl -w net.ipv4.conf.all.accept_redirects=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.all.accept_redirects` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.all.accept_redirects=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.accept_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.9 Ensure net.ipv4.conf.default.accept_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.accept_redirects is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.default.accept_redirects=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.default.accept_redirects` to `0`: `sudo sysctl -w net.ipv4.conf.default.accept_redirects=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.default.accept_redirects` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.default.accept_redirects=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.accept_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.10 Ensure net.ipv4.conf.all.secure_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.secure_redirects is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.all.secure_redirects=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.all.secure_redirects` to `0`: `sudo sysctl -w net.ipv4.conf.all.secure_redirects=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.all.secure_redirects` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.all.secure_redirects=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.secure_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.11 Ensure net.ipv4.conf.default.secure_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.secure_redirects is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.default.secure_redirects=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.default.secure_redirects` to `0`: `sudo sysctl -w net.ipv4.conf.default.secure_redirects=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.default.secure_redirects` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.default.secure_redirects=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.secure_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.12 Ensure net.ipv4.conf.all.rp_filter is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.rp_filter is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.all.rp_filter=1` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.all.rp_filter` to `1`: `sudo sysctl -w net.ipv4.conf.all.rp_filter=1` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.all.rp_filter` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.all.rp_filter=1` (or 0) so it no longer equals `1`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.rp_filter' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.13 Ensure net.ipv4.conf.default.rp_filter is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.rp_filter is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.default.rp_filter=1` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.default.rp_filter` to `1`: `sudo sysctl -w net.ipv4.conf.default.rp_filter=1` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.default.rp_filter` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.default.rp_filter=1` (or 0) so it no longer equals `1`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.rp_filter' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.14 Ensure net.ipv4.conf.all.accept_source_route is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.accept_source_route is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.all.accept_source_route=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.all.accept_source_route` to `0`: `sudo sysctl -w net.ipv4.conf.all.accept_source_route=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.all.accept_source_route` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.all.accept_source_route=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.accept_source_route' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.15 Ensure net.ipv4.conf.default.accept_source_route is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.accept_source_route is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.default.accept_source_route=0` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.default.accept_source_route` to `0`: `sudo sysctl -w net.ipv4.conf.default.accept_source_route=0` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.default.accept_source_route` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.default.accept_source_route=1` (or 0) so it no longer equals `0`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.accept_source_route' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.17 Ensure net.ipv4.conf.default.log_martians is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.log_martians is configured (Automated)
  resolution: |
    Set `net.ipv4.conf.default.log_martians=1` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.conf.default.log_martians` to `1`: `sudo sysctl -w net.ipv4.conf.default.log_martians=1` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.conf.default.log_martians` to a different value on a test VM: `sudo sysctl -w net.ipv4.conf.default.log_martians=1` (or 0) so it no longer equals `1`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.log_martians' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.18 Ensure net.ipv4.tcp_syncookies is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.tcp_syncookies is configured (Automated)
  resolution: |
    Set `net.ipv4.tcp_syncookies=1` via sysctl and persist in /etc/sysctl.d/*.conf, then `sudo sysctl --system`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv4.tcp_syncookies` to `1`: `sudo sysctl -w net.ipv4.tcp_syncookies=1` and persist it.
  # - To make it FAIL:
  #   - Set `net.ipv4.tcp_syncookies` to a different value on a test VM: `sudo sysctl -w net.ipv4.tcp_syncookies=1` (or 0) so it no longer equals `1`.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.tcp_syncookies' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.1 Ensure net.ipv6.conf.all.forwarding is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.all.forwarding is configured (Automated)
  resolution: |
    Set `net.ipv6.conf.all.forwarding=0` via sysctl and persist in /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv6.conf.all.forwarding` to `0` (runtime + persistent).
  # - To make it FAIL:
  #   - Set `net.ipv6.conf.all.forwarding` to a different value (e.g., 1) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.all.forwarding' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.2 Ensure net.ipv6.conf.default.forwarding is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.default.forwarding is configured (Automated)
  resolution: |
    Set `net.ipv6.conf.default.forwarding=0` via sysctl and persist in /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv6.conf.default.forwarding` to `0` (runtime + persistent).
  # - To make it FAIL:
  #   - Set `net.ipv6.conf.default.forwarding` to a different value (e.g., 1) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.default.forwarding' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.3 Ensure net.ipv6.conf.all.accept_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.all.accept_redirects is configured (Automated)
  resolution: |
    Set `net.ipv6.conf.all.accept_redirects=0` via sysctl and persist in /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv6.conf.all.accept_redirects` to `0` (runtime + persistent).
  # - To make it FAIL:
  #   - Set `net.ipv6.conf.all.accept_redirects` to a different value (e.g., 1) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.all.accept_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.4 Ensure net.ipv6.conf.default.accept_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.default.accept_redirects is configured (Automated)
  resolution: |
    Set `net.ipv6.conf.default.accept_redirects=0` via sysctl and persist in /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv6.conf.default.accept_redirects` to `0` (runtime + persistent).
  # - To make it FAIL:
  #   - Set `net.ipv6.conf.default.accept_redirects` to a different value (e.g., 1) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.default.accept_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.5 Ensure net.ipv6.conf.all.accept_source_route is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.all.accept_source_route is configured (Automated)
  resolution: |
    Set `net.ipv6.conf.all.accept_source_route=0` via sysctl and persist in /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv6.conf.all.accept_source_route` to `0` (runtime + persistent).
  # - To make it FAIL:
  #   - Set `net.ipv6.conf.all.accept_source_route` to a different value (e.g., 1) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.all.accept_source_route' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.6 Ensure net.ipv6.conf.default.accept_source_route is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.default.accept_source_route is configured (Automated)
  resolution: |
    Set `net.ipv6.conf.default.accept_source_route=0` via sysctl and persist in /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv6.conf.default.accept_source_route` to `0` (runtime + persistent).
  # - To make it FAIL:
  #   - Set `net.ipv6.conf.default.accept_source_route` to a different value (e.g., 1) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.default.accept_source_route' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.7 Ensure net.ipv6.conf.all.accept_ra is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.all.accept_ra is configured (Automated)
  resolution: |
    Set `net.ipv6.conf.all.accept_ra=0` via sysctl and persist in /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv6.conf.all.accept_ra` to `0` (runtime + persistent).
  # - To make it FAIL:
  #   - Set `net.ipv6.conf.all.accept_ra` to a different value (e.g., 1) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.all.accept_ra' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.8 Ensure net.ipv6.conf.default.accept_ra is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.default.accept_ra is configured (Automated)
  resolution: |
    Set `net.ipv6.conf.default.accept_ra=0` via sysctl and persist in /etc/sysctl.d/*.conf.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `net.ipv6.conf.default.accept_ra` to `0` (runtime + persistent).
  # - To make it FAIL:
  #   - Set `net.ipv6.conf.default.accept_ra` to a different value (e.g., 1) on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.default.accept_ra' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.1 Ensure ufw is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw is installed (Automated)
  resolution: |
    Install ufw: `sudo apt-get install -y ufw`.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Install `ufw` package.
  # - To make it FAIL:
  #   - Remove `ufw` package on a test VM (`sudo apt-get purge -y ufw`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name = 'ufw');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.2 Ensure ufw service is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw service is configured (Automated)
  resolution: |
    Enable ufw (set ENABLED=yes in /etc/ufw/ufw.conf and run `sudo ufw enable`).
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `ENABLED=yes` in /etc/ufw/ufw.conf and enable ufw (`sudo ufw enable`).
  # - To make it FAIL:
  #   - Set `ENABLED=no` (or comment the line) and reload; or uninstall ufw on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='ufw')
      AND EXISTS (
        SELECT 1 FROM file_lines
        WHERE path='/etc/ufw/ufw.conf'
          AND line LIKE 'ENABLED=yes%'
          AND line NOT LIKE '#%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.3 Ensure ufw incoming default is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw incoming default is configured (Automated)
  resolution: |
    Set DEFAULT_INPUT_POLICY=DROP in /etc/default/ufw.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `DEFAULT_INPUT_POLICY="DROP"` in /etc/default/ufw (non-comment).
  # - To make it FAIL:
  #   - Set it to ACCEPT or remove the line on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path = '/etc/default/ufw'
        AND line LIKE 'DEFAULT_INPUT_POLICY=%' AND line LIKE '%DROP%'
        AND line NOT LIKE '#%'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.4 Ensure ufw outgoing default is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw outgoing default is configured (Automated)
  resolution: |
    Set DEFAULT_OUTPUT_POLICY=ACCEPT in /etc/default/ufw.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `DEFAULT_OUTPUT_POLICY="ACCEPT"` in /etc/default/ufw.
  # - To make it FAIL:
  #   - Set it to DROP or remove it on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path = '/etc/default/ufw'
        AND line LIKE 'DEFAULT_OUTPUT_POLICY=%' AND line LIKE '%ACCEPT%'
        AND line NOT LIKE '#%'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.5 Ensure ufw routed default is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw routed default is configured (Automated)
  resolution: |
    Set DEFAULT_FORWARD_POLICY=DROP in /etc/default/ufw.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set `DEFAULT_FORWARD_POLICY="DROP"` in /etc/default/ufw.
  # - To make it FAIL:
  #   - Set it to ACCEPT on a test VM.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path = '/etc/default/ufw'
        AND line LIKE 'DEFAULT_FORWARD_POLICY=%' AND line LIKE '%DROP%'
        AND line NOT LIKE '#%'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.1 Ensure access to /etc/ssh/sshd_config is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/ssh/sshd_config is configured (Automated)
  resolution: |
    Ensure /etc/ssh/sshd_config is owned by root:root and not group/world writable.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Set permissions to 600 or 640 and owner root:root.
  # - To make it FAIL:
  #   - Make it world-writable on a test VM (`sudo chmod 666 /etc/ssh/sshd_config`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/ssh/sshd_config' AND uid = 0 AND gid = 0
        AND (mode = '0400' OR mode = '0440' OR mode = '0600' OR mode = '0640')
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.2 Ensure access to SSH private host key files is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to SSH private host key files is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.3 Ensure access to SSH public host key files is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to SSH public host key files is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.4 Ensure sshd access is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd access is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.5 Ensure sshd Banner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd Banner is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.6 Ensure sshd Ciphers are configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd Ciphers are configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.7 Ensure sshd ClientAliveInterval and ClientAliveCountMax are configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd ClientAliveInterval and ClientAliveCountMax are configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.8 Ensure sshd DisableForwarding is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd DisableForwarding is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.9 Ensure sshd GSSAPIAuthentication is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd GSSAPIAuthentication is disabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.10 Ensure sshd HostbasedAuthentication is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd HostbasedAuthentication is disabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.11 Ensure sshd IgnoreRhosts is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd IgnoreRhosts is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.12 Ensure sshd KexAlgorithms is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd KexAlgorithms is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.13 Ensure sshd LoginGraceTime is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd LoginGraceTime is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.14 Ensure sshd LogLevel is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd LogLevel is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.15 Ensure sshd MACs are configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd MACs are configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.16 Ensure sshd MaxAuthTries is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd MaxAuthTries is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.17 Ensure sshd MaxSessions is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd MaxSessions is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.18 Ensure sshd MaxStartups is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd MaxStartups is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.19 Ensure sshd PermitEmptyPasswords is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd PermitEmptyPasswords is disabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.20 Ensure sshd PermitRootLogin is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd PermitRootLogin is disabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.21 Ensure sshd PermitUserEnvironment is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd PermitUserEnvironment is disabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.22 Ensure sshd UsePAM is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd UsePAM is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.1 Ensure sudo is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure sudo is installed (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.2 Ensure sudo commands use pty (Automated)
  platforms: linux
  platform: linux
  description: Ensure sudo commands use pty (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.3 Ensure sudo log file exists (Automated)
  platforms: linux
  platform: linux
  description: Ensure sudo log file exists (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.4 Ensure users must provide password for escalation (Automated)
  platforms: linux
  platform: linux
  description: Ensure users must provide password for escalation (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.5 Ensure re -authentication for privilege escalation is not disabled globally (Automated) 542
  platforms: linux
  platform: linux
  description: Ensure re -authentication for privilege escalation is not disabled globally (Automated) 542
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.6 Ensure sudo timestamp_timeout is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sudo timestamp_timeout is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.7 Ensure access to the su command is restricted (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to the su command is restricted (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.1.1 Ensure latest version of pam is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure latest version of pam is installed (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.1.3 Ensure latest version of libpam -pwquality is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure latest version of libpam -pwquality is installed (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.2.1 Ensure pam_unix module is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix module is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.2.2 Ensure pam_faillock module is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_faillock module is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.2.3 Ensure pam_pwquality module is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_pwquality module is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.2.4 Ensure pam_pwhistory module is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_pwhistory module is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.1.1 Ensure password failed attempts lockout is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password failed attempts lockout is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.1.2 Ensure password unlock time is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password unlock time is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.1.3 Ensure password failed attempts lockout includes root account (Automated)
  platforms: linux
  platform: linux
  description: Ensure password failed attempts lockout includes root account (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.1 Ensure password number of changed characters is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password number of changed characters is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.2 Ensure minimum password length is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure minimum password length is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.3 Ensure password complexity is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure password complexity is configured (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.4 Ensure password same consecutive characters is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password same consecutive characters is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.5 Ensure password maximum sequential characters is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password maximum sequential characters is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.6 Ensure password dictionary check is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure password dictionary check is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.7 Ensure password quality checking is enforced (Automated)
  platforms: linux
  platform: linux
  description: Ensure password quality checking is enforced (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.8 Ensure password quality is enforced for the root user (Automated)
  platforms: linux
  platform: linux
  description: Ensure password quality is enforced for the root user (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.3.1 Ensure password history remember is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password history remember is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.3.2 Ensure password history is enforced for the root user (Automated)
  platforms: linux
  platform: linux
  description: Ensure password history is enforced for the root user (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.3.3 Ensure pam_pwhistory includes use_authtok (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_pwhistory includes use_authtok (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.4.1 Ensure pam_unix does not include nullok (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix does not include nullok (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.4.2 Ensure pam_unix does not include remember (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix does not include remember (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.4.3 Ensure pam_unix includes a strong password hashing algorithm (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix includes a strong password hashing algorithm (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.4.4 Ensure pam_unix includes use_authtok (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix includes use_authtok (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.1 Ensure password expiration is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password expiration is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.2 Ensure minimum password days is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure minimum password days is configured (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.3 Ensure password expiration warning days is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password expiration warning days is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.4 Ensure strong password hashing algorithm is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure strong password hashing algorithm is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.5 Ensure inactive password lock is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure inactive password lock is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.6 Ensure all users last password change date is in the past (Automated)
  platforms: linux
  platform: linux
  description: Ensure all users last password change date is in the past (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.1 Ensure root is the only UID 0 account (Automated)
  platforms: linux
  platform: linux
  description: Ensure root is the only UID 0 account (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.2 Ensure root is the only GID 0 account (Automated)
  platforms: linux
  platform: linux
  description: Ensure root is the only GID 0 account (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.3 Ensure group root is the only GID 0 group (Automated)
  platforms: linux
  platform: linux
  description: Ensure group root is the only GID 0 group (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.4 Ensure root account access is controlled (Automated)
  platforms: linux
  platform: linux
  description: Ensure root account access is controlled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.5 Ensure root path integrity (Automated)
  platforms: linux
  platform: linux
  description: Ensure root path integrity (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.6 Ensure root user umask is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure root user umask is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.7 Ensure system accounts do not have a valid login shell (Automated)
  platforms: linux
  platform: linux
  description: Ensure system accounts do not have a valid login shell (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.8 Ensure accounts without a valid login shell are locked (Automated)
  platforms: linux
  platform: linux
  description: Ensure accounts without a valid login shell are locked (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.3.1 Ensure nologin is not listed in /etc/shells (Automated)
  platforms: linux
  platform: linux
  description: Ensure nologin is not listed in /etc/shells (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.3.2 Ensure default user shell timeout is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure default user shell timeout is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.3.3 Ensure default user umask is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure default user umask is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.2 Ensure journald log file access is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure journald log file access is configured (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.3 Ensure journald log file rotation is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure journald log file rotation is configured (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.4 Ensure journald ForwardToSyslog is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure journald ForwardToSyslog is disabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.5 Ensure journald Storage is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure journald Storage is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.6 Ensure journald Compress is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure journald Compress is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.2.1 Ensure systemd -journal -remote is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -journal -remote is installed (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.2.2 Ensure systemd -journal -upload authentication is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure systemd -journal -upload authentication is configured (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.2.3 Ensure systemd -journal -upload is enabled and active (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -journal -upload is enabled and active (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.2.4 Ensure systemd -journal -remote service is not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -journal -remote service is not in use (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.1 Ensure rsyslog is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsyslog is installed (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.2 Ensure rsyslog service is enabled and active (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsyslog service is enabled and active (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.3 Ensure journald is configured to send logs to rsyslog (Automated)
  platforms: linux
  platform: linux
  description: Ensure journald is configured to send logs to rsyslog (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.4 Ensure rsyslog log file creation mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsyslog log file creation mode is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.5 Ensure rsyslog logging is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure rsyslog logging is configured (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.6 Ensure rsyslog is configured to send logs to a remote log host (Manual)
  platforms: linux
  platform: linux
  description: Ensure rsyslog is configured to send logs to a remote log host (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.7 Ensure rsyslog is not configured to receive logs from a remote client (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsyslog is not configured to receive logs from a remote client (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.8 Ensure logrotate is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure logrotate is configured (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.3.1 Ensure access to all logfiles has been configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to all logfiles has been configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.1.1 Ensure auditd packages are installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure auditd packages are installed (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.1.2 Ensure auditd service is enabled and active (Automated)
  platforms: linux
  platform: linux
  description: Ensure auditd service is enabled and active (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.1.3 Ensure auditing for processes that start prior to auditd is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure auditing for processes that start prior to auditd is enabled (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.1.4 Ensure audit_backlog_limit is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit_backlog_limit is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.2.1 Ensure audit log storage size is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit log storage size is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.2.2 Ensure audit logs are not automatically deleted (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit logs are not automatically deleted (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.2.3 Ensure system is disabled when audit logs are full (Automated)
  platforms: linux
  platform: linux
  description: Ensure system is disabled when audit logs are full (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.2.4 Ensure system warns when audit logs are low on space (Automated)
  platforms: linux
  platform: linux
  description: Ensure system warns when audit logs are low on space (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.1 Ensure changes to system administration scope (sudoers) is collected (Automated) 744
  platforms: linux
  platform: linux
  description: Ensure changes to system administration scope (sudoers) is collected (Automated) 744
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.2 Ensure actions as another user are always logged (Automated)
  platforms: linux
  platform: linux
  description: Ensure actions as another user are always logged (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.3 Ensure events that modify the sudo log file are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure events that modify the sudo log file are collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.4 Ensure events that modify date and time information are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure events that modify date and time information are collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.5 Ensure events that modify the system's network environment are collected
  platforms: linux
  platform: linux
  description: Ensure events that modify the system's network environment are collected
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.6 Ensure use of privileged commands are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure use of privileged commands are collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.7 Ensure unsuccessful file access attempts are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure unsuccessful file access attempts are collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.8 Ensure events that modify user/group information are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure events that modify user/group information are collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.9 Ensure discretionary access control permission modification events are collected
  platforms: linux
  platform: linux
  description: Ensure discretionary access control permission modification events are collected
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.10 Ensure successful file system mounts are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure successful file system mounts are collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.11 Ensure session initiation information is collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure session initiation information is collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.12 Ensure login and logout events are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure login and logout events are collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.13 Ensure file deletion events by users are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure file deletion events by users are collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.14 Ensure events that modify the system's Mandatory Access Controls are collected
  platforms: linux
  platform: linux
  description: Ensure events that modify the system's Mandatory Access Controls are collected
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.15 Ensure successful and unsuccessful attempts to use the chcon command are
  platforms: linux
  platform: linux
  description: Ensure successful and unsuccessful attempts to use the chcon command are
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.16 Ensure successful and unsuccessful attempts to use the setfacl command are
  platforms: linux
  platform: linux
  description: Ensure successful and unsuccessful attempts to use the setfacl command are
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.18 Ensure successful and unsuccessful attempts to use the usermod command are
  platforms: linux
  platform: linux
  description: Ensure successful and unsuccessful attempts to use the usermod command are
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.19 Ensure kernel module loading unloading and modification is collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure kernel module loading unloading and modification is collected (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.20 Ensure the audit configuration is immutable (Automated)
  platforms: linux
  platform: linux
  description: Ensure the audit configuration is immutable (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.21 Ensure the running and on disk configuration is the same (Manual)
  platforms: linux
  platform: linux
  description: Ensure the running and on disk configuration is the same (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.1 Ensure audit log files mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit log files mode is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.2 Ensure audit log files owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit log files owner is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.3 Ensure audit log files group owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit log files group owner is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.4 Ensure the audit log file directory mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure the audit log file directory mode is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.5 Ensure audit configuration files mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit configuration files mode is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.6 Ensure audit configuration files owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit configuration files owner is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.7 Ensure audit configuration files group owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit configuration files group owner is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.8 Ensure audit tools mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit tools mode is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.9 Ensure audit tools owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit tools owner is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.10 Ensure audit tools group owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit tools group owner is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.3.1 Ensure AIDE is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure AIDE is installed (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.3.2 Ensure filesystem integrity is regularly checked (Automated)
  platforms: linux
  platform: linux
  description: Ensure filesystem integrity is regularly checked (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.3.3 Ensure cryptographic mechanisms are used to protect the integrity of audit tools
  platforms: linux
  platform: linux
  description: Ensure cryptographic mechanisms are used to protect the integrity of audit tools
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.1 Ensure access to /etc/passwd is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/passwd is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.2 Ensure access to /etc/passwd - is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/passwd - is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.3 Ensure access to /etc/group is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/group is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.4 Ensure access to /etc/group - is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/group - is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.5 Ensure access to /etc/shadow is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/shadow is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.6 Ensure access to /etc/shadow - is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/shadow - is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.7 Ensure access to /etc/gshadow is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/gshadow is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.8 Ensure access to /etc/gshadow - is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/gshadow - is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.9 Ensure access to /etc/shells is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/shells is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.10 Ensure access to /etc/security/opasswd is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/security/opasswd is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.11 Ensure world writable files and directories are secured (Automated)
  platforms: linux
  platform: linux
  description: Ensure world writable files and directories are secured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.12 Ensure no files or directories without an owner and a group exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no files or directories without an owner and a group exist (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.13 Ensure SUID and SGID files are reviewed (Manual)
  platforms: linux
  platform: linux
  description: Ensure SUID and SGID files are reviewed (Manual)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (no reliable generic osquery audit).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change the configuration so it violates the CIS requirement (in a test VM) and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.1 Ensure accounts in /etc/passwd use shadowed passwords (Automated)
  platforms: linux
  platform: linux
  description: Ensure accounts in /etc/passwd use shadowed passwords (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.2 Ensure /etc/shadow password fields are not empty (Automated)
  platforms: linux
  platform: linux
  description: Ensure /etc/shadow password fields are not empty (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.3 Ensure all groups in /etc/passwd exist in /etc/group (Automated)
  platforms: linux
  platform: linux
  description: Ensure all groups in /etc/passwd exist in /etc/group (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.4 Ensure shadow group is empty (Automated)
  platforms: linux
  platform: linux
  description: Ensure shadow group is empty (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.5 Ensure no duplicate UIDs exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no duplicate UIDs exist (Automated)
  resolution: |
    Ensure each local UID is unique.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure no two local users share the same UID (check /etc/passwd).
  # - To make it FAIL:
  #   - On a test VM, create a user with an existing UID (e.g., `useradd -u <existing_uid> dupuser`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT uid FROM users
      GROUP BY uid HAVING COUNT(*) > 1
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.6 Ensure no duplicate GIDs exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no duplicate GIDs exist (Automated)
  resolution: |
    Ensure each local GID is unique.
  # Validation:
  # - Where: Run this osquery policy on the Ubuntu 22.04 host being audited.
  # - To make it PASS:
  #   - Ensure no two local groups share the same GID (check /etc/group).
  # - To make it FAIL:
  #   - On a test VM, create a group with an existing GID (`groupadd -g <existing_gid> dupgroup`).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT gid FROM groups
      GROUP BY gid HAVING COUNT(*) > 1
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.7 Ensure no duplicate user names exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no duplicate user names exist (Automated)
  resolution: |
    Ensure each username is unique.
  # Validation:
  # - Where: Use a disposable VM for the fail-case; duplicating names can break the system.
  # - To make it PASS:
  #   - Ensure no duplicate usernames exist in /etc/passwd.
  # - To make it FAIL:
  #   - On a test VM, manually edit /etc/passwd to duplicate a username (do this only in a disposable VM).
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT username FROM users
      GROUP BY username HAVING COUNT(*) > 1
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.8 Ensure no duplicate group names exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no duplicate group names exist (Automated)
  resolution: |
    Ensure each group name is unique.
  # Validation:
  # - Where: Use a disposable VM for the fail-case.
  # - To make it PASS:
  #   - Ensure no duplicate group names exist in /etc/group.
  # - To make it FAIL:
  #   - On a test VM, manually edit /etc/group to duplicate a group name.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT groupname FROM groups
      GROUP BY groupname HAVING COUNT(*) > 1
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.9 Ensure local interactive user home directories are configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure local interactive user home directories are configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.10 Ensure local interactive user dot files access is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure local interactive user dot files access is configured (Automated)
  resolution: |
    Refer to the CIS Benchmark remediation steps for this item.
  # Validation:
  # - Where: Manual validation required (not yet translated to a safe automated query).
  # - To make it PASS:
  #   - Follow CIS 'Audit' steps for this control and document the result.
  # - To make it FAIL:
  #   - Change config to violate the control in a test VM and re-audit.
  # - Expected behavior:
  #   - PASS: query returns 1 row.
  #   - FAIL: query returns 0 rows.
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
