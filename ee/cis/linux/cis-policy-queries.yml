---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.1 Ensure cramfs kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure cramfs kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/cramfs.conf with blacklist + install rules to prevent loading cramfs.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/cramfs.conf
# blacklist cramfs
# install cramfs /bin/false
# EOF'
  #   - sudo modprobe -r cramfs 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/cramfs.conf
  #   - (optional) sudo modprobe cramfs 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='cramfs') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist cramfs%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install cramfs /bin/false%' OR line LIKE 'install cramfs /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.2 Ensure freevxfs kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure freevxfs kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/freevxfs.conf with blacklist + install rules to prevent loading freevxfs.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/freevxfs.conf
# blacklist freevxfs
# install freevxfs /bin/false
# EOF'
  #   - sudo modprobe -r freevxfs 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/freevxfs.conf
  #   - (optional) sudo modprobe freevxfs 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='freevxfs') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist freevxfs%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install freevxfs /bin/false%' OR line LIKE 'install freevxfs /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.4 Ensure hfsplus kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure hfsplus kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/hfs.conf with blacklist + install rules to prevent loading hfs.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/hfs.conf
# blacklist hfs
# install hfs /bin/false
# EOF'
  #   - sudo modprobe -r hfs 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/hfs.conf
  #   - (optional) sudo modprobe hfs 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='hfs') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist hfs%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install hfs /bin/false%' OR line LIKE 'install hfs /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.5 Ensure jffs2 kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure jffs2 kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/hfsplus.conf with blacklist + install rules to prevent loading hfsplus.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/hfsplus.conf
# blacklist hfsplus
# install hfsplus /bin/false
# EOF'
  #   - sudo modprobe -r hfsplus 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/hfsplus.conf
  #   - (optional) sudo modprobe hfsplus 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='hfsplus') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist hfsplus%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install hfsplus /bin/false%' OR line LIKE 'install hfsplus /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.6 Ensure overlay kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure overlay kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/udf.conf with blacklist + install rules to prevent loading udf.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/udf.conf
# blacklist udf
# install udf /bin/false
# EOF'
  #   - sudo modprobe -r udf 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/udf.conf
  #   - (optional) sudo modprobe udf 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='udf') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist udf%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install udf /bin/false%' OR line LIKE 'install udf /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.7 Ensure squashfs kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure squashfs kernel module is not available (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name IN ('squashfs')) = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'blacklist squashfs%')
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND ((line LIKE 'install squashfs /bin/false%') OR (line LIKE 'install squashfs /bin/true%'))
             AND line NOT LIKE '#%') >= 1;
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.8 Ensure udf kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure udf kernel module is not available (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name IN ('udf')) = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'blacklist udf%')
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND ((line LIKE 'install udf /bin/false%') OR (line LIKE 'install udf /bin/true%'))
             AND line NOT LIKE '#%') >= 1;
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.9 Ensure usb -storage kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure usb -storage kernel module is not available (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name IN ('usb-storage', 'usb_storage')) = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'blacklist usb-storage%' OR line LIKE 'blacklist usb_storage%')
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND ((line LIKE 'install usb-storage /bin/false%' OR line LIKE 'install usb_storage /bin/false%') OR (line LIKE 'install usb-storage /bin/true%' OR line LIKE 'install usb_storage /bin/true%'))
             AND line NOT LIKE '#%') >= 1;
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.10 Ensure unused filesystems kernel modules are not available (Manual)
  platforms: linux
  platform: linux
  description: Ensure unused filesystems kernel modules are not available (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.1.11 Ensure firewire -core kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure firewire -core kernel module is not available (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name IN ('firewire-core', 'firewire_core')) = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'blacklist firewire-core%' OR line LIKE 'blacklist firewire_core%')
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND ((line LIKE 'install firewire-core /bin/false%' OR line LIKE 'install firewire_core /bin/false%') OR (line LIKE 'install firewire-core /bin/true%' OR line LIKE 'install firewire_core /bin/true%'))
             AND line NOT LIKE '#%') >= 1;
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.1.1 Ensure /tmp is tmpfs or a separate partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure /tmp is tmpfs or a separate partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM mounts WHERE path='/tmp');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.1.2 Ensure nodev option set on /tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /tmp partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/tmp'
        AND ',' || flags || ',' LIKE '%,nodev,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.1.3 Ensure nosuid option set on /tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /tmp partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/tmp'
        AND ',' || flags || ',' LIKE '%,nosuid,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.1.4 Ensure noexec option set on /tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /tmp partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/tmp'
        AND ',' || flags || ',' LIKE '%,noexec,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.2.1 Ensure /dev/shm is tmpfs or a separate partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure /dev/shm is tmpfs or a separate partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM mounts WHERE path='/dev/shm');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.2.2 Ensure nodev option set on /dev/shm partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /dev/shm partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/dev/shm'
        AND ',' || flags || ',' LIKE '%,nodev,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.2.3 Ensure nosuid option set on /dev/shm partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /dev/shm partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/dev/shm'
        AND ',' || flags || ',' LIKE '%,nosuid,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.2.4 Ensure noexec option set on /dev/shm partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /dev/shm partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/dev/shm'
        AND ',' || flags || ',' LIKE '%,noexec,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.3.1 Ensure separate partition exists for /home (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /home (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.3.2 Ensure nodev option set on /home partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /home partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/home'
        AND ',' || flags || ',' LIKE '%,nodev,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.3.3 Ensure nosuid option set on /home partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /home partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/home'
        AND ',' || flags || ',' LIKE '%,nosuid,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.4.1 Ensure separate partition exists for /var (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /var (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.4.2 Ensure nodev option set on /var partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /var partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var'
        AND ',' || flags || ',' LIKE '%,nodev,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.4.3 Ensure nosuid option set on /var partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /var partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var'
        AND ',' || flags || ',' LIKE '%,nosuid,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.5.1 Ensure separate partition exists for /var/tmp (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /var/tmp (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.5.2 Ensure nodev option set on /var/tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /var/tmp partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/tmp'
        AND ',' || flags || ',' LIKE '%,nodev,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.5.3 Ensure nosuid option set on /var/tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /var/tmp partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/tmp'
        AND ',' || flags || ',' LIKE '%,nosuid,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.5.4 Ensure noexec option set on /var/tmp partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /var/tmp partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/tmp'
        AND ',' || flags || ',' LIKE '%,noexec,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.6.1 Ensure separate partition exists for /var/log (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /var/log (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.6.2 Ensure nodev option set on /var/log partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /var/log partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/log'
        AND ',' || flags || ',' LIKE '%,nodev,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.6.3 Ensure nosuid option set on /var/log partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /var/log partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/log'
        AND ',' || flags || ',' LIKE '%,nosuid,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.6.4 Ensure noexec option set on /var/log partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /var/log partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/log'
        AND ',' || flags || ',' LIKE '%,noexec,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.7.1 Ensure separate partition exists for /var/log/audit (Automated)
  platforms: linux
  platform: linux
  description: Ensure separate partition exists for /var/log/audit (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM mounts WHERE path='/var/log/audit');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.7.2 Ensure nodev option set on /var/log/audit partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nodev option set on /var/log/audit partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/log/audit'
        AND ',' || flags || ',' LIKE '%,nodev,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.7.3 Ensure nosuid option set on /var/log/audit partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure nosuid option set on /var/log/audit partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/log/audit'
        AND ',' || flags || ',' LIKE '%,nosuid,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.1.2.7.4 Ensure noexec option set on /var/log/audit partition (Automated)
  platforms: linux
  platform: linux
  description: Ensure noexec option set on /var/log/audit partition (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM mounts
      WHERE path='/var/log/audit'
        AND ',' || flags || ',' LIKE '%,noexec,%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.2.1.1 Ensure GPG keys are configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure GPG keys are configured (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.2.1.2 Ensure package manager repositories are configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure package manager repositories are configured (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.2.2.1 Ensure updates, patches, and additional security software are installed (Manual)
  platforms: linux
  platform: linux
  description: Ensure updates, patches, and additional security software are installed (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.3.1.1 Ensure the apparmor packages are installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure the apparmor packages are installed (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.3.1.2 Ensure AppArmor is enabled (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure AppArmor is enabled (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.3.1.3 Ensure all AppArmor Profiles are not disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure all AppArmor Profiles are not disabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.3.1.4 Ensure all AppArmor Profiles are enforcing (Automated)
  platforms: linux
  platform: linux
  description: Ensure all AppArmor Profiles are enforcing (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.4.2 Ensure access to bootloader config is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to bootloader config is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0600 for /boot/grub/grub.cfg.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /boot/grub/grub.cfg && sudo chmod 0600 /boot/grub/grub.cfg
  # - FAIL (run):
  #   - sudo chmod 0777 /boot/grub/grub.cfg
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/boot/grub/grub.cfg' AND uid = 0 AND gid = 0
        AND mode = '0600'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.1 Ensure randomize_va_space is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure randomize_va_space is configured (Automated)
  resolution: |
    Set kernel.randomize_va_space to required value and persist in /etc/sysctl.d/*.conf.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w kernel.randomize_va_space=2
  # - FAIL (run):
  #   - sudo sysctl -w kernel.randomize_va_space=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='kernel.randomize_va_space' AND value='2');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.2 Ensure ptrace_scope is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ptrace_scope is configured (Automated)
  resolution: |
    Set kernel.yama.ptrace_scope to required value and persist in /etc/sysctl.d/*.conf.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w kernel.yama.ptrace_scope=1
  # - FAIL (run):
  #   - sudo sysctl -w kernel.yama.ptrace_scope=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='kernel.yama.ptrace_scope' AND CAST(value AS INTEGER) >= 1);
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.3 Ensure suid_dumpable is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure suid_dumpable is configured (Automated)
  resolution: |
    Set kernel.kptr_restrict to required value and persist in /etc/sysctl.d/*.conf.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w kernel.kptr_restrict=1
  # - FAIL (run):
  #   - sudo sysctl -w kernel.kptr_restrict=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='kernel.kptr_restrict' AND CAST(value AS INTEGER) >= 1);
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.4 Ensure core file size is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure core file size is configured (Automated)
  resolution: |
    Set kernel.dmesg_restrict to required value and persist in /etc/sysctl.d/*.conf.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w kernel.dmesg_restrict=1
  # - FAIL (run):
  #   - sudo sysctl -w kernel.dmesg_restrict=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='kernel.dmesg_restrict' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.5 Ensure prelink is not installed (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure prelink is not installed (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name='prelink');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.5.6 Ensure Automatic Error Reporting is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure Automatic Error Reporting is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.1 Ensure /etc/motd is configured (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure /etc/motd is configured (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.2 Ensure /etc/issue is configured (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure /etc/issue is configured (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.3 Ensure /etc/issue.net is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure /etc/issue.net is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.4 Ensure access to /etc/motd is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/motd is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.5 Ensure access to /etc/issue is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/issue is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.6.6 Ensure access to /etc/issue.net is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/issue.net is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.1 Ensure GDM is removed (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure GDM is removed (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.2 Ensure GDM login banner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM login banner is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.3 Ensure GDM disable -user-list option is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM disable -user-list option is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.4 Ensure GDM screen locks when the user is idle (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM screen locks when the user is idle (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.5 Ensure GDM screen locks cannot be overridden (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM screen locks cannot be overridden (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.6 Ensure GDM automatic mounting of removable media is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM automatic mounting of removable media is disabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.7 Ensure GDM disabling automatic mounting of removable media is not overridden
  platforms: linux
  platform: linux
  description: Ensure GDM disabling automatic mounting of removable media is not overridden
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.8 Ensure GDM autorun -never is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM autorun -never is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.9 Ensure GDM autorun -never is not overridden (Automated)
  platforms: linux
  platform: linux
  description: Ensure GDM autorun -never is not overridden (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.10 Ensure XDMCP is not enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure XDMCP is not enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 1.7.11 Ensure Xwayland is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure Xwayland is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.1 Ensure autofs services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure autofs services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now autofs.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now autofs.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('autofs.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.2 Ensure avahi daemon services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure avahi daemon services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now avahi-daemon.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now avahi-daemon.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('avahi-daemon.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.3 Ensure dhcp server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure dhcp server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now isc-dhcp-server.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now isc-dhcp-server.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('isc-dhcp-server.service','dhcpd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.4 Ensure dns server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure dns server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now bind9.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now bind9.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('bind9.service','named.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.5 Ensure dnsmasq services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure dnsmasq services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now dnsmasq.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now dnsmasq.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('dnsmasq.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.6 Ensure ftp server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure ftp server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now vsftpd.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now vsftpd.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('vsftpd.service','proftpd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.7 Ensure ldap server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure ldap server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now slapd.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now slapd.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('slapd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.8 Ensure message access server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure message access server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now dovecot.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now dovecot.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('dovecot.service','courier-imap.service','cyrus-imapd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.9 Ensure network file system services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure network file system services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now nfs-server.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now nfs-server.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('nfs-server.service','nfs-kernel-server.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.10 Ensure nis server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure nis server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now nis.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now nis.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('nis.service','ypserv.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.11 Ensure print server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure print server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now cups.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now cups.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('cups.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.12 Ensure rpcbind services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure rpcbind services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now rpcbind.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now rpcbind.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('rpcbind.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.13 Ensure rsync services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsync services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now rsync.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now rsync.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('rsync.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.14 Ensure samba file server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure samba file server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now smbd.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now smbd.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('smbd.service','nmbd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.15 Ensure snmp services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure snmp services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now snmpd.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now snmpd.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('snmpd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.16 Ensure tftp server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure tftp server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now tftpd.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now tftpd.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('tftpd.service','tftpd-hpa.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.17 Ensure web proxy server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure web proxy server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now squid.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now squid.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('squid.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.18 Ensure web server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure web server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now apache2.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now apache2.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('apache2.service','nginx.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.19 Ensure xinetd services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure xinetd services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now xinetd.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now xinetd.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('xinetd.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.20 Ensure X window server services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure X window server services are not in use (Automated)
  resolution: |
    Disable the service(s) if not required.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo systemctl disable --now display-manager.service 2>/dev/null || true
  # - FAIL (run):
  #   - sudo systemctl enable --now display-manager.service 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('display-manager.service','gdm.service','gdm3.service','lightdm.service')
        AND active_state = 'active'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.21 Ensure mail transfer agents are configured for local -only mode (Automated)
  platforms: linux
  platform: linux
  description: Ensure mail transfer agents are configured for local -only mode (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.1.22 Ensure only approved services are listening on a network interface (Manual)
  platforms: linux
  platform: linux
  description: Ensure only approved services are listening on a network interface (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.1 Ensure nis client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure nis client is not installed (Automated)
  resolution: |
    Remove nis if not required.
  # QA Validation:
  # - Where: Run on the audited host (FAIL best on disposable VM).
  # - PASS (run):
  #   - sudo apt-get purge -y nis
  # - FAIL (run):
  #   - sudo apt-get update && sudo apt-get install -y nis
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'nis');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.3 Ensure talk client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure talk client is not installed (Automated)
  resolution: |
    Remove talk if not required.
  # QA Validation:
  # - Where: Run on the audited host (FAIL best on disposable VM).
  # - PASS (run):
  #   - sudo apt-get purge -y talk
  # - FAIL (run):
  #   - sudo apt-get update && sudo apt-get install -y talk
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'talk');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.4 Ensure telnet client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure telnet client is not installed (Automated)
  resolution: |
    Remove telnet if not required.
  # QA Validation:
  # - Where: Run on the audited host (FAIL best on disposable VM).
  # - PASS (run):
  #   - sudo apt-get purge -y telnet
  # - FAIL (run):
  #   - sudo apt-get update && sudo apt-get install -y telnet
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'telnet');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.5 Ensure ldap client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure ldap client is not installed (Automated)
  resolution: |
    Remove ldap-utils if not required.
  # QA Validation:
  # - Where: Run on the audited host (FAIL best on disposable VM).
  # - PASS (run):
  #   - sudo apt-get purge -y ldap-utils
  # - FAIL (run):
  #   - sudo apt-get update && sudo apt-get install -y ldap-utils
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'ldap-utils');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.2.6 Ensure ftp client is not installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure ftp client is not installed (Automated)
  resolution: |
    Remove ftp if not required.
  # QA Validation:
  # - Where: Run on the audited host (FAIL best on disposable VM).
  # - PASS (run):
  #   - sudo apt-get purge -y ftp
  # - FAIL (run):
  #   - sudo apt-get update && sudo apt-get install -y ftp
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name = 'ftp');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.1 Ensure time synchronization is in use ................................
  platforms: linux
  platform: linux
  description: Ensure time synchronization is in use ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name='chrony.service' AND active_state='active'
    )
    OR EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name='systemd-timesyncd.service' AND active_state='active'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.1.1 Ensure a single time synchronization daemon is in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure a single time synchronization daemon is in use (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.2.1 Ensure systemd -timesyncd configured with authorized timeserver (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -timesyncd configured with authorized timeserver (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.2.2 Ensure systemd -timesyncd is enabled and running (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -timesyncd is enabled and running (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.3.1 Ensure chrony is configured with authorized timeserver (Automated)
  platforms: linux
  platform: linux
  description: Ensure chrony is configured with authorized timeserver (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/chrony/chrony.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'server %' OR line LIKE 'pool %')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.3.2 Ensure chrony is running as user _chrony (Automated)
  platforms: linux
  platform: linux
  description: Ensure chrony is running as user _chrony (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.3.3.3 Ensure chrony is enabled and running (Automated)
  platforms: linux
  platform: linux
  description: Ensure chrony is enabled and running (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.1 Ensure cron daemon is enabled and active (Automated)
  platforms: linux
  platform: linux
  description: Ensure cron daemon is enabled and active (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name='cron')
       OR (
         EXISTS (
           SELECT 1 FROM systemd_units
           WHERE (name='cron.service' OR name='crond.service')
             AND enabled_state='enabled'
         )
         AND EXISTS (
           SELECT 1 FROM systemd_units
           WHERE (name='cron.service' OR name='crond.service')
             AND active_state='active'
         )
       );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.2 Ensure access to /etc/crontab is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/crontab is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0600 for /etc/crontab.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /etc/crontab && sudo chmod 0600 /etc/crontab
  # - FAIL (run):
  #   - sudo chmod 0777 /etc/crontab
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/crontab' AND uid = 0 AND gid = 0
        AND mode = '0600'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.3 Ensure access to /etc/cron.hourly is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.hourly is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0700 for /etc/cron.hourly.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /etc/cron.hourly && sudo chmod 0700 /etc/cron.hourly
  # - FAIL (run):
  #   - sudo chmod 0777 /etc/cron.hourly
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.hourly' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND mode = '0700'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.4 Ensure access to /etc/cron.daily is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.daily is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0700 for /etc/cron.daily.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /etc/cron.daily && sudo chmod 0700 /etc/cron.daily
  # - FAIL (run):
  #   - sudo chmod 0777 /etc/cron.daily
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.daily' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND mode = '0700'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.5 Ensure access to /etc/cron.weekly is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.weekly is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0700 for /etc/cron.weekly.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /etc/cron.weekly && sudo chmod 0700 /etc/cron.weekly
  # - FAIL (run):
  #   - sudo chmod 0777 /etc/cron.weekly
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.weekly' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND mode = '0700'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.6 Ensure access to /etc/cron.monthly is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.monthly is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0700 for /etc/cron.monthly.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /etc/cron.monthly && sudo chmod 0700 /etc/cron.monthly
  # - FAIL (run):
  #   - sudo chmod 0777 /etc/cron.monthly
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.monthly' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND mode = '0700'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.7 Ensure access to /etc/cron.yearly is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.yearly is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0700 for /etc/cron.yearly.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /etc/cron.yearly && sudo chmod 0700 /etc/cron.yearly
  # - FAIL (run):
  #   - sudo chmod 0777 /etc/cron.yearly
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.yearly' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND mode = '0700'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.8 Ensure access to /etc/cron.d is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/cron.d is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0700 for /etc/cron.d.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /etc/cron.d && sudo chmod 0700 /etc/cron.d
  # - FAIL (run):
  #   - sudo chmod 0777 /etc/cron.d
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/cron.d' AND uid = 0 AND gid = 0 AND type = 'directory'
        AND mode = '0700'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.1.9 Ensure access to crontab is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to crontab is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name='cron')
       OR (
         (SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/cron.allow'
        AND uid=0
        AND mode IN ('0640','0600','0400')
        AND (gid=0 OR gid = (SELECT gid FROM groups WHERE groupname='crontab' LIMIT 1))
    );)
         AND
         (SELECT 1
    WHERE NOT EXISTS (SELECT 1 FROM file WHERE path='/etc/cron.deny')
       OR EXISTS (
         SELECT 1 FROM file
         WHERE path='/etc/cron.deny'
           AND uid=0
           AND mode IN ('0640','0600','0400')
           AND (gid=0 OR gid = (SELECT gid FROM groups WHERE groupname='crontab' LIMIT 1))
       );)
       );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 2.4.2.1 Ensure access to at is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to at is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name='at')
       OR (
         (SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/at.allow'
        AND uid=0
        AND mode IN ('0640','0600','0400')
        AND (gid=0 OR gid = (SELECT gid FROM groups WHERE groupname='daemon' LIMIT 1))
    );)
         AND
         (SELECT 1
    WHERE NOT EXISTS (SELECT 1 FROM file WHERE path='/etc/at.deny')
       OR EXISTS (
         SELECT 1 FROM file
         WHERE path='/etc/at.deny'
           AND uid=0
           AND mode IN ('0640','0600','0400')
           AND (gid=0 OR gid = (SELECT gid FROM groups WHERE groupname='daemon' LIMIT 1))
       );)
       );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.1.1 Ensure IPv6 status is identified (Manual) ................................
  platforms: linux
  platform: linux
  description: Ensure IPv6 status is identified (Manual) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.1.2 Ensure wireless interfaces are not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure wireless interfaces are not available (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/proc/net/wireless'
        AND line LIKE '%:%'
    );
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.1.3 Ensure bluetooth services are not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure bluetooth services are not in use (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (SELECT 1 FROM deb_packages WHERE name='bluez')
       OR (
         NOT EXISTS (
           SELECT 1 FROM systemd_units
           WHERE name='bluetooth.service' AND enabled_state='enabled'
         )
         AND NOT EXISTS (
           SELECT 1 FROM systemd_units
           WHERE name='bluetooth.service' AND active_state='active'
         )
       );
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.2.1 Ensure dccp kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure dccp kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/dccp.conf with blacklist + install rules to prevent loading dccp.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/dccp.conf
# blacklist dccp
# install dccp /bin/false
# EOF'
  #   - sudo modprobe -r dccp 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/dccp.conf
  #   - (optional) sudo modprobe dccp 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='dccp') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist dccp%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install dccp /bin/false%' OR line LIKE 'install dccp /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.2.2 Ensure tipc kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure tipc kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/tipc.conf with blacklist + install rules to prevent loading tipc.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/tipc.conf
# blacklist tipc
# install tipc /bin/false
# EOF'
  #   - sudo modprobe -r tipc 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/tipc.conf
  #   - (optional) sudo modprobe tipc 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='tipc') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist tipc%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install tipc /bin/false%' OR line LIKE 'install tipc /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.2.3 Ensure rds kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure rds kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/rds.conf with blacklist + install rules to prevent loading rds.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/rds.conf
# blacklist rds
# install rds /bin/false
# EOF'
  #   - sudo modprobe -r rds 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/rds.conf
  #   - (optional) sudo modprobe rds 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='rds') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist rds%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install rds /bin/false%' OR line LIKE 'install rds /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.2.4 Ensure sctp kernel module is not available (Automated)
  platforms: linux
  platform: linux
  description: Ensure sctp kernel module is not available (Automated)
  resolution: |
    Create /etc/modprobe.d/sctp.conf with blacklist + install rules to prevent loading sctp.
  # QA Validation:
  # - Where: Run on the audited Ubuntu 22.04 host (use a disposable VM for FAIL).
  # - PASS (run):
  #   - sudo bash -c 'cat <<EOF > /etc/modprobe.d/sctp.conf
# blacklist sctp
# install sctp /bin/false
# EOF'
  #   - sudo modprobe -r sctp 2>/dev/null || true
  # - FAIL (run):
  #   - sudo rm -f /etc/modprobe.d/sctp.conf
  #   - (optional) sudo modprobe sctp 2>/dev/null || true
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE (SELECT COUNT(*) FROM kernel_modules WHERE name='sctp') = 0
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND line LIKE 'blacklist sctp%'
             AND line NOT LIKE '#%') >= 1
      AND (SELECT COUNT(*) FROM file_lines
           WHERE path LIKE '/etc/modprobe.d/%.conf'
             AND (line LIKE 'install sctp /bin/false%' OR line LIKE 'install sctp /bin/true%')
             AND line NOT LIKE '#%') >= 1;
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.1 Ensure net.ipv4.ip_forward is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.ip_forward is configured (Automated)
  resolution: |
    Set net.ipv4.ip_forward=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.ip_forward=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.ip_forward=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.ip_forward' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.2 Ensure net.ipv4.conf.all.forwarding is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.forwarding is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM system_controls WHERE name='net.ipv4.conf.all.forwarding' AND value='0')
      AND EXISTS (
        SELECT 1 FROM file_lines
        WHERE (path='/etc/sysctl.conf'
           OR path LIKE '/etc/sysctl.d/%.conf'
           OR path LIKE '/usr/lib/sysctl.d/%.conf'
           OR path LIKE '/lib/sysctl.d/%.conf'
           OR path LIKE '/run/sysctl.d/%.conf')
          AND line NOT LIKE '#%'
          AND (line LIKE 'net.ipv4.conf.all.forwarding = 0'
            OR line LIKE 'net.ipv4.conf.all.forwarding=0'
            OR line LIKE 'net.ipv4.conf.all.forwarding = 0 %'
            OR line LIKE 'net.ipv4.conf.all.forwarding=0 %')
      );
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.3 Ensure net.ipv4.conf.default.forwarding is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.forwarding is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM system_controls WHERE name='net.ipv4.conf.default.forwarding' AND value='0')
      AND EXISTS (
        SELECT 1 FROM file_lines
        WHERE (path='/etc/sysctl.conf'
           OR path LIKE '/etc/sysctl.d/%.conf'
           OR path LIKE '/usr/lib/sysctl.d/%.conf'
           OR path LIKE '/lib/sysctl.d/%.conf'
           OR path LIKE '/run/sysctl.d/%.conf')
          AND line NOT LIKE '#%'
          AND (line LIKE 'net.ipv4.conf.default.forwarding = 0'
            OR line LIKE 'net.ipv4.conf.default.forwarding=0'
            OR line LIKE 'net.ipv4.conf.default.forwarding = 0 %'
            OR line LIKE 'net.ipv4.conf.default.forwarding=0 %')
      );
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.4 Ensure net.ipv4.conf.all.send_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.send_redirects is configured (Automated)
  resolution: |
    Set net.ipv4.conf.all.send_redirects=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.all.send_redirects=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.all.send_redirects=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.send_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.5 Ensure net.ipv4.conf.default.send_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.send_redirects is configured (Automated)
  resolution: |
    Set net.ipv4.conf.default.send_redirects=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.default.send_redirects=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.default.send_redirects=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.send_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.6 Ensure net.ipv4.icmp_ignore_bogus_error_responses is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.icmp_ignore_bogus_error_responses is configured (Automated)
  resolution: |
    Set net.ipv4.icmp_ignore_bogus_error_responses=1 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.icmp_ignore_bogus_error_responses=1
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.icmp_ignore_bogus_error_responses=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.icmp_ignore_bogus_error_responses' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.7 Ensure net.ipv4.icmp_echo_ignore_broadcasts is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.icmp_echo_ignore_broadcasts is configured (Automated)
  resolution: |
    Set net.ipv4.icmp_echo_ignore_broadcasts=1 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.icmp_echo_ignore_broadcasts=1
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.icmp_echo_ignore_broadcasts=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.icmp_echo_ignore_broadcasts' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.8 Ensure net.ipv4.conf.all.accept_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.accept_redirects is configured (Automated)
  resolution: |
    Set net.ipv4.conf.all.accept_redirects=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.all.accept_redirects=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.all.accept_redirects=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.accept_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.9 Ensure net.ipv4.conf.default.accept_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.accept_redirects is configured (Automated)
  resolution: |
    Set net.ipv4.conf.default.accept_redirects=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.default.accept_redirects=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.default.accept_redirects=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.accept_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.10 Ensure net.ipv4.conf.all.secure_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.secure_redirects is configured (Automated)
  resolution: |
    Set net.ipv4.conf.all.secure_redirects=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.all.secure_redirects=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.all.secure_redirects=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.secure_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.11 Ensure net.ipv4.conf.default.secure_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.secure_redirects is configured (Automated)
  resolution: |
    Set net.ipv4.conf.default.secure_redirects=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.default.secure_redirects=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.default.secure_redirects=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.secure_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.12 Ensure net.ipv4.conf.all.rp_filter is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.rp_filter is configured (Automated)
  resolution: |
    Set net.ipv4.conf.all.rp_filter=1 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.all.rp_filter=1
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.all.rp_filter=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.rp_filter' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.13 Ensure net.ipv4.conf.default.rp_filter is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.rp_filter is configured (Automated)
  resolution: |
    Set net.ipv4.conf.default.rp_filter=1 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.default.rp_filter=1
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.default.rp_filter=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.rp_filter' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.14 Ensure net.ipv4.conf.all.accept_source_route is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.all.accept_source_route is configured (Automated)
  resolution: |
    Set net.ipv4.conf.all.accept_source_route=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.all.accept_source_route=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.all.accept_source_route=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.all.accept_source_route' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.15 Ensure net.ipv4.conf.default.accept_source_route is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.accept_source_route is configured (Automated)
  resolution: |
    Set net.ipv4.conf.default.accept_source_route=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.default.accept_source_route=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.default.accept_source_route=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.accept_source_route' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.17 Ensure net.ipv4.conf.default.log_martians is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.conf.default.log_martians is configured (Automated)
  resolution: |
    Set net.ipv4.conf.default.log_martians=1 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.conf.default.log_martians=1
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.conf.default.log_martians=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.conf.default.log_martians' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.1.18 Ensure net.ipv4.tcp_syncookies is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv4.tcp_syncookies is configured (Automated)
  resolution: |
    Set net.ipv4.tcp_syncookies=1 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv4.tcp_syncookies=1
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv4.tcp_syncookies=0
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv4.tcp_syncookies' AND value='1');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.1 Ensure net.ipv6.conf.all.forwarding is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.all.forwarding is configured (Automated)
  resolution: |
    Set net.ipv6.conf.all.forwarding=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv6.conf.all.forwarding=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv6.conf.all.forwarding=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.all.forwarding' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.2 Ensure net.ipv6.conf.default.forwarding is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.default.forwarding is configured (Automated)
  resolution: |
    Set net.ipv6.conf.default.forwarding=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv6.conf.default.forwarding=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv6.conf.default.forwarding=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.default.forwarding' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.3 Ensure net.ipv6.conf.all.accept_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.all.accept_redirects is configured (Automated)
  resolution: |
    Set net.ipv6.conf.all.accept_redirects=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv6.conf.all.accept_redirects=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv6.conf.all.accept_redirects=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.all.accept_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.4 Ensure net.ipv6.conf.default.accept_redirects is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.default.accept_redirects is configured (Automated)
  resolution: |
    Set net.ipv6.conf.default.accept_redirects=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv6.conf.default.accept_redirects=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv6.conf.default.accept_redirects=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.default.accept_redirects' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.5 Ensure net.ipv6.conf.all.accept_source_route is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.all.accept_source_route is configured (Automated)
  resolution: |
    Set net.ipv6.conf.all.accept_source_route=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv6.conf.all.accept_source_route=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv6.conf.all.accept_source_route=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.all.accept_source_route' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.6 Ensure net.ipv6.conf.default.accept_source_route is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.default.accept_source_route is configured (Automated)
  resolution: |
    Set net.ipv6.conf.default.accept_source_route=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv6.conf.default.accept_source_route=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv6.conf.default.accept_source_route=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.default.accept_source_route' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.7 Ensure net.ipv6.conf.all.accept_ra is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.all.accept_ra is configured (Automated)
  resolution: |
    Set net.ipv6.conf.all.accept_ra=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv6.conf.all.accept_ra=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv6.conf.all.accept_ra=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.all.accept_ra' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 3.3.2.8 Ensure net.ipv6.conf.default.accept_ra is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure net.ipv6.conf.default.accept_ra is configured (Automated)
  resolution: |
    Set net.ipv6.conf.default.accept_ra=0 and persist.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo sysctl -w net.ipv6.conf.default.accept_ra=0
  # - FAIL (run):
  #   - sudo sysctl -w net.ipv6.conf.default.accept_ra=1
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM sysctl WHERE name='net.ipv6.conf.default.accept_ra' AND value='0');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.1 Ensure ufw is installed (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure ufw is installed (Automated) ................................
  resolution: |
    Install ufw.
  # QA Validation:
  # - Where: Run on the audited host (FAIL best on disposable VM).
  # - PASS (run):
  #   - sudo apt-get update && sudo apt-get install -y ufw
  # - FAIL (run):
  #   - sudo apt-get purge -y ufw
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name = 'ufw');
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.2 Ensure ufw service is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw service is configured (Automated)
  resolution: |
    Enable ufw.
  # QA Validation:
  # - Where: Run on the audited host.
  # - PASS (run):
  #   - sudo apt-get update && sudo apt-get install -y ufw
  #   - sudo ufw --force enable
  # - FAIL (run):
  #   - sudo ufw --force disable
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='ufw')
      AND EXISTS (
        SELECT 1 FROM file_lines
        WHERE path='/etc/ufw/ufw.conf'
          AND line LIKE 'ENABLED=yes%'
          AND line NOT LIKE '#%'
      );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.3 Ensure ufw incoming default is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw incoming default is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.4 Ensure ufw outgoing default is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw outgoing default is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 4.1.5 Ensure ufw routed default is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure ufw routed default is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.1 Ensure access to /etc/ssh/sshd_config is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/ssh/sshd_config is configured (Automated)
  resolution: |
    Set owner root:root and permissions to 0600 for /etc/ssh/sshd_config.
  # QA Validation:
  # - Where: Run on the audited host (use disposable VM for FAIL).
  # - PASS (run):
  #   - sudo chown root:root /etc/ssh/sshd_config && sudo chmod 0600 /etc/ssh/sshd_config
  # - FAIL (run):
  #   - sudo chmod 0777 /etc/ssh/sshd_config
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path = '/etc/ssh/sshd_config' AND uid = 0 AND gid = 0
        AND mode = '0600'
    );
  purpose: Informational
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.2 Ensure access to SSH private host key files is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to SSH private host key files is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.3 Ensure access to SSH public host key files is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to SSH public host key files is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.4 Ensure sshd access is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd access is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.5 Ensure sshd Banner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd Banner is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.6 Ensure sshd Ciphers are configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd Ciphers are configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.7 Ensure sshd ClientAliveInterval and ClientAliveCountMax are configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd ClientAliveInterval and ClientAliveCountMax are configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'ClientAliveInterval 300%' OR line LIKE 'ClientAliveInterval	300%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.8 Ensure sshd DisableForwarding is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd DisableForwarding is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.9 Ensure sshd GSSAPIAuthentication is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd GSSAPIAuthentication is disabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.10 Ensure sshd HostbasedAuthentication is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd HostbasedAuthentication is disabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'HostbasedAuthentication no%' OR line LIKE 'HostbasedAuthentication	no%')
    )
    AND NOT EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'HostbasedAuthentication yes%' OR line LIKE 'HostbasedAuthentication	yes%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.11 Ensure sshd IgnoreRhosts is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd IgnoreRhosts is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'IgnoreRhosts yes%' OR line LIKE 'IgnoreRhosts	yes%')
    )
    AND NOT EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'IgnoreRhosts no%' OR line LIKE 'IgnoreRhosts	no%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.12 Ensure sshd KexAlgorithms is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd KexAlgorithms is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.13 Ensure sshd LoginGraceTime is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd LoginGraceTime is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'LoginGraceTime 60%' OR line LIKE 'LoginGraceTime	60%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.14 Ensure sshd LogLevel is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd LogLevel is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'LogLevel INFO%' OR line LIKE 'LogLevel VERBOSE%' OR line LIKE 'LogLevel	INFO%' OR line LIKE 'LogLevel	VERBOSE%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.15 Ensure sshd MACs are configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd MACs are configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.16 Ensure sshd MaxAuthTries is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd MaxAuthTries is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'MaxAuthTries 4%' OR line LIKE 'MaxAuthTries	4%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.17 Ensure sshd MaxSessions is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd MaxSessions is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.18 Ensure sshd MaxStartups is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd MaxStartups is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.19 Ensure sshd PermitEmptyPasswords is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd PermitEmptyPasswords is disabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'PermitEmptyPasswords no%' OR line LIKE 'PermitEmptyPasswords	no%')
    )
    AND NOT EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'PermitEmptyPasswords yes%' OR line LIKE 'PermitEmptyPasswords	yes%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.20 Ensure sshd PermitRootLogin is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd PermitRootLogin is disabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'PermitRootLogin no%' OR line LIKE 'PermitRootLogin	no%')
    )
    AND NOT EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'PermitRootLogin yes%' OR line LIKE 'PermitRootLogin prohibit-password%' OR line LIKE 'PermitRootLogin without-password%' OR line LIKE 'PermitRootLogin	yes%' OR line LIKE 'PermitRootLogin	prohibit-password%' OR line LIKE 'PermitRootLogin	without-password%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.21 Ensure sshd PermitUserEnvironment is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd PermitUserEnvironment is disabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'PermitUserEnvironment no%' OR line LIKE 'PermitUserEnvironment	no%')
    )
    AND NOT EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'PermitUserEnvironment yes%' OR line LIKE 'PermitUserEnvironment	yes%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.1.22 Ensure sshd UsePAM is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure sshd UsePAM is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'UsePAM yes%' OR line LIKE 'UsePAM	yes%')
    )
    AND NOT EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path = '/etc/ssh/sshd_config' OR path LIKE '/etc/ssh/sshd_config.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE 'UsePAM no%' OR line LIKE 'UsePAM	no%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.1 Ensure sudo is installed (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure sudo is installed (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='sudo');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.2 Ensure sudo commands use pty (Automated)
  platforms: linux
  platform: linux
  description: Ensure sudo commands use pty (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.3 Ensure sudo log file exists (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure sudo log file exists (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.4 Ensure users must provide password for escalation (Automated)
  platforms: linux
  platform: linux
  description: Ensure users must provide password for escalation (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.5 Ensure re -authentication for privilege escalation is not disabled globally (Automated) 542
  platforms: linux
  platform: linux
  description: Ensure re -authentication for privilege escalation is not disabled globally (Automated) 542
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.6 Ensure sudo timestamp_timeout is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure sudo timestamp_timeout is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.2.7 Ensure access to the su command is restricted (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to the su command is restricted (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.1.1 Ensure latest version of pam is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure latest version of pam is installed (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='latest-version-of-pam');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.1.3 Ensure latest version of libpam -pwquality is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure latest version of libpam -pwquality is installed (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='latest-version-of-libpam--pwquality');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.2.1 Ensure pam_unix module is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix module is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.2.2 Ensure pam_faillock module is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_faillock module is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.2.3 Ensure pam_pwquality module is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_pwquality module is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.2.4 Ensure pam_pwhistory module is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_pwhistory module is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.1.1 Ensure password failed attempts lockout is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password failed attempts lockout is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/security/faillock.conf'
        AND line NOT LIKE '#%'
        AND (
          line LIKE 'deny=1%' OR line LIKE 'deny = 1%'
          OR line LIKE 'deny=2%' OR line LIKE 'deny = 2%'
          OR line LIKE 'deny=3%' OR line LIKE 'deny = 3%'
          OR line LIKE 'deny=4%' OR line LIKE 'deny = 4%'
          OR line LIKE 'deny=5%' OR line LIKE 'deny = 5%'
        )
    )
      AND NOT (EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/pam.d/common-auth'
        AND line NOT LIKE '#%'
        AND line LIKE '%pam_faillock.so%'
        AND (
          line LIKE '%deny=1_%' OR line LIKE '%deny = 1_%'
          OR line LIKE '%deny=2_%' OR line LIKE '%deny = 2_%'
          OR line LIKE '%deny=3_%' OR line LIKE '%deny = 3_%'
          OR line LIKE '%deny=4_%' OR line LIKE '%deny = 4_%'
          OR line LIKE '%deny=5_%' OR line LIKE '%deny = 5_%'
          OR line LIKE '%deny=6_%' OR line LIKE '%deny = 6_%'
          OR line LIKE '%deny=7_%' OR line LIKE '%deny = 7_%'
          OR line LIKE '%deny=8_%' OR line LIKE '%deny = 8_%'
          OR line LIKE '%deny=9_%' OR line LIKE '%deny = 9_%'
        )
    ) OR EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/pam.d/common-auth'
        AND line NOT LIKE '#%'
        AND line LIKE '%pam_faillock.so%'
        AND (
          line LIKE '%deny=0%' OR line LIKE '%deny = 0%'
          OR line LIKE '%deny=6 %' OR line LIKE '%deny = 6 %' OR line LIKE '%deny=6' OR line LIKE '%deny = 6'
          OR line LIKE '%deny=7 %' OR line LIKE '%deny = 7 %' OR line LIKE '%deny=7' OR line LIKE '%deny = 7'
          OR line LIKE '%deny=8 %' OR line LIKE '%deny = 8 %' OR line LIKE '%deny=8' OR line LIKE '%deny = 8'
          OR line LIKE '%deny=9 %' OR line LIKE '%deny = 9 %' OR line LIKE '%deny=9' OR line LIKE '%deny = 9'
        )
    ));
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.1.2 Ensure password unlock time is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password unlock time is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/security/faillock.conf'
        AND line NOT LIKE '#%'
        AND (
          line LIKE 'unlock_time=0%' OR line LIKE 'unlock_time = 0%'
          OR line LIKE 'unlock_time=9__%' OR line LIKE 'unlock_time = 9__%'
          OR line LIKE 'unlock_time=____%' OR line LIKE 'unlock_time = ____%'
          OR line LIKE 'unlock_time=_____%' OR line LIKE 'unlock_time = _____%'
        )
    )
      AND NOT (EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/pam.d/common-auth'
        AND line NOT LIKE '#%'
        AND line LIKE '%pam_faillock.so%'
        AND (
          line LIKE '%unlock_time=_%' OR line LIKE '%unlock_time = _%'
          OR line LIKE '%unlock_time=__%' OR line LIKE '%unlock_time = __%'
          OR line LIKE '%unlock_time=1__%' OR line LIKE '%unlock_time = 1__%'
          OR line LIKE '%unlock_time=2__%' OR line LIKE '%unlock_time = 2__%'
          OR line LIKE '%unlock_time=3__%' OR line LIKE '%unlock_time = 3__%'
          OR line LIKE '%unlock_time=4__%' OR line LIKE '%unlock_time = 4__%'
          OR line LIKE '%unlock_time=5__%' OR line LIKE '%unlock_time = 5__%'
          OR line LIKE '%unlock_time=6__%' OR line LIKE '%unlock_time = 6__%'
          OR line LIKE '%unlock_time=7__%' OR line LIKE '%unlock_time = 7__%'
          OR line LIKE '%unlock_time=8__%' OR line LIKE '%unlock_time = 8__%'
        )
        AND line NOT LIKE '%unlock_time=9__%'
        AND line NOT LIKE '%unlock_time = 9__%'
    ));
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.1.3 Ensure password failed attempts lockout includes root account (Automated)
  platforms: linux
  platform: linux
  description: Ensure password failed attempts lockout includes root account (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/security/faillock.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'even_deny_root%' OR line LIKE 'root_unlock_time=%' OR line LIKE 'root_unlock_time = %')
    )
      AND NOT (EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/security/faillock.conf'
        AND line NOT LIKE '#%'
        AND (
          line LIKE 'root_unlock_time=1%' OR line LIKE 'root_unlock_time = 1%'
          OR line LIKE 'root_unlock_time=2%' OR line LIKE 'root_unlock_time = 2%'
          OR line LIKE 'root_unlock_time=3%' OR line LIKE 'root_unlock_time = 3%'
          OR line LIKE 'root_unlock_time=4%' OR line LIKE 'root_unlock_time = 4%'
          OR line LIKE 'root_unlock_time=5%' OR line LIKE 'root_unlock_time = 5%'
        )
        AND line NOT LIKE 'root_unlock_time=6_%'
        AND line NOT LIKE 'root_unlock_time = 6_%'
    ))
      AND NOT (EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/pam.d/common-auth'
        AND line NOT LIKE '#%'
        AND line LIKE '%pam_faillock.so%'
        AND (
          line LIKE '%root_unlock_time=1%' OR line LIKE '%root_unlock_time = 1%'
          OR line LIKE '%root_unlock_time=2%' OR line LIKE '%root_unlock_time = 2%'
          OR line LIKE '%root_unlock_time=3%' OR line LIKE '%root_unlock_time = 3%'
          OR line LIKE '%root_unlock_time=4%' OR line LIKE '%root_unlock_time = 4%'
          OR line LIKE '%root_unlock_time=5%' OR line LIKE '%root_unlock_time = 5%'
        )
        AND line NOT LIKE '%root_unlock_time=6_%'
        AND line NOT LIKE '%root_unlock_time = 6_%'
    ));
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.1 Ensure password number of changed characters is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password number of changed characters is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.2 Ensure minimum password length is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure minimum password length is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.3 Ensure password complexity is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure password complexity is configured (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.4 Ensure password same consecutive characters is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password same consecutive characters is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.5 Ensure password maximum sequential characters is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password maximum sequential characters is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.6 Ensure password dictionary check is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure password dictionary check is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.7 Ensure password quality checking is enforced (Automated)
  platforms: linux
  platform: linux
  description: Ensure password quality checking is enforced (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.2.8 Ensure password quality is enforced for the root user (Automated)
  platforms: linux
  platform: linux
  description: Ensure password quality is enforced for the root user (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.3.1 Ensure password history remember is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password history remember is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/pam.d/common-password'
        AND line NOT LIKE '#%'
        AND line LIKE '%pam_pwhistory.so%'
        AND ((line LIKE '%remember=24%' OR line LIKE '%remember = 24%') OR (line LIKE '%remember=25%' OR line LIKE '%remember = 25%') OR (line LIKE '%remember=26%' OR line LIKE '%remember = 26%') OR (line LIKE '%remember=27%' OR line LIKE '%remember = 27%') OR (line LIKE '%remember=28%' OR line LIKE '%remember = 28%') OR (line LIKE '%remember=29%' OR line LIKE '%remember = 29%') OR (line LIKE '%remember=3_%' OR line LIKE '%remember = 3_%') OR (line LIKE '%remember=4_%' OR line LIKE '%remember = 4_%') OR (line LIKE '%remember=5_%' OR line LIKE '%remember = 5_%') OR (line LIKE '%remember=6_%' OR line LIKE '%remember = 6_%') OR (line LIKE '%remember=7_%' OR line LIKE '%remember = 7_%') OR (line LIKE '%remember=8_%' OR line LIKE '%remember = 8_%') OR (line LIKE '%remember=9_%' OR line LIKE '%remember = 9_%') OR (line LIKE '%remember=___%' OR line LIKE '%remember = ___%'))
    );
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.3.2 Ensure password history is enforced for the root user (Automated)
  platforms: linux
  platform: linux
  description: Ensure password history is enforced for the root user (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.3.3 Ensure pam_pwhistory includes use_authtok (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_pwhistory includes use_authtok (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.4.1 Ensure pam_unix does not include nullok (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix does not include nullok (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.4.2 Ensure pam_unix does not include remember (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix does not include remember (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.4.3 Ensure pam_unix includes a strong password hashing algorithm (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix includes a strong password hashing algorithm (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.3.3.4.4 Ensure pam_unix includes use_authtok (Automated)
  platforms: linux
  platform: linux
  description: Ensure pam_unix includes use_authtok (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.1 Ensure password expiration is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password expiration is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.2 Ensure minimum password days is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure minimum password days is configured (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.3 Ensure password expiration warning days is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure password expiration warning days is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.4 Ensure strong password hashing algorithm is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure strong password hashing algorithm is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.5 Ensure inactive password lock is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure inactive password lock is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.1.6 Ensure all users last password change date is in the past (Automated)
  platforms: linux
  platform: linux
  description: Ensure all users last password change date is in the past (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.1 Ensure root is the only UID 0 account (Automated)
  platforms: linux
  platform: linux
  description: Ensure root is the only UID 0 account (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM users
      WHERE uid=0 AND username != 'root'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.2 Ensure root is the only GID 0 account (Automated)
  platforms: linux
  platform: linux
  description: Ensure root is the only GID 0 account (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM users
      WHERE gid=0 AND username != 'root'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.3 Ensure group root is the only GID 0 group (Automated)
  platforms: linux
  platform: linux
  description: Ensure group root is the only GID 0 group (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM groups
      WHERE gid=0 AND groupname != 'root'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.4 Ensure root account access is controlled (Automated)
  platforms: linux
  platform: linux
  description: Ensure root account access is controlled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.5 Ensure root path integrity (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure root path integrity (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.6 Ensure root user umask is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure root user umask is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.7 Ensure system accounts do not have a valid login shell (Automated)
  platforms: linux
  platform: linux
  description: Ensure system accounts do not have a valid login shell (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.2.8 Ensure accounts without a valid login shell are locked (Automated)
  platforms: linux
  platform: linux
  description: Ensure accounts without a valid login shell are locked (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.3.1 Ensure nologin is not listed in /etc/shells (Automated)
  platforms: linux
  platform: linux
  description: Ensure nologin is not listed in /etc/shells (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.3.2 Ensure default user shell timeout is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure default user shell timeout is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 5.4.3.3 Ensure default user umask is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure default user umask is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.2 Ensure journald log file access is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure journald log file access is configured (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.3 Ensure journald log file rotation is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure journald log file rotation is configured (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.4 Ensure journald ForwardToSyslog is disabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure journald ForwardToSyslog is disabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/systemd/journald.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'ForwardToSyslog=no%' OR line LIKE 'ForwardToSyslog = no%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.5 Ensure journald Storage is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure journald Storage is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/systemd/journald.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'Storage=persistent%' OR line LIKE 'Storage = persistent%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.1.6 Ensure journald Compress is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure journald Compress is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/systemd/journald.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'Compress=yes%' OR line LIKE 'Compress = yes%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.2.1 Ensure systemd -journal -remote is installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -journal -remote is installed (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='systemd--journal--remote');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.2.2 Ensure systemd -journal -upload authentication is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure systemd -journal -upload authentication is configured (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.2.3 Ensure systemd -journal -upload is enabled and active (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -journal -upload is enabled and active (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM systemd_units WHERE name='systemd-journal-upload.service' AND enabled_state='enabled')
      AND EXISTS (SELECT 1 FROM systemd_units WHERE name='systemd-journal-upload.service' AND active_state='active');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.1.2.4 Ensure systemd -journal -remote service is not in use (Automated)
  platforms: linux
  platform: linux
  description: Ensure systemd -journal -remote service is not in use (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('systemd-journal-remote.socket','systemd-journal-remote.service') AND enabled_state='enabled'
    )
    AND NOT EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name IN ('systemd-journal-remote.socket','systemd-journal-remote.service') AND active_state='active'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.1 Ensure rsyslog is installed (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure rsyslog is installed (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='rsyslog');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.2 Ensure rsyslog service is enabled and active (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsyslog service is enabled and active (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name='rsyslog.service' AND enabled_state='enabled'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.3 Ensure journald is configured to send logs to rsyslog (Automated)
  platforms: linux
  platform: linux
  description: Ensure journald is configured to send logs to rsyslog (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/systemd/journald.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'ForwardToSyslog=yes%' OR line LIKE 'ForwardToSyslog = yes%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.4 Ensure rsyslog log file creation mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsyslog log file creation mode is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    WITH cfg AS (
      SELECT ltrim(replace(line, char(9), ' ')) AS l
      FROM file_lines
      WHERE (path='/etc/rsyslog.conf' OR path LIKE '/etc/rsyslog.d/%.conf')
        AND line NOT LIKE '#%'
    ),
    tokens AS (
      SELECT
        CASE
          WHEN l LIKE '$FileCreateMode %' THEN
            trim(substr(l, length('$FileCreateMode ')+1))
          ELSE NULL
        END AS mode
      FROM cfg
      WHERE l LIKE '$FileCreateMode %'
    ),
    m AS (
      SELECT substr(mode,1,4) AS m4
      FROM tokens
      WHERE mode IS NOT NULL AND length(mode) >= 4
    )
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM m
      WHERE substr(m4,1,1)='0'
        AND substr(m4,2,1) IN ('0','2','4','6')
        AND substr(m4,3,1) IN ('0','2','4')
        AND substr(m4,4,1)='0'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.5 Ensure rsyslog logging is configured (Manual)
  platforms: linux
  platform: linux
  description: Ensure rsyslog logging is configured (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.6 Ensure rsyslog is configured to send logs to a remote log host (Manual)
  platforms: linux
  platform: linux
  description: Ensure rsyslog is configured to send logs to a remote log host (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path='/etc/rsyslog.conf' OR path LIKE '/etc/rsyslog.d/%.conf')
        AND line NOT LIKE '#%'
        AND (line LIKE '%@@%' OR line LIKE '% @%' OR line LIKE '%@%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.7 Ensure rsyslog is not configured to receive logs from a remote client (Automated)
  platforms: linux
  platform: linux
  description: Ensure rsyslog is not configured to receive logs from a remote client (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM file_lines
      WHERE (path='/etc/rsyslog.conf' OR path LIKE '/etc/rsyslog.d/%.conf')
        AND line NOT LIKE '#%'
        AND (
          line LIKE '%imtcp%' AND (line LIKE '%module(%' OR line LIKE '%input(%' OR line LIKE '%$ModLoad %' OR line LIKE '%$InputTCPServerRun%')
        )
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.2.8 Ensure logrotate is configured (Manual) ................................
  platforms: linux
  platform: linux
  description: Ensure logrotate is configured (Manual) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.1.3.1 Ensure access to all logfiles has been configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to all logfiles has been configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    WITH logfiles AS (
      SELECT path, type, mode
      FROM file
      WHERE path LIKE '/var/log/%'
        AND path NOT LIKE '/var/log/journal/%' -- journald binary logs handled separately
    ),
    ww_files AS (
      SELECT 1 FROM logfiles
      WHERE type='regular'
        AND substr(mode,4,1) IN ('2','3','6','7') -- other has write
      LIMIT 1
    ),
    ww_dirs_no_sticky AS (
      SELECT 1 FROM logfiles
      WHERE type='directory'
        AND substr(mode,4,1) IN ('2','3','6','7')
        AND (mode NOT LIKE '1%') -- sticky bit not set
      LIMIT 1
    )
    SELECT 1
    WHERE NOT EXISTS (SELECT 1 FROM ww_files)
      AND NOT EXISTS (SELECT 1 FROM ww_dirs_no_sticky);
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.1.1 Ensure auditd packages are installed (Automated)
  platforms: linux
  platform: linux
  description: Ensure auditd packages are installed (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='auditd')
      AND EXISTS (SELECT 1 FROM deb_packages WHERE name='audispd-plugins');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.1.2 Ensure auditd service is enabled and active (Automated)
  platforms: linux
  platform: linux
  description: Ensure auditd service is enabled and active (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM systemd_units
      WHERE name='auditd.service' AND enabled_state='enabled'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.1.3 Ensure auditing for processes that start prior to auditd is enabled (Automated)
  platforms: linux
  platform: linux
  description: Ensure auditing for processes that start prior to auditd is enabled (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/boot/grub/grub.cfg'
        AND line LIKE 'linux %'
        AND line LIKE '%audit=1%'
    )
    OR EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/default/grub'
        AND line NOT LIKE '#%'
        AND line LIKE 'GRUB_CMDLINE_LINUX%audit=1%'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.1.4 Ensure audit_backlog_limit is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit_backlog_limit is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    WITH lines AS (
      SELECT line AS l
      FROM file_lines
      WHERE path='/boot/grub/grub.cfg'
        AND l LIKE 'linux %'
        AND l LIKE '%audit_backlog_limit=%'
        AND l NOT LIKE '#%'
    ),
    vals AS (
      SELECT
        CAST(
          CASE
            WHEN instr(substr(l, instr(l, 'audit_backlog_limit=') + 20), ' ') > 0
              THEN substr(substr(l, instr(l, 'audit_backlog_limit=') + 20), 1, instr(substr(l, instr(l, 'audit_backlog_limit=') + 20), ' ') - 1)
            ELSE substr(l, instr(l, 'audit_backlog_limit=') + 20)
          END
        AS INTEGER) AS v
      FROM lines
    )
    SELECT 1
    WHERE EXISTS (SELECT 1 FROM vals WHERE v >= 8192);
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.2.1 Ensure audit log storage size is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit log storage size is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.2.2 Ensure audit logs are not automatically deleted (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit logs are not automatically deleted (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/audit/auditd.conf'
        AND line NOT LIKE '#%'
        AND (
          line LIKE 'max_log_file_action = keep_logs'
          OR line LIKE 'max_log_file_action=keep_logs'
          OR line LIKE 'max_log_file_action = keep_logs %'
          OR line LIKE 'max_log_file_action=keep_logs %'
        )
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.2.3 Ensure system is disabled when audit logs are full (Automated)
  platforms: linux
  platform: linux
  description: Ensure system is disabled when audit logs are full (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/audit/auditd.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'disk_full_action = halt%' OR line LIKE 'disk_full_action=halt%' OR
             line LIKE 'disk_full_action = single%' OR line LIKE 'disk_full_action=single%')
    )
    AND EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/audit/auditd.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'disk_error_action = syslog%' OR line LIKE 'disk_error_action=syslog%' OR
             line LIKE 'disk_error_action = single%' OR line LIKE 'disk_error_action=single%' OR
             line LIKE 'disk_error_action = halt%' OR line LIKE 'disk_error_action=halt%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.2.4 Ensure system warns when audit logs are low on space (Automated)
  platforms: linux
  platform: linux
  description: Ensure system warns when audit logs are low on space (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/audit/auditd.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'space_left_action = email%' OR line LIKE 'space_left_action=email%' OR
             line LIKE 'space_left_action = exec%' OR line LIKE 'space_left_action=exec%' OR
             line LIKE 'space_left_action = single%' OR line LIKE 'space_left_action=single%' OR
             line LIKE 'space_left_action = halt%' OR line LIKE 'space_left_action=halt%')
    )
    AND EXISTS (
      SELECT 1 FROM file_lines
      WHERE path='/etc/audit/auditd.conf'
        AND line NOT LIKE '#%'
        AND (line LIKE 'admin_space_left_action = single%' OR line LIKE 'admin_space_left_action=single%' OR
             line LIKE 'admin_space_left_action = halt%' OR line LIKE 'admin_space_left_action=halt%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.1 Ensure changes to system administration scope (sudoers) is collected (Automated) 744
  platforms: linux
  platform: linux
  description: Ensure changes to system administration scope (sudoers) is collected (Automated) 744
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.2 Ensure actions as another user are always logged (Automated)
  platforms: linux
  platform: linux
  description: Ensure actions as another user are always logged (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.3 Ensure events that modify the sudo log file are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure events that modify the sudo log file are collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.4 Ensure events that modify date and time information are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure events that modify date and time information are collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.5 Ensure events that modify the system's network environment are collected
  platforms: linux
  platform: linux
  description: Ensure events that modify the system's network environment are collected
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.6 Ensure use of privileged commands are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure use of privileged commands are collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.7 Ensure unsuccessful file access attempts are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure unsuccessful file access attempts are collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.8 Ensure events that modify user/group information are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure events that modify user/group information are collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.9 Ensure discretionary access control permission modification events are collected
  platforms: linux
  platform: linux
  description: Ensure discretionary access control permission modification events are collected
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.10 Ensure successful file system mounts are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure successful file system mounts are collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.11 Ensure session initiation information is collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure session initiation information is collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.12 Ensure login and logout events are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure login and logout events are collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.13 Ensure file deletion events by users are collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure file deletion events by users are collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.14 Ensure events that modify the system's Mandatory Access Controls are collected
  platforms: linux
  platform: linux
  description: Ensure events that modify the system's Mandatory Access Controls are collected
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.15 Ensure successful and unsuccessful attempts to use the chcon command are
  platforms: linux
  platform: linux
  description: Ensure successful and unsuccessful attempts to use the chcon command are
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.16 Ensure successful and unsuccessful attempts to use the setfacl command are
  platforms: linux
  platform: linux
  description: Ensure successful and unsuccessful attempts to use the setfacl command are
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.18 Ensure successful and unsuccessful attempts to use the usermod command are
  platforms: linux
  platform: linux
  description: Ensure successful and unsuccessful attempts to use the usermod command are
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.19 Ensure kernel module loading unloading and modification is collected (Automated)
  platforms: linux
  platform: linux
  description: Ensure kernel module loading unloading and modification is collected (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.20 Ensure the audit configuration is immutable (Automated)
  platforms: linux
  platform: linux
  description: Ensure the audit configuration is immutable (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file_lines
      WHERE path LIKE '/etc/audit/rules.d/%.rules'
        AND line NOT LIKE '#%'
        AND (line = '-e 2' OR line LIKE '-e 2 %' OR line LIKE '-e 2	%')
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.3.21 Ensure the running and on disk configuration is the same (Manual)
  platforms: linux
  platform: linux
  description: Ensure the running and on disk configuration is the same (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.1 Ensure audit log files mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit log files mode is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.2 Ensure audit log files owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit log files owner is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.3 Ensure audit log files group owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit log files group owner is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.4 Ensure the audit log file directory mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure the audit log file directory mode is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.5 Ensure audit configuration files mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit configuration files mode is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.6 Ensure audit configuration files owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit configuration files owner is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.7 Ensure audit configuration files group owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit configuration files group owner is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.8 Ensure audit tools mode is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit tools mode is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.9 Ensure audit tools owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit tools owner is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.2.4.10 Ensure audit tools group owner is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure audit tools group owner is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.3.1 Ensure AIDE is installed (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure AIDE is installed (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE EXISTS (SELECT 1 FROM deb_packages WHERE name='aide');
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.3.2 Ensure filesystem integrity is regularly checked (Automated)
  platforms: linux
  platform: linux
  description: Ensure filesystem integrity is regularly checked (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 6.3.3 Ensure cryptographic mechanisms are used to protect the integrity of audit tools
  platforms: linux
  platform: linux
  description: Ensure cryptographic mechanisms are used to protect the integrity of audit tools
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.1 Ensure access to /etc/passwd is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/passwd is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/passwd' AND mode='0644' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.2 Ensure access to /etc/passwd - is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/passwd - is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/passwd-' AND mode='0644' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.3 Ensure access to /etc/group is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/group is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/group' AND mode='0644' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.4 Ensure access to /etc/group - is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/group - is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/group-' AND mode='0644' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.5 Ensure access to /etc/shadow is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/shadow is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/shadow' AND mode='0640' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.6 Ensure access to /etc/shadow - is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/shadow - is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/shadow-' AND mode='0640' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.7 Ensure access to /etc/gshadow is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/gshadow is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/gshadow' AND mode='0640' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.8 Ensure access to /etc/gshadow - is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/gshadow - is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/gshadow-' AND mode='0640' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.9 Ensure access to /etc/shells is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/shells is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.10 Ensure access to /etc/security/opasswd is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure access to /etc/security/opasswd is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE EXISTS (
      SELECT 1 FROM file
      WHERE path='/etc/passwd' AND mode='0644' AND uid=0 AND gid=0
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.11 Ensure world writable files and directories are secured (Automated)
  platforms: linux
  platform: linux
  description: Ensure world writable files and directories are secured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.12 Ensure no files or directories without an owner and a group exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no files or directories without an owner and a group exist (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.1.13 Ensure SUID and SGID files are reviewed (Manual)
  platforms: linux
  platform: linux
  description: Ensure SUID and SGID files are reviewed (Manual)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.1 Ensure accounts in /etc/passwd use shadowed passwords (Automated)
  platforms: linux
  platform: linux
  description: Ensure accounts in /etc/passwd use shadowed passwords (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM users
      WHERE password != 'x'
        AND password != '*'
        AND password != '!'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.2 Ensure /etc/shadow password fields are not empty (Automated)
  platforms: linux
  platform: linux
  description: Ensure /etc/shadow password fields are not empty (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM shadow
      WHERE password = '' OR password IS NULL
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.3 Ensure all groups in /etc/passwd exist in /etc/group (Automated)
  platforms: linux
  platform: linux
  description: Ensure all groups in /etc/passwd exist in /etc/group (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1
      FROM users u
      LEFT JOIN groups g ON u.gid = g.gid
      WHERE g.gid IS NULL
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.4 Ensure shadow group is empty (Automated)
  platforms: linux
  platform: linux
  description: Ensure shadow group is empty (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT 1 FROM user_groups
      WHERE groupname='shadow'
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.5 Ensure no duplicate UIDs exist (Automated) ................................
  platforms: linux
  platform: linux
  description: Ensure no duplicate UIDs exist (Automated) ................................
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT uid FROM users GROUP BY uid HAVING COUNT(*) > 1
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.6 Ensure no duplicate GIDs exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no duplicate GIDs exist (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT gid FROM groups GROUP BY gid HAVING COUNT(*) > 1
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.7 Ensure no duplicate user names exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no duplicate user names exist (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT username FROM users GROUP BY username HAVING COUNT(*) > 1
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.8 Ensure no duplicate group names exist (Automated)
  platforms: linux
  platform: linux
  description: Ensure no duplicate group names exist (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1
    WHERE NOT EXISTS (
      SELECT groupname FROM groups GROUP BY groupname HAVING COUNT(*) > 1
    );
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.9 Ensure local interactive user home directories are configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure local interactive user home directories are configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    WITH interactive AS (
      SELECT username, directory AS home
      FROM users
      WHERE uid >= 1000 AND uid < 65534
        AND shell NOT IN ('/usr/sbin/nologin','/bin/false')
    ),
    missing_home AS (
      SELECT i.username, i.home
      FROM interactive i
      LEFT JOIN file f ON f.path = i.home
      WHERE f.path IS NULL OR f.type != 'directory'
    ),
    wrong_owner AS (
      SELECT i.username, i.home
      FROM interactive i
      JOIN file f ON f.path = i.home
      WHERE f.type='directory' AND f.uid != (SELECT uid FROM users WHERE username=i.username LIMIT 1)
    )
    SELECT 1
    WHERE NOT EXISTS (SELECT 1 FROM missing_home)
      AND NOT EXISTS (SELECT 1 FROM wrong_owner);
purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
---
apiVersion: v1
kind: policy
spec:
  name: CIS Ubuntu 22.04 - 7.2.10 Ensure local interactive user dot files access is configured (Automated)
  platforms: linux
  platform: linux
  description: Ensure local interactive user dot files access is configured (Automated)
  resolution: |
    Manual: follow the CIS 'Audit' procedure for this control and document the result.
  # QA Validation:
  # - Where: Manual validation required (no safe generic osquery automation).
  # - PASS (run):
  #   - (manual) follow CIS Audit steps; capture evidence (command output, config snippet, screenshot)
  # - FAIL (run):
  #   - (manual) change config on a disposable VM to violate the control; re-run audit to confirm fail
  # - Expected:
  #   - PASS: query returns 1 row
  #   - FAIL: query returns 0 rows
  query: |
    SELECT 1 WHERE 0;
  purpose: Manual Validation Required
  tags: compliance, CIS, CIS_Ubuntu_22_04
  contributors: sharon-fdm
