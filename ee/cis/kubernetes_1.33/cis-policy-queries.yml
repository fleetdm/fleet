---
apiVersion: v1
kind: policy
spec:
  name: CIS - Ensure that the --profiling argument is set to false
  platforms: RHEL_version_x
  platform: linux
  description: |
    Disable profiling, if not needed.
  resolution: |
    Edit the API server pod specification file /etc/kubernetes/manifests/kube-  apiserver.yaml on the Control Plane node and set the below parameter.  --profiling=false
  query: |
    SELECT 1 WHERE 
      EXISTS (
        SELECT 1 AS pass
        FROM processes
        WHERE name = 'kube-apiserver'
        AND cmdline LIKE '%--profiling=false%'
        )
      OR NOT EXISTS (
        SELECT 1 FROM processes WHERE name = 'kube-apiserver'
        );  
  purpose: Informational
  tags: compliance, CIS, CIS_Level1
  contributors: sharon-fdm
---
1
---
2
---
apiVersion: v1
kind: policy
spec:
  name: CIS (K8s) 1.1.14 - Ensure that the default administrative credential file ownership is set to root:root
  platform: linux
  description: |
    Ensure that the admin.conf (and super-admin.conf file, where it exists) file ownership is set to root:root.
  resolution: |
    Use the chown command to set the file ownership to root:root.
  query: |
    SELECT 1 WHERE NOT EXISTS (
      SELECT 1 FROM FILE f
        JOIN users u USING (uid)
        JOIN groups g USING (gid)
      WHERE f.path = '/var/lib/rancher/rke2/server/cred/admin.kubeconfig'
        AND (u.username != 'root' OR g.groupname != 'root')
    )
  purpose: Informational
  tags: compliance, CIS, CIS_Level1
  contributors: zwass
---
4
---
5
---
6
---
7
---
8
---
9
