#!/bin/bash

# Check if the vulnerability dashboard has been initialized before
if [ ! -f "/usr/src/app/.initialized" ]; then
  # if it hasn't, lift the app with in console mode with the --drop flag to create our databsae tables.
  echo '.exit' | node ./node_modules/sails/bin/sails console --drop

  touch /usr/src/app/.initialized
  # run the `update-reports` script
  node ./node_modules/sails/bin/sails run update-reports
fi

# Expose the container's ENV variables to cron
printenv >> /etc/environment

# Start cron
cron

# Start the vulnerability dashboard
exec node app.js
