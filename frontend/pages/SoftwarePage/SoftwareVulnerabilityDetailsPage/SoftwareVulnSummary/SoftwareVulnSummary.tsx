import React from "react";

import { IVulnerability } from "interfaces/vulnerability";

import CustomLink from "components/CustomLink";
import Card from "components/Card";
import DataSet from "components/DataSet";
import TooltipWrapper from "components/TooltipWrapper";
import ViewAllHostsLink from "components/ViewAllHostsLink";

const baseClass = "software-vuln-summary";

interface ISoftwareVulnSummaryProps {
  vuln: IVulnerability;
  isPremiumTier: boolean;
}

const SoftwareVulnSummary = ({
  vuln,
  isPremiumTier,
}: ISoftwareVulnSummaryProps) => {
  return (
    <Card borderRadiusSize="large" includeShadow className={baseClass}>
      <span className={`${baseClass}__header`}>
        <h1>{vuln.cve}</h1>
        <span className={`${baseClass}__header-links`}>
          <CustomLink
            url="https://nvd.nist.gov/"
            text="Visit NVD Page"
            newTab
          />
          <ViewAllHostsLink
            customText="View affected hosts"
            queryParams={{ cve: vuln.cve }}
          />
        </span>
      </span>
      <div className={`${baseClass}__description`}>{vuln.cve_description}</div>
      <dl className={`${baseClass}__description-list`}>
        {isPremiumTier && (
          <>
            <DataSet
              title={
                <TooltipWrapper tipContent="The worst case impact across different environments (CVSS base score). This data is reported by the National Vulnerability Database (NVD).">
                  Severity
                </TooltipWrapper>
              }
              value={vuln.cvss_score}
            />
            <DataSet
              title={
                <TooltipWrapper tipContent="The probability that this vulnerability will be exploited in the next 30 days (EPSS probability). This data is reported by FIRST.org.">
                  Probability of exploit
                </TooltipWrapper>
              }
              // TODO - include warning icon w/tooltip if actively exploited
              value={vuln.epss_probability}
            />
            <DataSet title="Published" value={vuln.cve_published} />
          </>
        )}

        <DataSet title="Detected" value={vuln.created_at} />
        <DataSet title="Affected hosts" value={vuln.hosts_count} />
      </dl>
    </Card>
  );
};

export default SoftwareVulnSummary;
